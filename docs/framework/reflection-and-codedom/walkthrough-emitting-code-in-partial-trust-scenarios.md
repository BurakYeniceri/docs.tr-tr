---
title: "İzlenecek yol: Kısmi Güven Senaryolarında Kod Yayma"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- reflection emit, anonymously hosted dynamic methods
- partial trust, reflection
- partial trust, emitting dynamic methods
- reflection emit, partial trust scenarios
- anonymously hosted dynamic methods [.NET Framework]
- emitting dynamic assemblies,partial trust scenarios
- reflection emit, dynamic methods
- dynamic methods
ms.assetid: c45be261-2a9d-4c4e-9bd6-27f0931b7d25
caps.latest.revision: "15"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 121dfd91d797aa03860abd4404ffe20113e70f85
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/21/2017
---
# <a name="walkthrough-emitting-code-in-partial-trust-scenarios"></a><span data-ttu-id="cf635-102">İzlenecek yol: Kısmi Güven Senaryolarında Kod Yayma</span><span class="sxs-lookup"><span data-stu-id="cf635-102">Walkthrough: Emitting Code in Partial Trust Scenarios</span></span>
<span data-ttu-id="cf635-103">Yansıma yayma aynı API tam veya kısmi güvende kümesini kullanır, ancak bazı özellikler kısmen güvenilen kod özel izinleri gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cf635-103">Reflection emit uses the same API set in full or partial trust, but some features require special permissions in partially trusted code.</span></span> <span data-ttu-id="cf635-104">Ayrıca, yansıma yayma ile kısmi güven ve güvenlik saydam derlemeleri tarafından kullanılmak üzere tasarlanmış bir özelliği anonim barındırılan dinamik yöntemler vardır.</span><span class="sxs-lookup"><span data-stu-id="cf635-104">In addition, reflection emit has a feature, anonymously hosted dynamic methods, that is designed to be used with partial trust and by security-transparent assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cf635-105">Önce [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], gerekli kod yayma <xref:System.Security.Permissions.ReflectionPermission> ile <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> bayrağı.</span><span class="sxs-lookup"><span data-stu-id="cf635-105">Before [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], emitting code required <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="cf635-106">Varsayılan olarak bu izni dahil `FullTrust` ve `Intranet` adlandırılmış izin ayarlar, ancak içinde değil `Internet` izin kümesi.</span><span class="sxs-lookup"><span data-stu-id="cf635-106">This permission is included by default in the `FullTrust` and `Intranet` named permission sets, but not in the `Internet` permission set.</span></span> <span data-ttu-id="cf635-107">Yalnızca sahipse, bu nedenle, bir kitaplık kısmi güven kullanılabilecek <xref:System.Security.SecurityCriticalAttribute> özniteliği ve ayrıca yürütülen bir <xref:System.Security.PermissionSet.Assert%2A> yöntemi <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span><span class="sxs-lookup"><span data-stu-id="cf635-107">Therefore, a library could be used from partial trust only if it had the <xref:System.Security.SecurityCriticalAttribute> attribute and also executed an <xref:System.Security.PermissionSet.Assert%2A> method for <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span></span> <span data-ttu-id="cf635-108">Kodlama hataları güvenlik açıklarını neden olabilir çünkü böyle kitaplıklarının dikkatli güvenlik incelemesi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cf635-108">Such libraries require careful security review because coding errors could result in security holes.</span></span> <span data-ttu-id="cf635-109">[!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] Kısmi güven senaryolarında kod oluşturma için tüm güvenlik taleplerini veren kendiliğinden ayrıcalıklı bir işlem değil olmadan yayınlaması için kod sağlar.</span><span class="sxs-lookup"><span data-stu-id="cf635-109">The [!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] allows code to be emitted in partial trust scenarios without issuing any security demands, because generating code is not inherently a privileged operation.</span></span> <span data-ttu-id="cf635-110">Diğer bir deyişle, oluşturulan kod bunu yayar derleme'den daha fazla hiçbir izni yoktur.</span><span class="sxs-lookup"><span data-stu-id="cf635-110">That is, the generated code has no more permissions than the assembly that emits it.</span></span> <span data-ttu-id="cf635-111">Güvenliği saydam kod yayma ve assert ihtiyacını ortadan kaldırır kitaplıkları böylece <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, böylece güvenli bir kitaplık yazma gibi kapsamlı güvenlik incelemesi gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="cf635-111">This enables libraries that emit code to be security-transparent and removes the need to assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, so that writing a secure library does not require such a thorough security review.</span></span>  
  
 <span data-ttu-id="cf635-112">Bu izlenecek yol aşağıdaki görevleri gösterir:</span><span class="sxs-lookup"><span data-stu-id="cf635-112">This walkthrough illustrates the following tasks:</span></span>  
  
-   <span data-ttu-id="cf635-113">[Kısmen sınama kodu güvenilir basit bir korumalı alan ayarı](#Setting_up).</span><span class="sxs-lookup"><span data-stu-id="cf635-113">[Setting up a simple sandbox for testing partially trusted code](#Setting_up).</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="cf635-114">Bu, kısmi güven kodda denemeniz için basit bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="cf635-114">This is a simple way to experiment with code in partial trust.</span></span> <span data-ttu-id="cf635-115">Gerçekte güvenilmeyen konumlardan gelen kodu çalıştırmak için bkz: [nasıl yapılır: çalıştırma kısmen güvenilen kod içinde bir korumalı alan](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="cf635-115">To run code that actually comes from untrusted locations, see [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
-   <span data-ttu-id="cf635-116">[Kısmen güvenilir uygulama etki alanlarında kod çalıştırmasını](#Running_code).</span><span class="sxs-lookup"><span data-stu-id="cf635-116">[Running code in partially trusted application domains](#Running_code).</span></span>  
  
-   <span data-ttu-id="cf635-117">[Kullanarak anonim barındırılan dinamik yöntemleri yayma ve kısmi güvende kod yürütmek için](#Using_methods).</span><span class="sxs-lookup"><span data-stu-id="cf635-117">[Using anonymously hosted dynamic methods to emit and execute code in partial trust](#Using_methods).</span></span>  
  
 <span data-ttu-id="cf635-118">Kısmi güven senaryolarında kod yayma hakkında daha fazla bilgi için bkz: [yansıma yayma güvenlik sorunları](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span><span class="sxs-lookup"><span data-stu-id="cf635-118">For more information about emitting code in partial trust scenarios, see [Security Issues in Reflection Emit](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span></span>  
  
 <span data-ttu-id="cf635-119">Bu yordamda gösterildiği kodu tam listesi için bkz: [örnek bölümüne](#Example) bu kılavuzun sonunda.</span><span class="sxs-lookup"><span data-stu-id="cf635-119">For a complete listing of the code shown in these procedures, see the [Example section](#Example) at the end of this walkthrough.</span></span>  
  
<a name="Setting_up"></a>   
## <a name="setting-up-partially-trusted-locations"></a><span data-ttu-id="cf635-120">Kısmen güvenilen konumları ayarlama</span><span class="sxs-lookup"><span data-stu-id="cf635-120">Setting up Partially Trusted Locations</span></span>  
 <span data-ttu-id="cf635-121">Aşağıdaki iki yordamdan kısmi güven koduyla test konumları ayarlama gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="cf635-121">The following two procedures show how to set up locations from which you can test code with partial trust.</span></span>  
  
-   <span data-ttu-id="cf635-122">İlk yordam bir korumalı uygulama etki alanı kodu Internet izinleri verilir oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="cf635-122">The first procedure shows how to create a sandboxed application domain in which code is granted Internet permissions.</span></span>  
  
-   <span data-ttu-id="cf635-123">İkinci yordam nasıl ekleneceğini gösterir <xref:System.Security.Permissions.ReflectionPermission> ile <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> eşit veya daha düşük güven derlemelerinin özel veri erişimi etkinleştirmek için bir kısmen güvenilir uygulama etki alanı için bayrak.</span><span class="sxs-lookup"><span data-stu-id="cf635-123">The second procedure shows how to add <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag to a partially trusted application domain, to enable access to private data in assemblies of equal or lesser trust.</span></span>  
  
### <a name="creating-sandboxed-application-domains"></a><span data-ttu-id="cf635-124">Korumalı uygulama etki alanları oluşturma</span><span class="sxs-lookup"><span data-stu-id="cf635-124">Creating Sandboxed Application Domains</span></span>  
 <span data-ttu-id="cf635-125">Derlemeleriniz kısmi güven çalıştığı uygulama etki alanı oluşturmak için derlemeleri kullanılarak verilmesi için izinler kümesini belirtin <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> uygulama etki alanı oluşturmak için yöntemi aşırı yüklemesini.</span><span class="sxs-lookup"><span data-stu-id="cf635-125">To create an application domain in which your assemblies run with partial trust, you must specify the set of permissions to be granted to the assemblies by using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to create the application domain.</span></span> <span data-ttu-id="cf635-126">Verme kümesi belirtmek için kolay bir adlandırılmış izin Güvenlik İlkesi'nden kümesini almak için yoludur.</span><span class="sxs-lookup"><span data-stu-id="cf635-126">The easiest way to specify the grant set is to retrieve a named permission set from security policy.</span></span>  
  
 <span data-ttu-id="cf635-127">Aşağıdaki yordam, kısmi güven senaryoları verilmiş kod yalnızca Genel üyeler genel türleri erişebilmeniz için test etmek için kodunuzun çalıştığı bir korumalı uygulama etki alanı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="cf635-127">The following procedure creates a sandboxed application domain that runs your code with partial trust, to test scenarios in which emitted code can access only public members of public types.</span></span> <span data-ttu-id="cf635-128">Bir sonraki yordamı nasıl ekleneceğini gösterir <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, hangi verilmiş kod erişebileceği ortak olmayan türleri ve üyeleri eşit veya daha düşük izinlerin verildiğini derlemelerde senaryolarını sınamak için.</span><span class="sxs-lookup"><span data-stu-id="cf635-128">A subsequent procedure shows how to add <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, to test scenarios in which emitted code can access nonpublic types and members in assemblies that are granted equal or lesser permissions.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust"></a><span data-ttu-id="cf635-129">Kısmi güven uygulama etki alanı oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="cf635-129">To create an application domain with partial trust</span></span>  
  
1.  <span data-ttu-id="cf635-130">Bir izin korumalı uygulama etki alanı derlemelerde vermek kümesi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="cf635-130">Create a permission set to grant to the assemblies in the sandboxed application domain.</span></span> <span data-ttu-id="cf635-131">Bu durumda, Internet bölgesi izin kümesi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="cf635-131">In this case, the permission set of the Internet zone is used.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#2)]
     [!code-vb[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#2)]  
  
2.  <span data-ttu-id="cf635-132">Oluşturma bir <xref:System.AppDomainSetup> nesne uygulama etki alanı ile bir uygulama yolu başlatılamadı.</span><span class="sxs-lookup"><span data-stu-id="cf635-132">Create an <xref:System.AppDomainSetup> object to initialize the application domain with an application path.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="cf635-133">Kolaylık olması için bu kod örneği, geçerli klasörde kullanır.</span><span class="sxs-lookup"><span data-stu-id="cf635-133">For simplicity, this code example uses the current folder.</span></span> <span data-ttu-id="cf635-134">Gerçekte Internet'ten gelen kodu çalıştırmak için ayrı bir klasör güvenilmeyen kodunu açıklandığı gibi kullanmak [nasıl yapılır: çalıştırma kısmen güvenilen kod içinde bir korumalı alan](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="cf635-134">To run code that actually comes from the Internet, use a separate folder for the untrusted code, as described in [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#3)]
     [!code-vb[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#3)]  
  
3.  <span data-ttu-id="cf635-135">Uygulama etki alanı kurulum bilgileri ve uygulama etki alanında yürütme tüm derlemeler için ayarlanmış grant belirtme uygulama etki alanı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="cf635-135">Create the application domain, specifying the application domain setup information and the grant set for all assemblies that execute in the application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#5)]
     [!code-vb[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#5)]  
  
     <span data-ttu-id="cf635-136">Son parametresi, <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> yöntemi aşırı yüklemesini verme kümesi uygulama etki alanının yerine tam güven verilecek olan derlemelerin kümesini belirtmenize olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="cf635-136">The last parameter of the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload enables you to specify a set of assemblies that are to be granted full trust, instead of the grant set of the application domain.</span></span> <span data-ttu-id="cf635-137">Belirtmek zorunda değilsiniz [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] bu derlemeleri genel derleme önbelleğinde olduğundan, uygulamanızın, kullandığı derlemeler.</span><span class="sxs-lookup"><span data-stu-id="cf635-137">You do not have to specify the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies that your application uses, because those assemblies are in the global assembly cache.</span></span> <span data-ttu-id="cf635-138">Genel derleme önbelleğinde her zaman tam güvenilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-138">Assemblies in the global assembly cache are always fully trusted.</span></span> <span data-ttu-id="cf635-139">Genel derleme önbelleğinde olmayan tanımlayıcı adlı derlemeler belirtmek için bu parametreyi kullanın.</span><span class="sxs-lookup"><span data-stu-id="cf635-139">You can use this parameter to specify strong-named assemblies that are not in the global assembly cache.</span></span>  
  
### <a name="adding-restrictedmemberaccess-to-sandboxed-domains"></a><span data-ttu-id="cf635-140">Korumalı etki alanlarına RestrictedMemberAccess ekleme</span><span class="sxs-lookup"><span data-stu-id="cf635-140">Adding RestrictedMemberAccess to Sandboxed Domains</span></span>  
 <span data-ttu-id="cf635-141">Ana bilgisayar uygulamaları güven düzeyleri eşit veya bu kod yayar derleme güven düzeyini değerinden olan derlemeler özel verilere erişim sağlamak anonim barındırılan dinamik yöntemler izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cf635-141">Host applications can allow anonymously hosted dynamic methods to have access to private data in assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span> <span data-ttu-id="cf635-142">Tam zamanında (JIT) görünürlük denetimlerini kısıtlı özelliği etkinleştirmek için ana bilgisayar uygulaması ekler bir <xref:System.Security.Permissions.ReflectionPermission> nesnesi ile <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> verme kümesi (Madde iade) bayrak.</span><span class="sxs-lookup"><span data-stu-id="cf635-142">To enable this restricted ability to skip just-in-time (JIT) visibility checks, the host application adds a <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> (RMA) flag to the grant set.</span></span>  
  
 <span data-ttu-id="cf635-143">Örneğin, böylece Internet uygulamasını kendi derlemeler özel verilere eriştiğinde kod yayma bir konak Internet uygulamaları Internet izinleri artı Madde iade, izin verebilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-143">For example, a host might grant Internet applications Internet permissions plus RMA, so that an Internet application can emit code that accesses private data in its own assemblies.</span></span> <span data-ttu-id="cf635-144">Erişim eşit veya daha düşük güven derlemeler için sınırlı olduğundan, Internet uygulamasını tam güvenilir derlemeler üyeleri gibi erişemiyor [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] derlemeler.</span><span class="sxs-lookup"><span data-stu-id="cf635-144">Because the access is limited to assemblies of equal or lesser trust, an Internet application cannot access members of fully trusted assemblies such as [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cf635-145">Anonim barındırılan dinamik yöntemler oluşturulan ayrıcalıkların önlemek için yığın bilgileri verme derleme için dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-145">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="cf635-146">Yöntem çağrıldığında, yığın bilgileri denetlenir.</span><span class="sxs-lookup"><span data-stu-id="cf635-146">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="cf635-147">Bu nedenle, tam güvenilen koddan çağrılan bir anonim barındırılan dinamik verme derleme güven düzeyini hala sınırlı yöntemidir.</span><span class="sxs-lookup"><span data-stu-id="cf635-147">Thus, an anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the emitting assembly.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust-plus-rma"></a><span data-ttu-id="cf635-148">Kısmi güven artı Madde iade ile bir uygulama etki alanı oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="cf635-148">To create an application domain with partial trust plus RMA</span></span>  
  
1.  <span data-ttu-id="cf635-149">Yeni bir <xref:System.Security.Permissions.ReflectionPermission> nesnesi ile <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (Madde iade) bayrak ve kullanmak <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> izin verme kümesine eklemek için yöntem.</span><span class="sxs-lookup"><span data-stu-id="cf635-149">Create a new <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (RMA) flag, and use the <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> method to add the permission to the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#7)]
     [!code-vb[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#7)]  
  
     <span data-ttu-id="cf635-150"><xref:System.Security.PermissionSet.AddPermission%2A> Yöntemi zaten dahil edilmezse ayarlamak grant izni ekler.</span><span class="sxs-lookup"><span data-stu-id="cf635-150">The <xref:System.Security.PermissionSet.AddPermission%2A> method adds the permission to the grant set if it is not already included.</span></span> <span data-ttu-id="cf635-151">İzin verme kümesinde zaten varsa, belirtilen bayrakları varolan izni eklenir.</span><span class="sxs-lookup"><span data-stu-id="cf635-151">If the permission is already included in the grant set, the specified flags are added to the existing permission.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cf635-152">Madde iade anonim barındırılan dinamik yöntemler özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="cf635-152">RMA is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="cf635-153">Sıradan dinamik yöntemler JIT görünürlük denetimleri atlarsa verilmiş kodu tam güven gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cf635-153">When ordinary dynamic methods skip JIT visibility checks, the emitted code requires full trust.</span></span>  
  
2.  <span data-ttu-id="cf635-154">Uygulama etki alanı kurulum bilgileri ve grant belirtme uygulama etki alanı oluşturma ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="cf635-154">Create the application domain, specifying the application domain setup information and the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#8)]
     [!code-vb[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#8)]  
  
<a name="Running_code"></a>   
## <a name="running-code-in-sandboxed-application-domains"></a><span data-ttu-id="cf635-155">Korumalı uygulama etki alanlarında çalışan kod</span><span class="sxs-lookup"><span data-stu-id="cf635-155">Running Code in Sandboxed Application Domains</span></span>  
 <span data-ttu-id="cf635-156">Aşağıdaki yordam bir uygulama etki alanında yürütülebilecek yöntemleri kullanarak bir sınıf tanımlama, etki alanında sınıfının bir örneğini oluşturmak nasıl ve yöntemlerinden yürütmek nasıl açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="cf635-156">The following procedure explains how to define a class by using methods that can be executed in an application domain, how to create an instance of the class in the domain, and how to execute its methods.</span></span>  
  
#### <a name="to-define-and-execute-a-method-in-an-application-domain"></a><span data-ttu-id="cf635-157">Bir uygulama etki alanında bir yöntem yürütülmeye ve tanımlamak için</span><span class="sxs-lookup"><span data-stu-id="cf635-157">To define and execute a method in an application domain</span></span>  
  
1.  <span data-ttu-id="cf635-158">Türeyen bir sınıf tanımlama <xref:System.MarshalByRefObject>.</span><span class="sxs-lookup"><span data-stu-id="cf635-158">Define a class that derives from <xref:System.MarshalByRefObject>.</span></span> <span data-ttu-id="cf635-159">Bu, diğer uygulama etki alanlarında sınıfının örneklerini oluşturmak ve uygulama etki alanı sınırlarında yöntemi çağrı yapmak için sağlar.</span><span class="sxs-lookup"><span data-stu-id="cf635-159">This enables you to create instances of the class in other application domains and to make method calls across application domain boundaries.</span></span> <span data-ttu-id="cf635-160">Bu örnekte sınıfı adlı `Worker`.</span><span class="sxs-lookup"><span data-stu-id="cf635-160">The class in this example is named `Worker`.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#10)]
     [!code-vb[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#10)]  
  
2.  <span data-ttu-id="cf635-161">Çalıştırmak istediğiniz kodu içeren bir ortak yöntemi tanımlayın.</span><span class="sxs-lookup"><span data-stu-id="cf635-161">Define a public method that contains the code you want to execute.</span></span> <span data-ttu-id="cf635-162">Bu örnekte, kod basit bir dinamik yöntem yayar, execute yöntemi için bir temsilci oluşturur ve temsilcisini çağırır.</span><span class="sxs-lookup"><span data-stu-id="cf635-162">In this example, the code emits a simple dynamic method, creates a delegate to execute the method, and invokes the delegate.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#11)]
     [!code-vb[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#11)]  
  
3.  <span data-ttu-id="cf635-163">Ana programınız derlemenizi görünen adını alır.</span><span class="sxs-lookup"><span data-stu-id="cf635-163">In your main program, get the display name of your assembly.</span></span> <span data-ttu-id="cf635-164">Örneklerini oluşturduğunuzda, bu ad kullanılır `Worker` korumalı uygulama etki alanında sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cf635-164">This name is used when you create instances of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#14)]
     [!code-vb[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#14)]  
  
4.  <span data-ttu-id="cf635-165">Bölümünde açıklandığı gibi bir korumalı uygulama etki alanı ana programınızı oluşturma [ilk yordam](#Setting_up) bu kılavuzda.</span><span class="sxs-lookup"><span data-stu-id="cf635-165">In your main program, create a sandboxed application domain, as described in [the first procedure](#Setting_up) in this walkthrough.</span></span> <span data-ttu-id="cf635-166">Herhangi bir izin eklemek zorunda değilsiniz `Internet` izni ayarla, çünkü `SimpleEmitDemo` yöntemi yalnızca ortak yöntemlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="cf635-166">You do not have to add any permissions to the `Internet` permission set, because the `SimpleEmitDemo` method uses only public methods.</span></span>  
  
5.  <span data-ttu-id="cf635-167">Ana programınız bir örneğini oluşturmak `Worker` korumalı uygulama etki alanında sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cf635-167">In your main program, create an instance of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#12)]
     [!code-vb[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#12)]  
  
     <span data-ttu-id="cf635-168"><xref:System.AppDomain.CreateInstanceAndUnwrap%2A> Yöntemi hedef uygulama etki alanı nesnesi oluşturur ve özellikleri ve yöntemleri nesnenin çağırmak için kullanılan bir proxy döndürür.</span><span class="sxs-lookup"><span data-stu-id="cf635-168">The <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method creates the object in the target application domain and returns a proxy that can be used to call the properties and methods of the object.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cf635-169">Bu kodda kullanırsanız [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], ad alanı içerecek şekilde sınıf adını değiştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="cf635-169">If you use this code in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace.</span></span> <span data-ttu-id="cf635-170">Varsayılan olarak, ad alanı, projeye adıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-170">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="cf635-171">Örneğin, "PartialTrust" projesiyse sınıf adı "PartialTrust.Worker" olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-171">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
6.  <span data-ttu-id="cf635-172">Çağırmak için kodu ekleyin `SimpleEmitDemo` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cf635-172">Add code to call the `SimpleEmitDemo` method.</span></span> <span data-ttu-id="cf635-173">Uygulama etki alanı sınırından çağrı sıralanmış ve kod korumalı uygulama etki alanında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="cf635-173">The call is marshaled across the application domain boundary, and the code is executed in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#13)]
     [!code-vb[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#13)]  
  
<a name="Using_methods"></a>   
## <a name="using-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="cf635-174">Kullanarak anonim barındırılan dinamik yöntemler</span><span class="sxs-lookup"><span data-stu-id="cf635-174">Using Anonymously Hosted Dynamic Methods</span></span>  
 <span data-ttu-id="cf635-175">Anonim barındırılan dinamik yöntemler sistem tarafından sağlanan saydam bir derleme ile ilişkilendirilmiş.</span><span class="sxs-lookup"><span data-stu-id="cf635-175">Anonymously hosted dynamic methods are associated with a transparent assembly that is provided by the system.</span></span> <span data-ttu-id="cf635-176">Bu nedenle, içerdikleri kod saydamdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-176">Therefore, the code they contain is transparent.</span></span> <span data-ttu-id="cf635-177">Sıradan dinamik yöntemler, diğer yandan olmalıdır var olan bir modül ile ilişkili (doğrudan belirtilen veya ilişkili bir türünden olup olmadığını) ve güvenlik düzeylerini bu modülden gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="cf635-177">Ordinary dynamic methods, on the other hand, must be associated with an existing module (whether directly specified or inferred from an associated type), and take their security level from that module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cf635-178">Dinamik yöntemi anonim barındırma sağlar derleme ile ilişkilendirmek için tek yolu aşağıdaki yordamda açıklanan oluşturucular kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="cf635-178">The only way to associate a dynamic method with the assembly that provides anonymous hosting is to use the constructors that are described in the following procedure.</span></span> <span data-ttu-id="cf635-179">Bu gibi durumlarda, bir modül açıkça anonim barındırma derlemede belirtemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="cf635-179">You cannot explicitly specify a module in the anonymous hosting assembly.</span></span>  
  
 <span data-ttu-id="cf635-180">Sıradan dinamik yöntemleri ile ilişkili modülün iç üyelere veya ile ilişkili türün özel üyeleri erişebilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-180">Ordinary dynamic methods have access to the internal members of the module they are associated with, or to the private members of the type they are associated with.</span></span> <span data-ttu-id="cf635-181">Anonim barındırılan dinamik yöntemler diğer koddan yalıtılmış olduğundan, bunlar özel verilere erişimi.</span><span class="sxs-lookup"><span data-stu-id="cf635-181">Because anonymously hosted dynamic methods are isolated from other code, they do not have access to private data.</span></span> <span data-ttu-id="cf635-182">Ancak, özel verilere erişmek için JIT görünürlük denetimlerini atlamak için sınırlı bir özelliği vardır.</span><span class="sxs-lookup"><span data-stu-id="cf635-182">However, they do have a restricted ability to skip JIT visibility checks to gain access to private data.</span></span> <span data-ttu-id="cf635-183">Güven düzeyleri eşit veya bu kod yayar derleme güven düzeyini değerinden olan derlemeler bu yeteneği sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-183">This ability is limited to assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="cf635-184">Anonim barındırılan dinamik yöntemler oluşturulan ayrıcalıkların önlemek için yığın bilgileri verme derleme için dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-184">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="cf635-185">Yöntem çağrıldığında, yığın bilgileri denetlenir.</span><span class="sxs-lookup"><span data-stu-id="cf635-185">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="cf635-186">Tam güvenilen koddan çağrılan anonim barındırılan dinamik bir yöntemi, gösterilen derleme güven düzeyini sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-186">An anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the assembly that emitted it.</span></span>  
  
#### <a name="to-use-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="cf635-187">Anonim olarak kullanmak için barındırılan dinamik yöntemler</span><span class="sxs-lookup"><span data-stu-id="cf635-187">To use anonymously hosted dynamic methods</span></span>  
  
-   <span data-ttu-id="cf635-188">Anonim barındırılan dinamik yöntemi bir ilişkilendirilmiş modülü ya da türü belirtmeyen bir Oluşturucu kullanarak oluşturun.</span><span class="sxs-lookup"><span data-stu-id="cf635-188">Create an anonymously hosted dynamic method by using a constructor that does not specify an associated module or type.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#15)]
     [!code-vb[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#15)]  
  
     <span data-ttu-id="cf635-189">Anonim barındırılan dinamik yöntemi yalnızca genel türler ve yöntemler kullanıyorsa, kısıtlı üye erişimi gerektirmez ve JIT görünürlük denetimlerini gerekmez.</span><span class="sxs-lookup"><span data-stu-id="cf635-189">If an anonymously hosted dynamic method uses only public types and methods, it does not require restricted member access and does not have to skip JIT visibility checks.</span></span>  
  
     <span data-ttu-id="cf635-190">Özel izinler dinamik yöntemi yayma için gereklidir, ancak verilmiş kod türleri ve yöntemleri kullanır tarafından talep edilen izinler gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cf635-190">No special permissions are required to emit a dynamic method, but the emitted code requires the permissions that are demanded by the types and methods it uses.</span></span> <span data-ttu-id="cf635-191">Örneğin, verilmiş kodu bir dosyaya eriştiğinde bir yöntemini çağırırsa, gerektirdiği <xref:System.Security.Permissions.FileIOPermission>.</span><span class="sxs-lookup"><span data-stu-id="cf635-191">For example, if the emitted code calls a method that accesses a file, it requires <xref:System.Security.Permissions.FileIOPermission>.</span></span> <span data-ttu-id="cf635-192">Güven düzeyi izni içermiyorsa verilmiş kod çalıştırıldığında bir güvenlik özel durum oluşur.</span><span class="sxs-lookup"><span data-stu-id="cf635-192">If the trust level does not include that permission, a security exception is thrown when the emitted code is executed.</span></span> <span data-ttu-id="cf635-193">Burada gösterilen kodu yalnızca kullanan dinamik bir yöntem yayar <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cf635-193">The code shown here emits a dynamic method that uses only the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="cf635-194">Bu nedenle, kodun, kısmen güvenilen konumlardan çalıştırılabilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-194">Therefore, the code can be executed from partially trusted locations.</span></span>  
  
-   <span data-ttu-id="cf635-195">Alternatif olarak, JIT görünürlük denetimleri kullanarak atlamak için kısıtlı yeteneği olan bir anonim barındırılan dinamik yöntemi oluşturun <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> oluşturucusu ve belirterek `true` için `restrictedSkipVisibility` parametresi.</span><span class="sxs-lookup"><span data-stu-id="cf635-195">Alternatively, create an anonymously hosted dynamic method with restricted ability to skip JIT visibility checks, by using the <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> constructor and specifying `true` for the `restrictedSkipVisibility` parameter.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#16)]
     [!code-vb[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#16)]  
  
     <span data-ttu-id="cf635-196">Anonim barındırılan dinamik yöntemi yalnızca güven düzeyleri eşit veya verme derleme güven düzeyini değerinden sahip derlemelerde özel verilere erişebilmesini kısıtlamadır.</span><span class="sxs-lookup"><span data-stu-id="cf635-196">The restriction is that the anonymously hosted dynamic method can access private data only in assemblies with trust levels equal to or less than the trust level of the emitting assembly.</span></span> <span data-ttu-id="cf635-197">Örneğin, dinamik yöntemi Internet güvenle yürütüyor, ayrıca Internet güvenle yürütülen diğer derlemelerden özel verilerine erişebilir, ancak özel verilerin erişemiyor [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] derlemeler.</span><span class="sxs-lookup"><span data-stu-id="cf635-197">For example, if the dynamic method is executing with Internet trust, it can access private data in other assemblies that are also executing with Internet trust, but it cannot access private data of [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span> [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]<span data-ttu-id="cf635-198">derlemeleri genel derleme önbelleğinde yüklenir ve her zaman tam güvenilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-198"> assemblies are installed in the global assembly cache and are always fully trusted.</span></span>  
  
     <span data-ttu-id="cf635-199">Anonim barındırılan dinamik yöntemler yalnızca ana bilgisayar uygulamasını verirse JIT görünürlük denetimlerini atlamak için kısıtlı özelliği kullanabilir <xref:System.Security.Permissions.ReflectionPermission> ile <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> bayrağı.</span><span class="sxs-lookup"><span data-stu-id="cf635-199">Anonymously hosted dynamic methods can use this restricted ability to skip JIT visibility checks only if the host application grants <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="cf635-200">Yöntem çağrıldığında bu izin için isteğe bağlı hale getirilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-200">The demand for this permission is made when the method is invoked.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cf635-201">Dinamik yöntemi oluşturulduğunda çağrı yığını bilgileri verme derleme için dahil edilmiştir.</span><span class="sxs-lookup"><span data-stu-id="cf635-201">Call stack information for the emitting assembly is included when the dynamic method is constructed.</span></span> <span data-ttu-id="cf635-202">Bu nedenle, talep verme derleme yöntemi çağırır derleme yerine izinleriyle karşı yapılır.</span><span class="sxs-lookup"><span data-stu-id="cf635-202">Therefore, the demand is made against the permissions of the emitting assembly instead of the assembly that invokes the method.</span></span> <span data-ttu-id="cf635-203">Bu, verilmiş kodu yükseltilmiş izinlerle yürütülen önler.</span><span class="sxs-lookup"><span data-stu-id="cf635-203">This prevents the emitted code from being executed with elevated permissions.</span></span>  
  
     <span data-ttu-id="cf635-204">[Tam kod örneği](#Example) bu kılavuzun sonunda kullanın ve kısıtlı üye erişimi sınırlamaları gösterir.</span><span class="sxs-lookup"><span data-stu-id="cf635-204">The [complete code example](#Example) at the end of this walkthrough demonstrates the use and limitations of restricted member access.</span></span> <span data-ttu-id="cf635-205">Kendi `Worker` sınıfı anonim barındırılan dinamik yöntemler ile veya olmadan sınırlı görünürlük denetimlerini olanağı oluşturabilirsiniz bir yöntem içerir ve bu yöntem farklı uygulama etki alanında yürütmenin sonucu örnek gösterir güven düzeyleri.</span><span class="sxs-lookup"><span data-stu-id="cf635-205">Its `Worker` class includes a method that can create anonymously hosted dynamic methods with or without the restricted ability to skip visibility checks, and the example shows the result of executing this method in application domains that have different trust levels.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cf635-206">Kısıtlı görünürlük denetimlerini olanağı anonim barındırılan dinamik yöntemler özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="cf635-206">The restricted ability to skip visibility checks is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="cf635-207">Sıradan dinamik yöntemler JIT görünürlük denetimleri atlarsa tam güven verilmelidir.</span><span class="sxs-lookup"><span data-stu-id="cf635-207">When ordinary dynamic methods skip JIT visibility checks, they must be granted full trust.</span></span>  
  
<a name="Example"></a>   
## <a name="example"></a><span data-ttu-id="cf635-208">Örnek</span><span class="sxs-lookup"><span data-stu-id="cf635-208">Example</span></span>  
  
### <a name="description"></a><span data-ttu-id="cf635-209">Açıklama</span><span class="sxs-lookup"><span data-stu-id="cf635-209">Description</span></span>  
 <span data-ttu-id="cf635-210">Aşağıdaki kod örneğinde kullanımını gösteren <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> anonim olarak izin vermek için bayrağı barındırılan ancak hedef üye kodu yayar derleme daha güven eşit veya daha düşük bir düzeyde olduğunda yalnızca JIT görünürlük denetimlerini atlamak için dinamik yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="cf635-210">The following code example demonstrates the use of the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> flag to allow anonymously hosted dynamic methods to skip JIT visibility checks, but only when the target member is at an equal or lower level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="cf635-211">Örnek tanımlayan bir `Worker` uygulama etki alanı sınırlarında sıralanabilir sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cf635-211">The example defines a `Worker` class that can be marshaled across application domain boundaries.</span></span> <span data-ttu-id="cf635-212">Sınıfın iki sahip `AccessPrivateMethod` yayma ve dinamik bir yöntem yürütülemez yöntemi aşırı.</span><span class="sxs-lookup"><span data-stu-id="cf635-212">The class has two `AccessPrivateMethod` method overloads that emit and execute dynamic methods.</span></span> <span data-ttu-id="cf635-213">İlk aşırı özel çağıran bir dinamik yöntemi yayar `PrivateMethod` yöntemi `Worker` sınıfı ve dinamik yöntemi ile veya olmadan JIT görünürlük denetimleri yayma.</span><span class="sxs-lookup"><span data-stu-id="cf635-213">The first overload emits a dynamic method that calls the private `PrivateMethod` method of the `Worker` class, and it can emit the dynamic method with or without JIT visibility checks.</span></span> <span data-ttu-id="cf635-214">İkinci aşırı erişen dinamik bir yöntem yayar bir `internal` özelliği (`Friend` özelliğine Visual Basic'te), <xref:System.String> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cf635-214">The second overload emits a dynamic method that accesses an `internal` property (`Friend` property in Visual Basic) of the <xref:System.String> class.</span></span>  
  
 <span data-ttu-id="cf635-215">Örnek, sınırlı ayarlamak grant oluşturmak için yardımcı bir yöntem kullanır. `Internet` izinleri ve bir uygulama etki alanı oluşturur kullanarak <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> etki alanında yürüten tüm kod bu verme kümesi kullandığını belirlemek için yöntemi aşırı yüklemesini.</span><span class="sxs-lookup"><span data-stu-id="cf635-215">The example uses a helper method to create a grant set limited to `Internet` permissions, and then creates an application domain, using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to specify that all code that executes in the domain uses this grant set.</span></span> <span data-ttu-id="cf635-216">Örnek bir örneğini oluşturur `Worker` sınıfı uygulama etki alanında ve yürütür `AccessPrivateMethod` yöntemi iki kez.</span><span class="sxs-lookup"><span data-stu-id="cf635-216">The example creates an instance of the `Worker` class in the application domain, and executes the `AccessPrivateMethod` method two times.</span></span>  
  
-   <span data-ttu-id="cf635-217">İlk kez `AccessPrivateMethod` yöntemi yürütüldüğünde, JIT görünürlük denetimleri zorlanmaz.</span><span class="sxs-lookup"><span data-stu-id="cf635-217">The first time the `AccessPrivateMethod` method is executed, JIT visibility checks are enforced.</span></span> <span data-ttu-id="cf635-218">Çağrıldığında, JIT görünürlük denetimleri özel yöntem erişimini engellemek için dinamik yöntemi başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="cf635-218">The dynamic method fails when it is invoked, because JIT visibility checks prevent it from accessing the private method.</span></span>  
  
-   <span data-ttu-id="cf635-219">İkinci kez `AccessPrivateMethod` yöntemi yürütüldüğünde, JIT görünürlük denetimleri atlanır.</span><span class="sxs-lookup"><span data-stu-id="cf635-219">The second time the `AccessPrivateMethod` method is executed, JIT visibility checks are skipped.</span></span> <span data-ttu-id="cf635-220">Derlendiğinde, çünkü dinamik yöntem başarısız `Internet` kümesi görünürlük denetimlerini atlamak için yeterli izinleri vermez verin.</span><span class="sxs-lookup"><span data-stu-id="cf635-220">The dynamic method fails when it is compiled, because the `Internet` grant set does not grant sufficient permissions to skip visibility checks.</span></span>  
  
 <span data-ttu-id="cf635-221">Örnek, <xref:System.Security.Permissions.ReflectionPermission> ile <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> grant ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="cf635-221">The example adds <xref:System.Security.Permissions.ReflectionPermission> with <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> to the grant set.</span></span> <span data-ttu-id="cf635-222">Örnek sonra ikinci bir etki alanı oluşturur, tüm kodu, etki alanında yürütür belirterek yeni verme kümesi izinler verilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-222">The example then creates a second domain, specifying that all code that executes in the domain is granted the permissions in the new grant set.</span></span> <span data-ttu-id="cf635-223">Örnek bir örneğini oluşturur `Worker` sınıfının yeni bir uygulama etki alanında ve her iki aşırı yürütür `AccessPrivateMethod` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cf635-223">The example creates an instance of the `Worker` class in the new application domain, and executes both overloads of the `AccessPrivateMethod` method.</span></span>  
  
-   <span data-ttu-id="cf635-224">İlk aşırı yüklemesini `AccessPrivateMethod` yöntemi yürütüldüğünde ve JIT görünürlük denetler atlanır.</span><span class="sxs-lookup"><span data-stu-id="cf635-224">The first overload of the `AccessPrivateMethod` method is executed, and JIT visibility checks are skipped.</span></span> <span data-ttu-id="cf635-225">Dinamik yöntemi derler ve kod yayar derleme özel yöntem içeren derlemenin aynı olduğundan başarıyla yürütür.</span><span class="sxs-lookup"><span data-stu-id="cf635-225">The dynamic method compiles and executes successfully, because the assembly that emits the code is the same as the assembly that contains the private method.</span></span> <span data-ttu-id="cf635-226">Bu nedenle, güven düzeyleri eşit.</span><span class="sxs-lookup"><span data-stu-id="cf635-226">Therefore, the trust levels are equal.</span></span> <span data-ttu-id="cf635-227">Uygulama, içeriyorsa `Worker` sınıfı birkaç derlemeleri açmış olduğunuz, bunların tümü aynı güven düzeyinde olacağından aynı işlemi bu derlemeler herhangi biri için başarılı.</span><span class="sxs-lookup"><span data-stu-id="cf635-227">If the application that contains the `Worker` class had several assemblies, the same process would succeed for any one of those assemblies, because they would all be at the same trust level.</span></span>  
  
-   <span data-ttu-id="cf635-228">İkinci aşırı yüklemesini `AccessPrivateMethod` yöntemi yürütüldüğünde ve yeniden atlanır JIT görünürlük denetler.</span><span class="sxs-lookup"><span data-stu-id="cf635-228">The second overload of the `AccessPrivateMethod` method is executed, and again JIT visibility checks are skipped.</span></span> <span data-ttu-id="cf635-229">Bu süre dinamik yöntem, derlendiğinde, erişmeye çalıştığı için başarısız `internal` `FirstChar` özelliği <xref:System.String> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cf635-229">This time the dynamic method fails when it is compiled, because it tries to access the `internal` `FirstChar` property of the <xref:System.String> class.</span></span> <span data-ttu-id="cf635-230">İçeren derlemenin <xref:System.String> sınıftır tam güvenilir.</span><span class="sxs-lookup"><span data-stu-id="cf635-230">The assembly that contains the <xref:System.String> class is fully trusted.</span></span> <span data-ttu-id="cf635-231">Bu nedenle, daha yüksek bir güven düzeyi kodu yayar derleme daha altındadır.</span><span class="sxs-lookup"><span data-stu-id="cf635-231">Therefore, it is at a higher level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="cf635-232">Bu karşılaştırma gösterir nasıl <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> etkinleştirir kısmen güvenilen kod görünürlük atlamak için güvenilen kod güvenliği tehlikeye atmadan diğer kısmen güvenilen kod için denetler.</span><span class="sxs-lookup"><span data-stu-id="cf635-232">This comparison shows how <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> enables partially trusted code to skip visibility checks for other partially trusted code without compromising the security of trusted code.</span></span>  
  
### <a name="code"></a><span data-ttu-id="cf635-233">Kod</span><span class="sxs-lookup"><span data-stu-id="cf635-233">Code</span></span>  
 [!code-csharp[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#1)]
 [!code-vb[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#1)]  
  
## <a name="compiling-the-code"></a><span data-ttu-id="cf635-234">Kod Derleniyor</span><span class="sxs-lookup"><span data-stu-id="cf635-234">Compiling the Code</span></span>  
  
-   <span data-ttu-id="cf635-235">Bu kod örneği yapı [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], kendisine geçirdiğinizde ad alanı içerecek şekilde sınıfın adını değiştirmeli <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cf635-235">If you build this code example in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace when you pass it to the <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method.</span></span> <span data-ttu-id="cf635-236">Varsayılan olarak, ad alanı, projeye adıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-236">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="cf635-237">Örneğin, "PartialTrust" projesiyse sınıf adı "PartialTrust.Worker" olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="cf635-237">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cf635-238">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="cf635-238">See Also</span></span>  
 [<span data-ttu-id="cf635-239">Güvenlik sorunları yansıma yayma</span><span class="sxs-lookup"><span data-stu-id="cf635-239">Security Issues in Reflection Emit</span></span>](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md)  
 [<span data-ttu-id="cf635-240">Nasıl yapılır: korumalı alanda kısmen güvenilen kodu çalıştırma</span><span class="sxs-lookup"><span data-stu-id="cf635-240">How to: Run Partially Trusted Code in a Sandbox</span></span>](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md)
