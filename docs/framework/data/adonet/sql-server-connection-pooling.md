---
title: "SQL Server bağlantı (ADO.NET) havuzu"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 7e51d44e-7c4e-4040-9332-f0190fe36f07
caps.latest.revision: "11"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.openlocfilehash: 18e83e629eb9736db054f239c6ffe3f30baf5ea4
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/21/2017
---
# <a name="sql-server-connection-pooling-adonet"></a><span data-ttu-id="f8769-102">SQL Server bağlantı (ADO.NET) havuzu</span><span class="sxs-lookup"><span data-stu-id="f8769-102">SQL Server Connection Pooling (ADO.NET)</span></span>
<span data-ttu-id="f8769-103">Genellikle bir veritabanı sunucusuna bağlanmayı zaman birkaç adımdan oluşur.</span><span class="sxs-lookup"><span data-stu-id="f8769-103">Connecting to a database server typically consists of several time-consuming steps.</span></span> <span data-ttu-id="f8769-104">Bir yuva veya bir adlandırılmış kanal gibi fiziksel bir kanal, sunucu ile ilk el sıkışma olmalıdır, kurulmalıdır bağlantı dizesi bilgilerini ayrıştırılır, bağlantı sunucu tarafından doğrulanması gerekir, denetimleri içinde kaydetme için çalıştırılması gerekir Geçerli hareket ve benzeri.</span><span class="sxs-lookup"><span data-stu-id="f8769-104">A physical channel such as a socket or a named pipe must be established, the initial handshake with the server must occur, the connection string information must be parsed, the connection must be authenticated by the server, checks must be run for enlisting in the current transaction, and so on.</span></span>  
  
 <span data-ttu-id="f8769-105">Uygulamada, çoğu uygulamayı bağlantıları için yalnızca bir veya birkaç farklı yapılandırmaları kullanın.</span><span class="sxs-lookup"><span data-stu-id="f8769-105">In practice, most applications use only one or a few different configurations for connections.</span></span> <span data-ttu-id="f8769-106">Bu uygulama yürütmesi sırasında birçok aynı bağlantıları art arda açılan kapalı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="f8769-106">This means that during application execution, many identical connections will be repeatedly opened and closed.</span></span> <span data-ttu-id="f8769-107">Bağlantılar, açma maliyetini en aza indirmek için [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] adında bir en iyi duruma getirme teknik kullanır *bağlantı havuzu*.</span><span class="sxs-lookup"><span data-stu-id="f8769-107">To minimize the cost of opening connections, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] uses an optimization technique called *connection pooling*.</span></span>  
  
 <span data-ttu-id="f8769-108">Bağlantı havuzu yeni bağlantıları açılmalıdır sayısını azaltır.</span><span class="sxs-lookup"><span data-stu-id="f8769-108">Connection pooling reduces the number of times that new connections must be opened.</span></span> <span data-ttu-id="f8769-109">*Havuzlayıcı* fiziksel bağlantı sahipliğini korur.</span><span class="sxs-lookup"><span data-stu-id="f8769-109">The *pooler* maintains ownership of the physical connection.</span></span> <span data-ttu-id="f8769-110">Etkin bağlantılar her verilen bağlantı yapılandırması için bir dizi canlı tutma tarafından bağlantılarını yönetir.</span><span class="sxs-lookup"><span data-stu-id="f8769-110">It manages connections by keeping alive a set of active connections for each given connection configuration.</span></span> <span data-ttu-id="f8769-111">Her bir kullanıcı çağırır `Open` bir bağlantıda bir bağlantı havuzundaki havuzlayıcı arar.</span><span class="sxs-lookup"><span data-stu-id="f8769-111">Whenever a user calls `Open` on a connection, the pooler looks for an available connection in the pool.</span></span> <span data-ttu-id="f8769-112">Havuza alınmış bir bağlantının kullanılabilir olması durumunda, bunu yeni bir bağlantı açarak yerine çağırana döndürür.</span><span class="sxs-lookup"><span data-stu-id="f8769-112">If a pooled connection is available, it returns it to the caller instead of opening a new connection.</span></span> <span data-ttu-id="f8769-113">Uygulama çağırdığında `Close` bağlantıda havuzlayıcı, kapatma yerine etkin bağlantıları havuza alınmış kümesini döndürür.</span><span class="sxs-lookup"><span data-stu-id="f8769-113">When the application calls `Close` on the connection, the pooler returns it to the pooled set of active connections instead of closing it.</span></span> <span data-ttu-id="f8769-114">Bağlantı havuza geri döndüğünde, sonraki yüklenmek için hazır `Open` çağırın.</span><span class="sxs-lookup"><span data-stu-id="f8769-114">Once the connection is returned to the pool, it is ready to be reused on the next `Open` call.</span></span>  
  
 <span data-ttu-id="f8769-115">Yalnızca aynı yapılandırmaya sahip bağlantılar havuza.</span><span class="sxs-lookup"><span data-stu-id="f8769-115">Only connections with the same configuration can be pooled.</span></span> [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="f8769-116">aynı zamanda, her yapılandırma için bir tane birkaç havuzu tutar.</span><span class="sxs-lookup"><span data-stu-id="f8769-116"> keeps several pools at the same time, one for each configuration.</span></span> <span data-ttu-id="f8769-117">Tümleşik güvenlik kullanıldığında bağlantıları bağlantı dizesi ve Windows Identity havuzlara ayrılır.</span><span class="sxs-lookup"><span data-stu-id="f8769-117">Connections are separated into pools by connection string, and by Windows identity when integrated security is used.</span></span> <span data-ttu-id="f8769-118">Bağlantılar olup bunlar işlemde kayıtlıdır üzerinde temel da verebilir.</span><span class="sxs-lookup"><span data-stu-id="f8769-118">Connections are also pooled based on whether they are enlisted in a transaction.</span></span> <span data-ttu-id="f8769-119">Kullanırken <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, <xref:System.Data.SqlClient.SqlCredential> örneği bağlantı havuzu etkiler.</span><span class="sxs-lookup"><span data-stu-id="f8769-119">When using <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, the <xref:System.Data.SqlClient.SqlCredential> instance affects the connection pool.</span></span> <span data-ttu-id="f8769-120">Farklı örnekleri <xref:System.Data.SqlClient.SqlCredential> kullanıcı kimliği ve parola aynı olsa bile farklı bağlantı havuzu kullanır.</span><span class="sxs-lookup"><span data-stu-id="f8769-120">Different instances of <xref:System.Data.SqlClient.SqlCredential> will use different connection pools, even if the user ID and password are the same.</span></span>  
  
 <span data-ttu-id="f8769-121">Bağlantı havuzu önemli ölçüde performans ve ölçeklenebilirlik, uygulamanızın geliştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f8769-121">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="f8769-122">Varsayılan olarak, bağlantı havuzu etkin [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8769-122">By default, connection pooling is enabled in [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span></span> <span data-ttu-id="f8769-123">Açıkça devre dışı sürece açılır ve uygulamanızda kapalı olarak havuzlayıcı bağlantıları en iyi duruma getirir.</span><span class="sxs-lookup"><span data-stu-id="f8769-123">Unless you explicitly disable it, the pooler optimizes the connections as they are opened and closed in your application.</span></span> <span data-ttu-id="f8769-124">Bağlantı havuzu oluşturma davranışını denetlemek için çeşitli bağlantı dizesi değiştiricileri de sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="f8769-124">You can also supply several connection string modifiers to control connection pooling behavior.</span></span> <span data-ttu-id="f8769-125">Daha fazla bilgi için bu konunun ilerleyen bölümlerinde "Denetleme bağlantı havuzu ile bağlantı dizesi anahtar sözcükler" konusuna bakın.</span><span class="sxs-lookup"><span data-stu-id="f8769-125">For more information, see "Controlling Connection Pooling with Connection String Keywords" later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f8769-126">Bağlantı havuzu etkin olduğunda ve bir zaman aşımı hatası veya başka bir oturum açma hata oluşursa, bir özel durum ve sonraki beş için "engelleme süresini saniye" sonraki bağlantı girişimleri başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="f8769-126">When connection pooling is enabled, and if a timeout error or other login error occurs, an exception will be thrown and subsequent connection attempts will fail for the next five seconds, the "blocking period".</span></span> <span data-ttu-id="f8769-127">Uygulama engelleme süresi içinde bağlanmaya çalışırsa, ilk özel durum yeniden oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="f8769-127">If the application attempts to connect within the blocking period, the first exception will be thrown again.</span></span> <span data-ttu-id="f8769-128">Engelleme süresi sona erdikten sonra sonraki hataları iki kez önceki engelleme süresi en fazla bir dakika sürece yeni bir engelleme nokta sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="f8769-128">Subsequent failures after a blocking period ends will result in a new blocking periods that is twice as long as the previous blocking period, up to a maximum of one minute.</span></span>  
  
## <a name="pool-creation-and-assignment"></a><span data-ttu-id="f8769-129">Havuz oluşturma ve atama</span><span class="sxs-lookup"><span data-stu-id="f8769-129">Pool Creation and Assignment</span></span>  
 <span data-ttu-id="f8769-130">Bir bağlantı ilk kez açıldığında, bağlantı havuzu bağlantı dizesini içeren bağlantı havuzu ilişkilendirir tam bir eşleştirme algoritması temel alınarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="f8769-130">When a connection is first opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="f8769-131">Her bağlantı havuzu ayrı bağlantı dizesi ile ilişkilidir.</span><span class="sxs-lookup"><span data-stu-id="f8769-131">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="f8769-132">Yeni bir bağlantı açıldığında, bağlantı dizesi var olan bir havuzu için tam bir eşleşme değilse yeni bir havuz oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="f8769-132">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span> <span data-ttu-id="f8769-133">Uygulama etki alanı, bağlantı dizesi başına ve tümleşik güvenlik kullanıldığında, Windows kimlik her işlem başına bağlantılar havuza.</span><span class="sxs-lookup"><span data-stu-id="f8769-133">Connections are pooled per process, per application domain, per connection string and when integrated security is used, per Windows identity.</span></span> <span data-ttu-id="f8769-134">Bağlantı dizeleri de tam eşleşme olmalıdır; anahtar sözcükler, aynı bağlantı için farklı bir sırayla sağlanan ayrı olarak havuza.</span><span class="sxs-lookup"><span data-stu-id="f8769-134">Connection strings must also be an exact match; keywords supplied in a different order for the same connection will be pooled separately.</span></span>  
  
 <span data-ttu-id="f8769-135">Aşağıdaki örnekte C#, yeni üç <xref:System.Data.SqlClient.SqlConnection> nesneler oluşturulur, ancak yalnızca iki bağlantı havuzu bunları yönetmek için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="f8769-135">In the following C# example, three new <xref:System.Data.SqlClient.SqlConnection> objects are created, but only two connection pools are required to manage them.</span></span> <span data-ttu-id="f8769-136">Birinci ve ikinci bağlantı dizeleri için atanan değer tarafından farklı Not `Initial Catalog`.</span><span class="sxs-lookup"><span data-stu-id="f8769-136">Note that the first and second connection strings differ by the value assigned for `Initial Catalog`.</span></span>  
  
```  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // Pool A is created.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=pubs"))  
    {  
        connection.Open();        
        // Pool B is created because the connection strings differ.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // The connection string matches pool A.  
    }  
```  
  
 <span data-ttu-id="f8769-137">Varsa `MinPoolSize` ya da bağlantı dizesinde belirtilmedi veya belirtilen sıfır olarak bağlantıları havuzundaki bir süre işlem yapılmadığında kapatılacak.</span><span class="sxs-lookup"><span data-stu-id="f8769-137">If `MinPoolSize` is either not specified in the connection string or is specified as zero, the connections in the pool will be closed after a period of inactivity.</span></span> <span data-ttu-id="f8769-138">Ancak, belirtilen `MinPoolSize` , sıfırdan büyük bağlantı havuzu kadar yok edilmez `AppDomain` kaldırılır ve işlem sona erer.</span><span class="sxs-lookup"><span data-stu-id="f8769-138">However, if the specified `MinPoolSize` is greater than zero, the connection pool is not destroyed until the `AppDomain` is unloaded and the process ends.</span></span> <span data-ttu-id="f8769-139">Etkin olmayan ya da boş havuzlarının bakım minimum sistem yükünü içerir.</span><span class="sxs-lookup"><span data-stu-id="f8769-139">Maintenance of inactive or empty pools involves minimal system overhead.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f8769-140">Önemli bir hata oluştuğunda bir yük devretme gibi havuzu otomatik olarak temizlenir.</span><span class="sxs-lookup"><span data-stu-id="f8769-140">The pool is automatically cleared when a fatal error occurs, such as a failover.</span></span>  
  
## <a name="adding-connections"></a><span data-ttu-id="f8769-141">Bağlantıları ekleme</span><span class="sxs-lookup"><span data-stu-id="f8769-141">Adding Connections</span></span>  
 <span data-ttu-id="f8769-142">Bağlantı havuzu her benzersiz bağlantı dizesi için oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="f8769-142">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="f8769-143">Bir havuz oluşturduğunuzda, birden çok bağlantı nesneleri oluşturulur ve böylece en küçük havuz boyutu gereksinimini sağlanıyorsa havuzuna eklenir.</span><span class="sxs-lookup"><span data-stu-id="f8769-143">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="f8769-144">Bağlantılar, havuza eklendiğinde, gerektiğinde, belirtilen en büyük havuz boyutu kadar (varsayılan değer 100'dır).</span><span class="sxs-lookup"><span data-stu-id="f8769-144">Connections are added to the pool as needed, up to the maximum pool size specified (100 is the default).</span></span> <span data-ttu-id="f8769-145">Kapalı veya elden bağlantıları geri havuza yayınlanır.</span><span class="sxs-lookup"><span data-stu-id="f8769-145">Connections are released back into the pool when they are closed or disposed.</span></span>  
  
 <span data-ttu-id="f8769-146">Zaman bir <xref:System.Data.SqlClient.SqlConnection> nesnesi istendi, kullanılabilir bir bağlantının kullanılabilir olması durumunda havuzundan elde edilir.</span><span class="sxs-lookup"><span data-stu-id="f8769-146">When a <xref:System.Data.SqlClient.SqlConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="f8769-147">Kullanılabilmesi için bir bağlantı gerekir kullanılmayan, eşleşen bir işlem bağlamına sahip veya hiçbir işlem içerikle ilişkilendirilmemiş ve sunucu için geçerli bir bağlantı vardır.</span><span class="sxs-lookup"><span data-stu-id="f8769-147">To be usable, a connection must be unused, have a matching transaction context or be unassociated with any transaction context, and have a valid link to the server.</span></span>  
  
 <span data-ttu-id="f8769-148">Bağlantı havuzlayıcı geri havuza en bağlantıları yeniden ayırma bağlantıları isteklerini karşılar.</span><span class="sxs-lookup"><span data-stu-id="f8769-148">The connection pooler satisfies requests for connections by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="f8769-149">En büyük havuz boyutuna ulaştı ve kullanılabilir bağlantı yok, istek sıraya alındı.</span><span class="sxs-lookup"><span data-stu-id="f8769-149">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="f8769-150">Zaman aşımı ulaşılana kadar tüm bağlantılar geri kazanmak daha sonra havuzlayıcı çalışır (varsayılan değer 15 saniyedir).</span><span class="sxs-lookup"><span data-stu-id="f8769-150">The pooler then tries to reclaim any connections until the time-out is reached (the default is 15 seconds).</span></span> <span data-ttu-id="f8769-151">Bağlantı zaman aşımına uğramadan önce havuzlayıcı isteği gerçekleştiremiyor, özel durum oluşur.</span><span class="sxs-lookup"><span data-stu-id="f8769-151">If the pooler cannot satisfy the request before the connection times out, an exception is thrown.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="f8769-152">Böylece bağlantı havuza geri döner işiniz bittiğinde, her zaman bağlantı kapatmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="f8769-152">We strongly recommend that you always close the connection when you are finished using it so that the connection will be returned to the pool.</span></span> <span data-ttu-id="f8769-153">Kullanarak bunu yapabilirsiniz `Close` veya `Dispose` yöntemlerinin `Connection` nesne veya göre içindeki tüm bağlantılar'ı açma bir `using` C# ' ta, deyimi veya `Using` deyiminde [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8769-153">You can do this using either the `Close` or `Dispose` methods of the `Connection` object, or by opening all connections inside a `using` statement in C#, or a `Using` statement in [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span></span> <span data-ttu-id="f8769-154">Açıkça kapatılmamış bağlantıları eklenemez veya havuza geri döner.</span><span class="sxs-lookup"><span data-stu-id="f8769-154">Connections that are not explicitly closed might not be added or returned to the pool.</span></span> <span data-ttu-id="f8769-155">Daha fazla bilgi için bkz: [deyimiyle](~/docs/csharp/language-reference/keywords/using-statement.md) veya [nasıl yapılır: bir sistem kaynağını atma](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) için [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8769-155">For more information, see [using Statement](~/docs/csharp/language-reference/keywords/using-statement.md) or [How to: Dispose of a System Resource](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) for [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f8769-156">Çağırmayın `Close` veya `Dispose` üzerinde bir `Connection`, `DataReader`, veya diğer yönetilen nesne içinde `Finalize` sınıfınızın yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f8769-156">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="f8769-157">Bir Sonlandırıcı, yalnızca sınıfınız doğrudan sahibi yönetilmeyen kaynakları serbest bırakmak.</span><span class="sxs-lookup"><span data-stu-id="f8769-157">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="f8769-158">Sınıfınıza yönetilmeyen kaynakları sahip olmadığından, içermeyen bir `Finalize` Sınıf tanımınız yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f8769-158">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="f8769-159">Daha fazla bilgi için bkz: [çöp toplama](../../../../docs/standard/garbage-collection/index.md).</span><span class="sxs-lookup"><span data-stu-id="f8769-159">For more information, see [Garbage Collection](../../../../docs/standard/garbage-collection/index.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f8769-160">Bir bağlantı öğesinden alınan ya da bağlantı havuza geri döner sunucuda oturum açma ve kapatma olayları oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="f8769-160">Login and logout events will not be raised on the server when a connection is fetched from or returned to the connection pool.</span></span> <span data-ttu-id="f8769-161">Bağlantı havuzu döndürüldüğünde bağlantı gerçekte kapalı olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="f8769-161">This is because the connection is not actually closed when it is returned to the connection pool.</span></span> <span data-ttu-id="f8769-162">Daha fazla bilgi için bkz: [denetim oturum açma olay sınıfı](http://msdn2.microsoft.com/library/ms190260.aspx) ve [denetim oturum kapatma olay sınıfı](http://msdn2.microsoft.com/library/ms175827.aspx) içinde [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] Books Online.</span><span class="sxs-lookup"><span data-stu-id="f8769-162">For more information, see [Audit Login Event Class](http://msdn2.microsoft.com/library/ms190260.aspx) and [Audit Logout Event Class](http://msdn2.microsoft.com/library/ms175827.aspx) in [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
## <a name="removing-connections"></a><span data-ttu-id="f8769-163">Bağlantıları kaldırma</span><span class="sxs-lookup"><span data-stu-id="f8769-163">Removing Connections</span></span>  
 <span data-ttu-id="f8769-164">Bağlantı havuzlayıcı yaklaşık 4-8 dakika boşta kaldıktan sonra ya da havuzlayıcı sunucusuyla bağlantı zarar görmesi olduğunu algılarsa havuzundan bir bağlantıyı kaldırır.</span><span class="sxs-lookup"><span data-stu-id="f8769-164">The connection pooler removes a connection from the pool after it has been idle for approximately 4-8 minutes, or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="f8769-165">Kesilen bağlantı yalnızca sunucusuyla iletişim kurmaya sonra algılanabilmesi unutmayın.</span><span class="sxs-lookup"><span data-stu-id="f8769-165">Note that a severed connection can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="f8769-166">Bir bağlantı, artık sunucuya bağlı bulunursa, geçersiz olarak işaretlendi.</span><span class="sxs-lookup"><span data-stu-id="f8769-166">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="f8769-167">Yalnızca bunlar iadesi ya da kapatıldığında geçersiz bağlantıları bağlantı havuzundan kaldırılır.</span><span class="sxs-lookup"><span data-stu-id="f8769-167">Invalid connections are removed from the connection pool only when they are closed or reclaimed.</span></span>  
  
 <span data-ttu-id="f8769-168">Bir bağlantı kayboldu bir sunucuya varsa, bağlantı havuzlayıcı kesilen bağlantı algıladı değil ve geçersiz olarak işaretlenmiş olsa bile bu bağlantı havuzundan çizilebilir.</span><span class="sxs-lookup"><span data-stu-id="f8769-168">If a connection exists to a server that has disappeared, this connection can be drawn from the pool even if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="f8769-169">Başka bir gidiş dönüş gerçekleşmesi için sunucuya neden olan bir havuzlayıcı sahip avantajlarını bağlantı hala geçerli olduğunu denetleme yükünü ortadan kaldırır çünkü bu durumdur.</span><span class="sxs-lookup"><span data-stu-id="f8769-169">This is the case because the overhead of checking that the connection is still valid would eliminate the benefits of having a pooler by causing another round trip to the server to occur.</span></span> <span data-ttu-id="f8769-170">Bu durumda, ilk bağlantı kullanma girişimi bağlantı zarar görmesi ve bir özel durum algılar.</span><span class="sxs-lookup"><span data-stu-id="f8769-170">When this occurs, the first attempt to use the connection will detect that the connection has been severed, and an exception is thrown.</span></span>  
  
## <a name="clearing-the-pool"></a><span data-ttu-id="f8769-171">Havuz temizleme</span><span class="sxs-lookup"><span data-stu-id="f8769-171">Clearing the Pool</span></span>  
 [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="f8769-172">2.0 sunulan havuzu temizlemek için iki yeni yöntemleri: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> ve <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span><span class="sxs-lookup"><span data-stu-id="f8769-172"> 2.0 introduced two new methods to clear the pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> and <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span></span> <span data-ttu-id="f8769-173">`ClearAllPools`bağlantı havuzu için belirli bir sağlayıcı, temizler ve `ClearPool` belirli bir bağlantı ile ilişkili bağlantı havuzu temizler.</span><span class="sxs-lookup"><span data-stu-id="f8769-173">`ClearAllPools` clears the connection pools for a given provider, and `ClearPool` clears the connection pool that is associated with a specific connection.</span></span> <span data-ttu-id="f8769-174">Çağrı aynı anda kullanılan bağlantılarının varsa, bunlar uygun şekilde işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="f8769-174">If there are connections being used at the time of the call, they are marked appropriately.</span></span> <span data-ttu-id="f8769-175">Kapatıldığında, havuza geri döner yerine atılır.</span><span class="sxs-lookup"><span data-stu-id="f8769-175">When they are closed, they are discarded instead of being returned to the pool.</span></span>  
  
## <a name="transaction-support"></a><span data-ttu-id="f8769-176">İşlem desteği</span><span class="sxs-lookup"><span data-stu-id="f8769-176">Transaction Support</span></span>  
 <span data-ttu-id="f8769-177">Bağlantı havuzu ve atanan göre işlem bağlamı çizilir.</span><span class="sxs-lookup"><span data-stu-id="f8769-177">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="f8769-178">Sürece `Enlist=false` belirtilen bağlantı dizesinde bağlantı havuzu yapar bağlantı kayıtlı emin olarak <xref:System.Transactions.Transaction.Current%2A> bağlamı.</span><span class="sxs-lookup"><span data-stu-id="f8769-178">Unless `Enlist=false` is specified in the connection string, the connection pool makes sure that the connection is enlisted in the <xref:System.Transactions.Transaction.Current%2A> context.</span></span> <span data-ttu-id="f8769-179">Ne zaman bir bağlantı kapatılır ve bir kayıtlı havuzuyla döndürülen `System.Transactions` işlem, bu ayarlanmış kenara sonraki aynı o bağlantı havuzu için istek şekilde `System.Transactions` işlem varsa aynı bağlantıyı döndürür.</span><span class="sxs-lookup"><span data-stu-id="f8769-179">When a connection is closed and returned to the pool with an enlisted `System.Transactions` transaction, it is set aside in such a way that the next request for that connection pool with the same `System.Transactions` transaction will return the same connection if it is available.</span></span> <span data-ttu-id="f8769-180">Böyle bir istek verilir ve havuza alınan bağlantı kullanılabilir değilse, bir bağlantı havuzu işlem temelli olmayan bölümünden çizilmiş ve kayıtlı.</span><span class="sxs-lookup"><span data-stu-id="f8769-180">If such a request is issued, and there are no pooled connections available, a connection is drawn from the non-transacted part of the pool and enlisted.</span></span> <span data-ttu-id="f8769-181">Bağlantı havuzu ya da alanında varsa, yeni bir bağlantı oluşturulur ve kayıtlı.</span><span class="sxs-lookup"><span data-stu-id="f8769-181">If no connections are available in either area of the pool, a new connection is created and enlisted.</span></span>  
  
 <span data-ttu-id="f8769-182">Bağlantı kapalı olduğunda geri havuza ve kendi işlem bağlamına dayalı uygun alt bölümü olarak yayımlanır.</span><span class="sxs-lookup"><span data-stu-id="f8769-182">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="f8769-183">Dağıtılmış işlem hala olsa bile bu nedenle, bağlantı bir hata oluşturmadan kapatabilirsiniz bekliyor.</span><span class="sxs-lookup"><span data-stu-id="f8769-183">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="f8769-184">Bu, tamamlama veya dağıtılmış işlem daha sonra iptal olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="f8769-184">This allows you to commit or abort the distributed transaction later.</span></span>  
  
## <a name="controlling-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="f8769-185">Bağlantı dizesi anahtar sözcükleriyle bağlantı havuzu denetleme</span><span class="sxs-lookup"><span data-stu-id="f8769-185">Controlling Connection Pooling with Connection String Keywords</span></span>  
 <span data-ttu-id="f8769-186">`ConnectionString` Özelliği <xref:System.Data.SqlClient.SqlConnection> nesnesi bağlantı mantığı havuzu davranışını ayarlamak için kullanılan bağlantı dizesi anahtar/değer çiftlerinin destekler.</span><span class="sxs-lookup"><span data-stu-id="f8769-186">The `ConnectionString` property of the <xref:System.Data.SqlClient.SqlConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span> <span data-ttu-id="f8769-187">Daha fazla bilgi için bkz. <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="f8769-187">For more information, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
## <a name="pool-fragmentation"></a><span data-ttu-id="f8769-188">Havuzu parçalanması</span><span class="sxs-lookup"><span data-stu-id="f8769-188">Pool Fragmentation</span></span>  
 <span data-ttu-id="f8769-189">Havuzu parçalanması ortak birçok Web uygulamaları burada uygulama çok sayıda işlem çıkar kadar serbest bırakılmaz havuzları oluşturabilirsiniz sorunudur.</span><span class="sxs-lookup"><span data-stu-id="f8769-189">Pool fragmentation is a common problem in many Web applications where the application can create a large number of pools that are not freed until the process exits.</span></span> <span data-ttu-id="f8769-190">Bu, çok sayıda bağlantıları performansın düşmesine neden olur, açık ve alan bellek bırakır.</span><span class="sxs-lookup"><span data-stu-id="f8769-190">This leaves a large number of connections open and consuming memory, which results in poor performance.</span></span>  
  
### <a name="pool-fragmentation-due-to-integrated-security"></a><span data-ttu-id="f8769-191">Tümleşik güvenlik nedeniyle havuzu parçalanması</span><span class="sxs-lookup"><span data-stu-id="f8769-191">Pool Fragmentation Due to Integrated Security</span></span>  
 <span data-ttu-id="f8769-192">Bağlantılar bağlantı dizesini ve kullanıcı kimliği göre havuza.</span><span class="sxs-lookup"><span data-stu-id="f8769-192">Connections are pooled according to the connection string plus the user identity.</span></span> <span data-ttu-id="f8769-193">Bu nedenle, Web sitesi ve bir tümleşik güvenlik oturumu temel kimlik doğrulaması veya Windows kimlik doğrulaması kullanıyorsanız, kullanıcı başına bir havuzu alın.</span><span class="sxs-lookup"><span data-stu-id="f8769-193">Therefore, if you use Basic authentication or Windows Authentication on the Web site and an integrated security login, you get one pool per user.</span></span> <span data-ttu-id="f8769-194">Bu tek bir kullanıcı için sonraki veritabanı isteklerinin performansını iyileştirir karşın, bu kullanıcının diğer kullanıcılar tarafından yapılan bağlantılarının yararlanamaz.</span><span class="sxs-lookup"><span data-stu-id="f8769-194">Although this improves the performance of subsequent database requests for a single user, that user cannot take advantage of connections made by other users.</span></span> <span data-ttu-id="f8769-195">Veritabanı sunucusu için kullanıcı başına en az bir bağlantı da sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="f8769-195">It also results in at least one connection per user to the database server.</span></span> <span data-ttu-id="f8769-196">Geliştiriciler, güvenlik ve denetim gereksinimlerini karşı tartmanız gerekir belirli bir Web uygulama mimarinin bir yan etkisi budur.</span><span class="sxs-lookup"><span data-stu-id="f8769-196">This is a side effect of a particular Web application architecture that developers must weigh against security and auditing requirements.</span></span>  
  
### <a name="pool-fragmentation-due-to-many-databases"></a><span data-ttu-id="f8769-197">Birçok veritabanı nedeniyle havuzu parçalanması</span><span class="sxs-lookup"><span data-stu-id="f8769-197">Pool Fragmentation Due to Many Databases</span></span>  
 <span data-ttu-id="f8769-198">Çoğu Internet hizmet sağlayıcıları tek bir sunucu üzerinde çeşitli Web sitelerini barındırır.</span><span class="sxs-lookup"><span data-stu-id="f8769-198">Many Internet service providers host several Web sites on a single server.</span></span> <span data-ttu-id="f8769-199">Tek bir veritabanı Forms kimlik doğrulaması oturum açma onaylayın ve ardından kullanıcı veya kullanıcı grubu için belirli bir veritabanına bir bağlantı açmak için kullandıkları.</span><span class="sxs-lookup"><span data-stu-id="f8769-199">They may use a single database to confirm a Forms authentication login and then open a connection to a specific database for that user or group of users.</span></span> <span data-ttu-id="f8769-200">Kimlik doğrulama veritabanı bağlantısı havuza ve herkes tarafından kullanılır.</span><span class="sxs-lookup"><span data-stu-id="f8769-200">The connection to the authentication database is pooled and used by everyone.</span></span> <span data-ttu-id="f8769-201">Ancak, sunucuya bağlantı sayısını artıracak bağlantıları her veritabanı için ayrı bir havuz yoktur.</span><span class="sxs-lookup"><span data-stu-id="f8769-201">However, there is a separate pool of connections to each database, which increase the number of connections to the server.</span></span>  
  
 <span data-ttu-id="f8769-202">Bu uygulama tasarımının bir yan etkisi de geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="f8769-202">This is also a side-effect of the application design.</span></span> <span data-ttu-id="f8769-203">Bağlandığınızda, güvenliği tehlikeye atmadan bu yan etkiyi önlemek için oldukça basit bir yolu yoktur [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8769-203">There is a relatively simple way to avoid this side effect without compromising security when you connect to [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f8769-204">Her kullanıcı veya grup için ayrı bir veritabanına bağlanmak, yerine sunucuda aynı veritabanına bağlanın ve sonra yürütün [!INCLUDE[tsql](../../../../includes/tsql-md.md)] istenilen veritabanına değiştirmek için deyimi kullanın.</span><span class="sxs-lookup"><span data-stu-id="f8769-204">Instead of connecting to a separate database for each user or group, connect to the same database on the server and then execute the [!INCLUDE[tsql](../../../../includes/tsql-md.md)] USE statement to change to the desired database.</span></span> <span data-ttu-id="f8769-205">Aşağıdaki kod parçası ilk bağlantınız oluşturmayı gösterir `master` veritabanı ve belirtilen istenen veritabanına geçiş `databaseName` dize değişkeni.</span><span class="sxs-lookup"><span data-stu-id="f8769-205">The following code fragment demonstrates creating an initial connection to the `master` database and then switching to the desired database specified in the `databaseName` string variable.</span></span>  
  
```vb  
' Assumes that command is a valid SqlCommand object and that  
' connectionString connects to master.  
    command.Text = "USE DatabaseName"  
Using connection As New SqlConnection(connectionString)  
    connection.Open()  
    command.ExecuteNonQuery()  
End Using  
```  
  
```csharp  
// Assumes that command is a SqlCommand object and that  
// connectionString connects to master.  
command.Text = "USE DatabaseName";  
using (SqlConnection connection = new SqlConnection(  
  connectionString))  
  {  
    connection.Open();  
    command.ExecuteNonQuery();  
  }  
```  
  
## <a name="application-roles-and-connection-pooling"></a><span data-ttu-id="f8769-206">Uygulama rolleri ve bağlantı havuzu</span><span class="sxs-lookup"><span data-stu-id="f8769-206">Application Roles and Connection Pooling</span></span>  
 <span data-ttu-id="f8769-207">Sonra bir [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] uygulama rolü etkinleştirilmiş çağırarak `sp_setapprole` sistem saklı yordamı, bu bağlantının güvenlik bağlamı sıfırlayamazsınız.</span><span class="sxs-lookup"><span data-stu-id="f8769-207">After a [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] application role has been activated by calling the `sp_setapprole` system stored procedure, the security context of that connection cannot be reset.</span></span> <span data-ttu-id="f8769-208">Ancak, havuzu etkinleştirilirse bağlantı havuza geri döner ve havuza alınan bağlantı yeniden denediğinizde hata oluşur.</span><span class="sxs-lookup"><span data-stu-id="f8769-208">However, if pooling is enabled, the connection is returned to the pool, and an error occurs when the pooled connection is reused.</span></span> <span data-ttu-id="f8769-209">Daha fazla bilgi için bkz. Bilgi Bankası makalesi, "[OLE DB kaynak havuzu ile SQL uygulama rolü hataları](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span><span class="sxs-lookup"><span data-stu-id="f8769-209">For more information, see the Knowledge Base article, "[SQL application role errors with OLE DB resource pooling](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span></span>  
  
### <a name="application-role-alternatives"></a><span data-ttu-id="f8769-210">Uygulama rolü alternatifleri</span><span class="sxs-lookup"><span data-stu-id="f8769-210">Application Role Alternatives</span></span>  
 <span data-ttu-id="f8769-211">Uygulama rolleri yerine kullanabileceğiniz güvenlik mekanizmaları avantajlarından yararlanmak öneririz.</span><span class="sxs-lookup"><span data-stu-id="f8769-211">We recommend that you take advantage of security mechanisms that you can use instead of application roles.</span></span> <span data-ttu-id="f8769-212">Daha fazla bilgi için bkz: [SQL Server'daki uygulama rolleri oluşturma](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f8769-212">For more information, see [Creating Application Roles in SQL Server](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f8769-213">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="f8769-213">See Also</span></span>  
 [<span data-ttu-id="f8769-214">Bağlantı havuzu</span><span class="sxs-lookup"><span data-stu-id="f8769-214">Connection Pooling</span></span>](../../../../docs/framework/data/adonet/connection-pooling.md)  
 [<span data-ttu-id="f8769-215">SQL Server ve ADO.NET</span><span class="sxs-lookup"><span data-stu-id="f8769-215">SQL Server and ADO.NET</span></span>](../../../../docs/framework/data/adonet/sql/index.md)  
 [<span data-ttu-id="f8769-216">Performans sayaçları</span><span class="sxs-lookup"><span data-stu-id="f8769-216">Performance Counters</span></span>](../../../../docs/framework/data/adonet/performance-counters.md)  
 [<span data-ttu-id="f8769-217">ADO.NET yönetilen sağlayıcıları ve veri kümesi Geliştirici Merkezi</span><span class="sxs-lookup"><span data-stu-id="f8769-217">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
