---
title: "Kimliğe bürünme SQL Server'daki izinlerle özelleştirme"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: dc733d09-1d6d-4af0-9c4b-8d24504860f1
caps.latest.revision: "6"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 7175542d8a9441d9f0d3eeb05acc67cf12d6a270
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/17/2018
---
# <a name="customizing-permissions-with-impersonation-in-sql-server"></a><span data-ttu-id="d2ca4-102">Kimliğe bürünme SQL Server'daki izinlerle özelleştirme</span><span class="sxs-lookup"><span data-stu-id="d2ca4-102">Customizing Permissions with Impersonation in SQL Server</span></span>
<span data-ttu-id="d2ca4-103">Birçok uygulama, sahipliği tablolar temel erişimi kısıtlamak için zincirleme bağlı olan verilere erişmek için saklı yordamları kullanın.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-103">Many applications use stored procedures to access data, relying on ownership chaining to restrict access to base tables.</span></span> <span data-ttu-id="d2ca4-104">Saklı yordamlar, yürütme izinlerini iptal etme veya reddetme temel tablolar üzerindeki izinleri verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-104">You can grant EXECUTE permissions on stored procedures, revoking or denying permissions on the base tables.</span></span> <span data-ttu-id="d2ca4-105">Tabloları ve saklı yordam aynı sahip varsa, SQL Server çağıran izinleri denetlemez.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-105">SQL Server does not check the permissions of the caller if the stored procedure and tables have the same owner.</span></span> <span data-ttu-id="d2ca4-106">Ancak, sahipliği zincirleme nesneleri farklı sahipleri varsa veya dinamik SQL söz konusu olduğunda işe yaramaz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-106">However, ownership chaining doesn't work if objects have different owners or in the case of dynamic SQL.</span></span>  
  
 <span data-ttu-id="d2ca4-107">Kullanabileceğiniz EXECUTE AS yan tümcesinde başvurulan veritabanı nesneleri üzerinde çağıran izinlere sahip olmadığında bir saklı yordam.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-107">You can use the EXECUTE AS clause in a stored procedure when the caller doesn't have permissions on the referenced database objects.</span></span> <span data-ttu-id="d2ca4-108">Etkisi EXECUTE AS yan tümcesi yürütme bağlamı proxy kullanıcıya anahtarlanır olduğu.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-108">The effect of the EXECUTE AS clause is that the execution context is switched to the proxy user.</span></span> <span data-ttu-id="d2ca4-109">İç içe geçmiş saklı yordamları ve tetikleyicileri, yapılan her çağrı yanı sıra tüm kod proxy kullanıcı güvenlik bağlamı altında çalışır.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-109">All code, as well as any calls to nested stored procedures or triggers, executes under the security context of the proxy user.</span></span> <span data-ttu-id="d2ca4-110">Yürütme bağlamı özgün çağırana yalnızca yürütme yordamın veya REVERT deyimi verildiğinde sonra geri döndürüldü.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-110">Execution context is reverted to the original caller only after execution of the procedure or when a REVERT statement is issued.</span></span>  
  
## <a name="context-switching-with-the-execute-as-statement"></a><span data-ttu-id="d2ca4-111">Bağlam EXECUTE AS değiştirme deyimi</span><span class="sxs-lookup"><span data-stu-id="d2ca4-111">Context Switching with the EXECUTE AS Statement</span></span>  
 <span data-ttu-id="d2ca4-112">Transact-SQL EXECUTE AS deyimi bir deyimi yürütme bağlamı başka bir oturum açma veya veritabanı kullanıcı kimliğine bürünerek geçiş yapmanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-112">The Transact-SQL EXECUTE AS statement allows you to switch the execution context of a statement by impersonating another login or database user.</span></span> <span data-ttu-id="d2ca4-113">Bu, sorgular ve yordamları başka bir kullanıcı olarak test etmek için kullanışlı bir tekniktir.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-113">This is a useful technique for testing queries and procedures as another user.</span></span>  
  
```  
EXECUTE AS LOGIN = 'loginName';  
EXECUTE AS USER = 'userName';  
```  
  
 <span data-ttu-id="d2ca4-114">Oturum açma veya kullanıcı kimliğine bürünme özelliklerini al izinleri olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-114">You must have IMPERSONATE permissions on the login or user you are impersonating.</span></span> <span data-ttu-id="d2ca4-115">Bu izin için örtük `sysadmin` tüm veritabanları için ve `db_owner` oldukları veritabanlarında Rol üyeleri.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-115">This permission is implied for `sysadmin` for all databases, and `db_owner` role members in databases that they own.</span></span>  
  
## <a name="granting-permissions-with-the-execute-as-clause"></a><span data-ttu-id="d2ca4-116">EXECUTE AS izinlerle verme yan tümcesi</span><span class="sxs-lookup"><span data-stu-id="d2ca4-116">Granting Permissions with the EXECUTE AS Clause</span></span>  
 <span data-ttu-id="d2ca4-117">Kullanabileceğiniz EXECUTE AS yan tümcesinde bir saklı yordam, tetikleyici veya kullanıcı tanımlı işlev (dışında satır içi tablo değerli işlevler) tanımı üstbilgisi.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-117">You can use the EXECUTE AS clause in the definition header of a stored procedure, trigger, or user-defined function (except for inline table-valued functions).</span></span> <span data-ttu-id="d2ca4-118">Bu kullanıcı adı ya da anahtar sözcük EXECUTE AS belirtilen bağlamında yürütmek için yordamı neden yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-118">This causes the procedure to execute in the context of the user name or keyword specified in the EXECUTE AS clause.</span></span> <span data-ttu-id="d2ca4-119">Yalnızca gerekli izinleri yordamı tarafından erişilen nesneler üzerinde verme bir oturum açma eşlenmemiş veritabanında bir proxy kullanıcısı oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-119">You can create a proxy user in the database that is not mapped to a login, granting it only the necessary permissions on the objects accessed by the procedure.</span></span> <span data-ttu-id="d2ca4-120">EXECUTE yan tümcesi modül tarafından erişilen tüm nesneler üzerinde izinleri olmalıdır olarak belirtilen yalnızca proxy kullanıcı.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-120">Only the proxy user specified in the EXECUTE AS clause must have permissions on all objects accessed by the module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d2ca4-121">TRUNCATE TABLE gibi bazı eylemleri verilebilen izinlere sahip değil.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-121">Some actions, such as TRUNCATE TABLE, do not have grantable permissions.</span></span> <span data-ttu-id="d2ca4-122">Bir yordam içindeki deyim ekleme ve ALTER TABLE izinlere sahip bir proxy kullanıcı belirterek yordamı yalnızca yürütme izinlerine sahip arayanlar tabloya kesmek için izinleri genişletebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-122">By incorporating the statement within a procedure and specifying a proxy user who has ALTER TABLE permissions, you can extend the permissions to truncate the table to callers who have only EXECUTE permissions on the procedure.</span></span>  
  
 <span data-ttu-id="d2ca4-123">EXECUTE yan tümcesi iç içe geçmiş yordamları ve Tetikleyicileri dahil olmak üzere bu yordam boyunca geçerli olarak belirtilen bağlamı.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-123">The context specified in the EXECUTE AS clause is valid for the duration of the procedure, including nested procedures and triggers.</span></span> <span data-ttu-id="d2ca4-124">Bağlam çağırana yürütme veya geri DÖNDÜRME deyimi verilen olduğunda döner.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-124">Context reverts to the caller when execution is complete or the REVERT statement is issued.</span></span>  
  
 <span data-ttu-id="d2ca4-125">EXECUTE AS kullanarak söz konusu üç adım vardır yan tümcesinde bir yordam.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-125">There are three steps involved in using the EXECUTE AS clause in a procedure.</span></span>  
  
1.  <span data-ttu-id="d2ca4-126">Proxy kullanıcı bir oturum eşlenmemiş veritabanı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-126">Create a proxy user in the database that is not mapped to a login.</span></span> <span data-ttu-id="d2ca4-127">Bu gerekli değildir, ancak izinleri yönetirken yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-127">This is not required, but it helps when managing permissions.</span></span>  
  
```  
CREATE USER proxyUser WITHOUT LOGIN  
```  
  
1.  <span data-ttu-id="d2ca4-128">Proxy kullanıcı gerekli izinleri verin.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-128">Grant the proxy user the necessary permissions.</span></span>  
  
2.  <span data-ttu-id="d2ca4-129">Ekleme EXECUTE AS yan tümcesi saklı yordam veya kullanıcı tanımlı işlev.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-129">Add the EXECUTE AS clause to the stored procedure or user-defined function.</span></span>  
  
```  
CREATE PROCEDURE [procName] WITH EXECUTE AS 'proxyUser' AS ...  
```  
  
> [!NOTE]
>  <span data-ttu-id="d2ca4-130">Arayanın özgün güvenlik bağlamı korunmayan çünkü denetim gerektiren uygulamalar bozulabilir.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-130">Applications that require auditing can break because the original security context of the caller is not retained.</span></span> <span data-ttu-id="d2ca4-131">Örneğin SESSION_USER'ı, kullanıcı veya USER_NAME, geçerli kullanıcının kimliğini döndürür yerleşik işlevler EXECUTE AS ile ilişkili kullanıcıyı döndürür yan tümcesi, özgün çağıran.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-131">Built-in functions that return the identity of the current user, such as SESSION_USER, USER, or USER_NAME, return the user associated with the EXECUTE AS clause, not the original caller.</span></span>  
  
### <a name="using-execute-as-with-revert"></a><span data-ttu-id="d2ca4-132">EXECUTE AS REVERT ile kullanma</span><span class="sxs-lookup"><span data-stu-id="d2ca4-132">Using EXECUTE AS with REVERT</span></span>  
 <span data-ttu-id="d2ca4-133">Özgün yürütme bağlamı geri dönmek için geri Transact-SQL deyimini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-133">You can use the Transact-SQL REVERT statement to revert to the original execution context.</span></span>  
  
 <span data-ttu-id="d2ca4-134">İsteğe bağlı yan tümcesi ile Hayır geri tanımlama bilgisi = @variableName, geçiş yürütme bağlamı geri çağırana varsa verir @variableName değişkeni doğru değeri içerir.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-134">The optional clause, WITH NO REVERT COOKIE = @variableName, allows you switch the execution context back to the caller if the @variableName variable contains the correct value.</span></span> <span data-ttu-id="d2ca4-135">Bu bağlantı havuzu kullanıldığı ortamlarda çağırana geri yürütme bağlamı geçiş yapmanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-135">This allows you to switch the execution context back to the caller in environments where connection pooling is used.</span></span> <span data-ttu-id="d2ca4-136">Çünkü değerini @variableName yalnızca EXECUTE AS çağırana bilinen deyimi, çağıran ise yürütme bağlamı uygulamayı çağıran son kullanıcı tarafından değiştirilemez.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-136">Because the value of @variableName is known only to the caller of the EXECUTE AS statement, the caller can guarantee that the execution context cannot be changed by the end user that invokes the application.</span></span> <span data-ttu-id="d2ca4-137">Bağlantı kapalı olduğunda havuza geri döner.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-137">When the connection is closed, it is returned to the pool.</span></span> <span data-ttu-id="d2ca4-138">ADO.NET, havuzu bağlantısı hakkında daha fazla bilgi için bkz [SQL Server bağlantı havuzu (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span><span class="sxs-lookup"><span data-stu-id="d2ca4-138">For more information on connection pooling in ADO.NET, see [SQL Server Connection Pooling (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span></span>  
  
### <a name="specifying-the-execution-context"></a><span data-ttu-id="d2ca4-139">Yürütme bağlamı belirtme</span><span class="sxs-lookup"><span data-stu-id="d2ca4-139">Specifying the Execution Context</span></span>  
 <span data-ttu-id="d2ca4-140">Bir kullanıcı belirtmeye ek olarak da EXECUTE AS herhangi şu anahtar sözcüklerden biri ile kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-140">In addition to specifying a user, you can also use EXECUTE AS with any of the following keywords.</span></span>  
  
-   <span data-ttu-id="d2ca4-141">ÇAĞIRICI.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-141">CALLER.</span></span> <span data-ttu-id="d2ca4-142">ARAYAN yürütülen varsayılandır; diğer bir seçenek belirtilmişse, yordamı çağıran güvenlik bağlamında yürütür.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-142">Executing as CALLER is the default; if no other option is specified, then the procedure executes in the security context of the caller.</span></span>  
  
-   <span data-ttu-id="d2ca4-143">SAHİBİ.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-143">OWNER.</span></span> <span data-ttu-id="d2ca4-144">SAHİBİ olarak yürütülen yordamı yordamı sahibi bağlamında yürütür.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-144">Executing as OWNER executes the procedure in the context of the procedure owner.</span></span> <span data-ttu-id="d2ca4-145">Yordam tarafından sahip olunan bir şemadaki oluşturduysanız `dbo` veya veritabanı sahibi Kısıtlanmamış izinlerle yordamı çalıştırır.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-145">If the procedure is created in a schema owned by `dbo` or the database owner, the procedure will execute with unrestricted permissions.</span></span>  
  
-   <span data-ttu-id="d2ca4-146">KENDİ KENDİNİ.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-146">SELF.</span></span> <span data-ttu-id="d2ca4-147">KENDİNİ yürütülen Oluşturucusu saklı yordamı, güvenlik bağlamını yürütür.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-147">Executing as SELF executes in the security context of the creator of the stored procedure.</span></span> <span data-ttu-id="d2ca4-148">Bu belirtilen bir kullanıcı olarak yürütülen eşdeğerdir belirtilen kullanıcı oluşturma veya değiştirme yordamı kişi olduğu.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-148">This is equivalent to executing as a specified user, where the specified user is the person creating or altering the procedure.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="d2ca4-149">Dış Kaynaklar</span><span class="sxs-lookup"><span data-stu-id="d2ca4-149">External Resources</span></span>  
 <span data-ttu-id="d2ca4-150">Daha fazla bilgi için aşağıdaki kaynaklara bakın.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-150">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="d2ca4-151">Kaynak</span><span class="sxs-lookup"><span data-stu-id="d2ca4-151">Resource</span></span>|<span data-ttu-id="d2ca4-152">Açıklama</span><span class="sxs-lookup"><span data-stu-id="d2ca4-152">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="d2ca4-153">[İçerik Geçişi](http://msdn.microsoft.com/library/ms188268.aspx) SQL Server Çevrimiçi Kitapları'nda</span><span class="sxs-lookup"><span data-stu-id="d2ca4-153">[Context Switching](http://msdn.microsoft.com/library/ms188268.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="d2ca4-154">EXECUTE AS kullanmayı açıklayan konulara bağlantılar içerir yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-154">Contains links to topics describing how to use the EXECUTE AS clause.</span></span>|  
|<span data-ttu-id="d2ca4-155">[Özel izin kümeleri oluşturmak için EXECUTE AS kullanarak](http://msdn.microsoft.com/library/ms190384.aspx) ve [modülleri EXECUTE AS kullanarak](http://msdn.microsoft.com/library/ms178106.aspx) SQL Server Çevrimiçi Kitapları'nda</span><span class="sxs-lookup"><span data-stu-id="d2ca4-155">[Using EXECUTE AS to Create Custom Permission Sets](http://msdn.microsoft.com/library/ms190384.aspx) and [Using EXECUTE AS in Modules](http://msdn.microsoft.com/library/ms178106.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="d2ca4-156">Konular, EXECUTE AS kullanmayı açıklar yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-156">Topics describe how to use the EXECUTE AS clause.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="d2ca4-157">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="d2ca4-157">See Also</span></span>  
 [<span data-ttu-id="d2ca4-158">ADO.NET Uygulamalarının Güvenliğini Sağlama</span><span class="sxs-lookup"><span data-stu-id="d2ca4-158">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [<span data-ttu-id="d2ca4-159">SQL Server Güvenliğine Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="d2ca4-159">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [<span data-ttu-id="d2ca4-160">SQL Server'da Uygulama Güvenliği Senaryoları</span><span class="sxs-lookup"><span data-stu-id="d2ca4-160">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [<span data-ttu-id="d2ca4-161">SQL Server'da Saklı Yordam İzinlerini Yönetme</span><span class="sxs-lookup"><span data-stu-id="d2ca4-161">Managing Permissions with Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="d2ca4-162">SQL Server’da Secure Dynamic SQL Yazma</span><span class="sxs-lookup"><span data-stu-id="d2ca4-162">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [<span data-ttu-id="d2ca4-163">SQL Server'da Saklı Yordam İmzalama</span><span class="sxs-lookup"><span data-stu-id="d2ca4-163">Signing Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="d2ca4-164">Saklı Yordamlarla Verileri Değiştirme</span><span class="sxs-lookup"><span data-stu-id="d2ca4-164">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [<span data-ttu-id="d2ca4-165">ADO.NET yönetilen sağlayıcıları ve veri kümesi Geliştirici Merkezi</span><span class="sxs-lookup"><span data-stu-id="d2ca4-165">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
