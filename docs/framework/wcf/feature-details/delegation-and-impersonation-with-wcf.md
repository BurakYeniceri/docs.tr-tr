---
title: WCF ile Temsilcilik ve Kimliğe Bürünme
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- impersonation [WCF]
- delegation [WCF]
ms.assetid: 110e60f7-5b03-4b69-b667-31721b8e3152
ms.openlocfilehash: 811ab308b881b5209d44612b29fb51d1c79e8bf1
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33496925"
---
# <a name="delegation-and-impersonation-with-wcf"></a><span data-ttu-id="6bec5-102">WCF ile Temsilcilik ve Kimliğe Bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-102">Delegation and Impersonation with WCF</span></span>
<span data-ttu-id="6bec5-103">*Kimliğe bürünme* bir hizmeti etki alanı kaynaklarına istemci erişimini kısıtlamak için hizmetlerini kullanan ortak bir tekniktir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-103">*Impersonation* is a common technique that services use to restrict client access to a service domain's resources.</span></span> <span data-ttu-id="6bec5-104">Hizmeti etki alanı kaynaklarına ya da yerel dosyaları (kimliğe bürünme) gibi makine kaynakları veya bir dosya paylaşımı (temsilci) gibi başka bir makinede bir kaynak olabilir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-104">Service domain resources can either be machine resources, such as local files (impersonation), or a resource on another machine, such as a file share (delegation).</span></span> <span data-ttu-id="6bec5-105">Örnek bir uygulama için bkz: [istemci kimliğine bürünme](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span><span class="sxs-lookup"><span data-stu-id="6bec5-105">For a sample application, see [Impersonating the Client](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span></span> <span data-ttu-id="6bec5-106">Kimliğe bürünme kullanma örneği için bkz: [nasıl yapılır: bir hizmete bir istemcinin kimliğine bürünmek](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="6bec5-106">For an example of how to use impersonation, see [How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="6bec5-107">Bir hizmet bir istemcide belirlerken hizmet sunucu işlemi daha yüksek ayrıcalıkları olabilir istemcinin kimlik bilgileriyle çalıştığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="6bec5-107">Be aware that when impersonating a client on a service, the service runs with the client's credentials, which may have higher privileges than the server process.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="6bec5-108">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="6bec5-108">Overview</span></span>  
 <span data-ttu-id="6bec5-109">Genellikle, istemciler istemci adına bazı eylemler gerçekleştirme hizmet sağlamak için bir hizmet çağırın.</span><span class="sxs-lookup"><span data-stu-id="6bec5-109">Typically, clients call a service to have the service perform some action on the client’s behalf.</span></span> <span data-ttu-id="6bec5-110">Kimliğe bürünme hizmetinin eylem gerçekleştirilirken istemcisi gibi davranmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="6bec5-110">Impersonation allows the service to act as the client while performing the action.</span></span> <span data-ttu-id="6bec5-111">Temsilci istemcinin isteği arka uç hizmeti istemci bürünebilir şekilde arka uç hizmetine iletmek bir ön uç hizmeti sağlar.</span><span class="sxs-lookup"><span data-stu-id="6bec5-111">Delegation allows a front-end service to forward the client’s request to a back-end service in such a way that the back-end service can also impersonate the client.</span></span> <span data-ttu-id="6bec5-112">Kimliğe bürünme bir istemci temsilci şekilde bir arka uç hizmeti istemcinin kimliğini, birlikte boyunca kimliğe bürünme yetenekleri olsa da, belirli bir eylemi gerçekleştirmek için yetkili olup olmadığını denetleme bir yolu olarak en yaygın olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-112">Impersonation is most commonly used as a way of checking whether a client is authorized to perform a particular action, while delegation is a way of flowing impersonation capabilities, along with the client’s identity, to a back-end service.</span></span> <span data-ttu-id="6bec5-113">Temsilci Kerberos tabanlı kimlik doğrulaması yapıldığında, kullanılabilir bir Windows etki alanı özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-113">Delegation is a Windows domain feature that can be used when Kerberos-based authentication is performed.</span></span> <span data-ttu-id="6bec5-114">Temsilci kimlik akışından farklıdır ve temsilci istemcinin parola elinde olmadan istemci kimliğine bürünme özelliğini aktardığından, bir çok daha yüksek ayrıcalıklı kimlik akış daha işlemdir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-114">Delegation is distinct from identity flow and, because delegation transfers the ability to impersonate the client without possession of the client’s password, it is a much higher privileged operation than identity flow.</span></span>  
  
 <span data-ttu-id="6bec5-115">Kimliğe bürünme ve temsilci istemci Windows kimliğe sahip olmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-115">Both impersonation and delegation require that the client have a Windows identity.</span></span> <span data-ttu-id="6bec5-116">Bir istemci bir Windows kimliğine sahip değil, kullanılabilir tek seçenek, istemcinin kimliğini ikinci hizmetine akması şeklindedir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-116">If a client does not possess a Windows identity, then the only option available is to flow the client’s identity to the second service.</span></span>  
  
## <a name="impersonation-basics"></a><span data-ttu-id="6bec5-117">Kimliğe bürünme temelleri</span><span class="sxs-lookup"><span data-stu-id="6bec5-117">Impersonation Basics</span></span>  
 <span data-ttu-id="6bec5-118">Windows Communication Foundation (WCF), bir dizi istemci kimlik bilgileri için kimliğe bürünme özelliğini destekler.</span><span class="sxs-lookup"><span data-stu-id="6bec5-118">Windows Communication Foundation (WCF) supports impersonation for a variety of client credentials.</span></span> <span data-ttu-id="6bec5-119">Bu konu hizmet modeli desteği, bir hizmet yöntemin kullanımı sırasında arayan taklit açıklar.</span><span class="sxs-lookup"><span data-stu-id="6bec5-119">This topic describes service model support for impersonating the caller during the implementation of a service method.</span></span> <span data-ttu-id="6bec5-120">Ayrıca ele alınan olan kimliğe bürünme ve SOAP Güvenliği ve bu senaryolarda WCF seçenekleri içeren ortak dağıtım senaryoları.</span><span class="sxs-lookup"><span data-stu-id="6bec5-120">Also discussed are common deployment scenarios involving impersonation and SOAP security and WCF options in these scenarios.</span></span>  
  
 <span data-ttu-id="6bec5-121">Bu konuda kimliğe bürünme ve temsilci olarak WCF SOAP Güvenliği kullanırken odaklanır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-121">This topic focuses on impersonation and delegation in WCF when using SOAP security.</span></span> <span data-ttu-id="6bec5-122">Kimliğe bürünme ve temsilci WCF ile taşıma güvenliği kullanırken açıklandığı gibi kullanabilirsiniz [taşıma güvenliği ile kimliğe bürünme kullanarak](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="6bec5-122">You can also use impersonation and delegation with WCF when using transport security, as described in [Using Impersonation with Transport Security](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span></span>  
  
## <a name="two-methods"></a><span data-ttu-id="6bec5-123">İki yöntemi</span><span class="sxs-lookup"><span data-stu-id="6bec5-123">Two Methods</span></span>  
 <span data-ttu-id="6bec5-124">WCF SOAP Güvenliği kimliğe bürünme gerçekleştirmek için iki farklı yöntem vardır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-124">WCF SOAP security has two distinct methods for performing impersonation.</span></span> <span data-ttu-id="6bec5-125">Kullanılan yöntem bağlamada bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-125">The method used depends on the binding.</span></span> <span data-ttu-id="6bec5-126">Kimliğe bürünme hizmette sonra önbelleğe Güvenlik Desteği Sağlayıcısı Arabirimi (SSPI) veya Kerberos kimlik doğrulaması alınan bir Windows belirtecine gelen biridir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-126">One is impersonation from a Windows token obtained from the Security Support Provider Interface (SSPI) or Kerberos authentication, which is then cached on the service.</span></span> <span data-ttu-id="6bec5-127">Kimliğe bürünme topluca adlı Kerberos uzantılardan elde Windows belirteci gelen saniyedir *Service-for-User* (S4U).</span><span class="sxs-lookup"><span data-stu-id="6bec5-127">The second is impersonation from a Windows token obtained from the Kerberos extensions, collectively called *Service-for-User* (S4U).</span></span>  
  
### <a name="cached-token-impersonation"></a><span data-ttu-id="6bec5-128">Önbelleğe alınan belirteç kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-128">Cached Token Impersonation</span></span>  
 <span data-ttu-id="6bec5-129">Aşağıdaki ile önbelleğe alınmış belirteci kimliğe bürünme gerçekleştirebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="6bec5-129">You can perform cached-token impersonation with the following:</span></span>  
  
-   <span data-ttu-id="6bec5-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, ve <xref:System.ServiceModel.NetTcpBinding> bir Windows istemcisi kimlik bilgisi.</span><span class="sxs-lookup"><span data-stu-id="6bec5-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a Windows client credential.</span></span>  
  
-   <span data-ttu-id="6bec5-131"><xref:System.ServiceModel.BasicHttpBinding> ile bir <xref:System.ServiceModel.BasicHttpSecurityMode> kümesine <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> kimlik bilgisi veya istemci hizmeti için geçerli bir Windows hesabı eşleyebilirsiniz bir kullanıcı adı kimlik bilgisi nerede sunar diğer standart bağlama.</span><span class="sxs-lookup"><span data-stu-id="6bec5-131"><xref:System.ServiceModel.BasicHttpBinding> with a <xref:System.ServiceModel.BasicHttpSecurityMode> set to the <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> credential, or any other standard binding where the client presents a user name credential that the service can map to a valid Windows account.</span></span>  
  
-   <span data-ttu-id="6bec5-132">Tüm <xref:System.ServiceModel.Channels.CustomBinding> sahip bir Windows istemcisi kimlik bilgisi kullanan `requireCancellation` kümesine `true`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-132">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` set to `true`.</span></span> <span data-ttu-id="6bec5-133">(Aşağıdaki sınıflarında özelliği kullanılabilir: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, ve <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) Güvenli Konuşmayla bağlamada kullanılırsa, ayrıca olmalıdır `requireCancellation` özelliğini `true`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-133">(The property is available on the following classes: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, and <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) If a secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
-   <span data-ttu-id="6bec5-134">Tüm <xref:System.ServiceModel.Channels.CustomBinding> istemci bir kullanıcı adı kimlik bilgisi nerede sayısını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-134">Any <xref:System.ServiceModel.Channels.CustomBinding> where the client presents a user name credential.</span></span> <span data-ttu-id="6bec5-135">Güvenli Konuşmayla bağlamada kullanılırsa, ayrıca olmalıdır `requireCancellation` özelliğini `true`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-135">If secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
### <a name="s4u-based-impersonation"></a><span data-ttu-id="6bec5-136">S4U tabanlı kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-136">S4U-Based Impersonation</span></span>  
 <span data-ttu-id="6bec5-137">Şu kimliğe bürünme S4U tabanlı gerçekleştirebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="6bec5-137">You can perform S4U-based impersonation with the following:</span></span>  
  
-   <span data-ttu-id="6bec5-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, ve <xref:System.ServiceModel.NetTcpBinding> hizmet için geçerli bir Windows hesabı eşleyebilirsiniz bir sertifika istemci kimlik bilgisi.</span><span class="sxs-lookup"><span data-stu-id="6bec5-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a certificate client credential that the service can map to a valid Windows account.</span></span>  
  
-   <span data-ttu-id="6bec5-139">Tüm <xref:System.ServiceModel.Channels.CustomBinding> sahip bir Windows istemcisi kimlik bilgisi kullanan `requireCancellation` özelliğini `false`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-139">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` property set to `false`.</span></span>  
  
-   <span data-ttu-id="6bec5-140">Tüm <xref:System.ServiceModel.Channels.CustomBinding> kullanan bir kullanıcı adı veya Windows istemcisi kimlik bilgisi ve güvenli Konuşmayla `requireCancellation` özelliğini `false`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-140">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a user name or Windows client credential and secure conversation with the `requireCancellation` property set to `false`.</span></span>  
  
 <span data-ttu-id="6bec5-141">Hizmet istemci bürünebilir ölçüde hizmet hesabı kimliğe bürünme, tür kullanılan kimliğe bürünme ve büyük olasılıkla istemcinin verir kimliğe bürünme kapsamını çalıştığında tutan ayrıcalıklarını bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-141">The extent to which the service can impersonate the client depends on the privileges the service account holds when it attempts impersonation, the type of impersonation used, and possibly the extent of impersonation the client permits.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-142">Ne zaman istemci hem de hizmet aynı bilgisayarda çalışan ve istemci bir sistem hesabı altında çalışan (örneğin, `Local System` veya `Network Service`), güvenli bir oturum ile durum bilgisi olan güvenlik bağlamı kurulduğunda istemci bürünülemez belirteçleri.</span><span class="sxs-lookup"><span data-stu-id="6bec5-142">When the client and service are running on the same computer and the client is running under a system account (for example, `Local System` or `Network Service`), the client cannot be impersonated when a secure session is established with stateful Security Context tokens.</span></span> <span data-ttu-id="6bec5-143">Böylece hesap varsayılan olarak taklit edilebileceğini bir Windows Form veya konsol uygulaması genellikle geçerli oturum açma hesabı altında çalışır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-143">A Windows Form or console application typically runs under the currently logged-in account, so that account can be impersonated by default.</span></span> <span data-ttu-id="6bec5-144">Ancak, istemci olduğunda bir [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sayfa ve bu sayfa barındırılan [!INCLUDE[iis601](../../../../includes/iis601-md.md)] veya [!INCLUDE[iisver](../../../../includes/iisver-md.md)], istemci altında çalıştırın. ardından, `Network Service` varsayılan hesabı.</span><span class="sxs-lookup"><span data-stu-id="6bec5-144">However, when the client is an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] page and that page is hosted in [!INCLUDE[iis601](../../../../includes/iis601-md.md)] or [!INCLUDE[iisver](../../../../includes/iisver-md.md)], then the client does run under the `Network Service` account by default.</span></span> <span data-ttu-id="6bec5-145">Güvenli oturumlar destek sistem tarafından sağlanan bağlamalar tümünün varsayılan olarak bir durum bilgisi olmayan güvenlik bağlamı belirteci (SCT) kullanın.</span><span class="sxs-lookup"><span data-stu-id="6bec5-145">All of the system-provided bindings that support secure sessions use a stateless security context token (SCT) by default.</span></span> <span data-ttu-id="6bec5-146">Ancak, istemci ise bir [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sayfası ve durum bilgisi olan SCTs ile güvenli oturumlar kullanılıyorsa, istemci bürünülemez.</span><span class="sxs-lookup"><span data-stu-id="6bec5-146">However, if the client is an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] page, and secure sessions with stateful SCTs are used, the client cannot be impersonated.</span></span> <span data-ttu-id="6bec5-147">Durum bilgisi olan SCTs güvenli bir oturumda kullanma hakkında daha fazla bilgi için bkz: [nasıl yapılır: güvenli oturum açmak için bir güvenlik bağlamı belirteci oluşturma](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span><span class="sxs-lookup"><span data-stu-id="6bec5-147">For more information about using stateful SCTs in a secure session, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-declarative-model"></a><span data-ttu-id="6bec5-148">Bir hizmet yöntemi, kimliğe bürünme: bildirim temelli modeli</span><span class="sxs-lookup"><span data-stu-id="6bec5-148">Impersonation in a Service Method: Declarative Model</span></span>  
 <span data-ttu-id="6bec5-149">Çoğu kimliğe bürünme senaryoları hizmet yöntemini çağıran bağlamda yürütmenin içerir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-149">Most impersonation scenarios involve executing the service method in the caller context.</span></span> <span data-ttu-id="6bec5-150">WCF sağlar, bu kullanıcının kimliğe bürünme gereksinimini belirtmesine olanak tanıyarak yapılacağı kolaylaştırır bir kimliğe bürünme özelliği <xref:System.ServiceModel.OperationBehaviorAttribute> özniteliği.</span><span class="sxs-lookup"><span data-stu-id="6bec5-150">WCF provides an impersonation feature that makes this easy to do by allowing the user to specify the impersonation requirement in the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute.</span></span> <span data-ttu-id="6bec5-151">Örneğin, aşağıdaki kodda, WCF altyapı çağıran yürütmeden önce taklit `Hello` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bec5-151">For example, in the following code, the WCF infrastructure impersonates the caller before executing the `Hello` method.</span></span> <span data-ttu-id="6bec5-152">Herhangi bir deneyin içinde yerel kaynaklara erişmek `Hello` yöntemi başarılı yalnızca kaynağın erişim denetim listesi (ACL) arayan veriyorsa erişim ayrıcalıkları.</span><span class="sxs-lookup"><span data-stu-id="6bec5-152">Any attempt to access native resources inside the `Hello` method succeed only if the access control list (ACL) of the resource allows the caller access privileges.</span></span> <span data-ttu-id="6bec5-153">Kimliğe bürünme özelliğini etkinleştirmek için ayarlanmış <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> özelliğini birine <xref:System.ServiceModel.ImpersonationOption> numaralandırma değerleri, ya da <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> veya <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, aşağıdaki örnekte gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="6bec5-153">To enable impersonation, set the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property to one of the <xref:System.ServiceModel.ImpersonationOption> enumeration values, either <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> or <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, as shown in the following example.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-154">Bir hizmeti uzak istemci daha yüksek kimlik bilgileri olduğunda, hizmetin kimlik bilgileri kullanılır <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> özelliği ayarlanmış <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-154">When a service has higher credentials than the remote client, the credentials of the service are used if the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span></span> <span data-ttu-id="6bec5-155">Diğer bir deyişle, düşük ayrıcalıklı bir kullanıcının kimlik bilgilerini sağlıyorsa, daha yüksek ayrıcalıklı hizmeti hizmetin kimlik bilgileri yöntemiyle yürütür ve düşük ayrıcalıklı kullanıcı aksi kullanmanız mümkün olmayacaktır kaynakları kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-155">That is, if a low-privileged user provides its credentials, a higher-privileged service executes the method with the credentials of the service, and can use resources that the low-privileged user would otherwise not be able to use.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#1)]
 [!code-vb[c_ImpersonationAndDelegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#1)]  
  
 <span data-ttu-id="6bec5-156">Çağrıyı yapan bir Windows kullanıcı hesabıyla eşlenir kimlik bilgileri ile doğrulanırsa WCF altyapı çağıran kimliğine bürünebilir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-156">The WCF infrastructure can impersonate the caller only if the caller is authenticated with credentials that can be mapped to a Windows user account.</span></span> <span data-ttu-id="6bec5-157">Hizmet, bir Windows hesabı eşlenemiyor kimlik bilgilerini kullanarak kimlik doğrulaması için yapılandırılmışsa, hizmet yöntemi yürütülemiyor.</span><span class="sxs-lookup"><span data-stu-id="6bec5-157">If the service is configured to authenticate using a credential that cannot be mapped to a Windows account, the service method is not executed.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-158">Üzerinde [!INCLUDE[wxp](../../../../includes/wxp-md.md)], kimliğe bürünme başarısız olursa SCT oluşturulur, sonuçta bir durum bilgisi olan bir <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-158">On [!INCLUDE[wxp](../../../../includes/wxp-md.md)], impersonation fails if a stateful SCT is created, resulting in an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="6bec5-159">Daha fazla bilgi için bkz: [desteklenmeyen senaryolar](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="6bec5-159">For more information, see [Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-imperative-model"></a><span data-ttu-id="6bec5-160">Bir hizmet yöntemi, kimliğe bürünme: kesinlik temelli modeli</span><span class="sxs-lookup"><span data-stu-id="6bec5-160">Impersonation in a Service Method: Imperative Model</span></span>  
 <span data-ttu-id="6bec5-161">Bazen çağıran işlevi, ancak yalnızca bir kısmının tüm hizmet yöntemi taklit gerekmez.</span><span class="sxs-lookup"><span data-stu-id="6bec5-161">Sometimes a caller does not need to impersonate the entire service method to function, but for only a portion of it.</span></span> <span data-ttu-id="6bec5-162">Bu durumda, çağıran hizmet yöntemi içinde Windows kimliğini almak ve kimliğe bürünme imperatively gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="6bec5-162">In this case, obtain the Windows identity of the caller inside the service method and imperatively perform the impersonation.</span></span> <span data-ttu-id="6bec5-163">Kullanarak bunu <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> özelliği <xref:System.ServiceModel.ServiceSecurityContext> bir örneğini döndürmek için <xref:System.Security.Principal.WindowsIdentity> sınıfı ve arama <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> örneğini kullanmadan önce yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bec5-163">Do this by using the <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> property of the <xref:System.ServiceModel.ServiceSecurityContext> to return an instance of the <xref:System.Security.Principal.WindowsIdentity> class and calling the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method before using the instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-164">Visual Basic kullandığınızdan emin olun`Using` deyimi veya C# `using` deyimi kimliğe bürünme eylemi otomatik olarak geri döndürüyoruz.</span><span class="sxs-lookup"><span data-stu-id="6bec5-164">Be sure to use the Visual Basic`Using` statement or the C# `using` statement to automatically revert the impersonation action.</span></span> <span data-ttu-id="6bec5-165">Deyim kullanmayın veya Visual Basic veya C# dışında bir programlama dili kullanıyorsanız, kimliğe bürünme düzeyi dönmek emin olun.</span><span class="sxs-lookup"><span data-stu-id="6bec5-165">If you do not use the statement, or if you use a programming language other than Visual Basic or C#, be sure to revert the impersonation level.</span></span> <span data-ttu-id="6bec5-166">Bunu yapmak için hata hizmet reddi ve ayrıcalıkların yükseltilmesi saldırılarını temelini.</span><span class="sxs-lookup"><span data-stu-id="6bec5-166">Failure to do this can form the basis for denial of service and elevation of privilege attacks.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#2)]
 [!code-vb[c_ImpersonationAndDelegation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#2)]  
  
## <a name="impersonation-for-all-service-methods"></a><span data-ttu-id="6bec5-167">Tüm hizmet yöntemleri için kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-167">Impersonation for All Service Methods</span></span>  
 <span data-ttu-id="6bec5-168">Bazı durumlarda, bir hizmetin arayanın bağlamında tüm yöntemleri gerçekleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-168">In some cases, you must perform all the methods of a service in the caller’s context.</span></span> <span data-ttu-id="6bec5-169">Bu özellik yöntemi başına temelinde açıkça etkinleştirmek yerine kullanmak <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-169">Instead of explicitly enabling this feature on a per-method basis, use the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span></span> <span data-ttu-id="6bec5-170">Aşağıdaki kodda gösterildiği gibi ayarlamak <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> özelliğine `true`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-170">As shown in the following code, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> property to `true`.</span></span> <span data-ttu-id="6bec5-171"><xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> Davranışlarını koleksiyonlarından alınan <xref:System.ServiceModel.ServiceHost> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bec5-171">The <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> is retrieved from the collections of behaviors of the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="6bec5-172">Ayrıca `Impersonation` özelliği <xref:System.ServiceModel.OperationBehaviorAttribute> uygulanan kadar her yöntemi de ayarlanması gerekir ya da çok <xref:System.ServiceModel.ImpersonationOption.Allowed> veya <xref:System.ServiceModel.ImpersonationOption.Required>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-172">Also note that the `Impersonation` property of the <xref:System.ServiceModel.OperationBehaviorAttribute> applied to each method must also be set to either <xref:System.ServiceModel.ImpersonationOption.Allowed> or <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#3)]
 [!code-vb[c_ImpersonationAndDelegation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#3)]  
  
 <span data-ttu-id="6bec5-173">Aşağıdaki tabloda tüm olası kombinasyonu için WCF davranışını tanımlar `ImpersonationOption` ve `ImpersonateCallerForAllServiceOperations`.</span><span class="sxs-lookup"><span data-stu-id="6bec5-173">The following table describes WCF behavior for all possible combinations of `ImpersonationOption` and `ImpersonateCallerForAllServiceOperations`.</span></span>  
  
|`ImpersonationOption`|`ImpersonateCallerForAllServiceOperations`|<span data-ttu-id="6bec5-174">Davranış</span><span class="sxs-lookup"><span data-stu-id="6bec5-174">Behavior</span></span>|  
|---------------------------|------------------------------------------------|--------------|  
|<span data-ttu-id="6bec5-175">Gerekli</span><span class="sxs-lookup"><span data-stu-id="6bec5-175">Required</span></span>|<span data-ttu-id="6bec5-176">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-176">n/a</span></span>|<span data-ttu-id="6bec5-177">WCF çağıran temsil eder</span><span class="sxs-lookup"><span data-stu-id="6bec5-177">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="6bec5-178">İzin verilen</span><span class="sxs-lookup"><span data-stu-id="6bec5-178">Allowed</span></span>|<span data-ttu-id="6bec5-179">false</span><span class="sxs-lookup"><span data-stu-id="6bec5-179">false</span></span>|<span data-ttu-id="6bec5-180">WCF çağıran kimliğine bürünmek değil</span><span class="sxs-lookup"><span data-stu-id="6bec5-180">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="6bec5-181">İzin verilen</span><span class="sxs-lookup"><span data-stu-id="6bec5-181">Allowed</span></span>|<span data-ttu-id="6bec5-182">true</span><span class="sxs-lookup"><span data-stu-id="6bec5-182">true</span></span>|<span data-ttu-id="6bec5-183">WCF çağıran temsil eder</span><span class="sxs-lookup"><span data-stu-id="6bec5-183">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="6bec5-184">QueuedDeliveryRequirements</span><span class="sxs-lookup"><span data-stu-id="6bec5-184">NotAllowed</span></span>|<span data-ttu-id="6bec5-185">false</span><span class="sxs-lookup"><span data-stu-id="6bec5-185">false</span></span>|<span data-ttu-id="6bec5-186">WCF çağıran kimliğine bürünmek değil</span><span class="sxs-lookup"><span data-stu-id="6bec5-186">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="6bec5-187">QueuedDeliveryRequirements</span><span class="sxs-lookup"><span data-stu-id="6bec5-187">NotAllowed</span></span>|<span data-ttu-id="6bec5-188">true</span><span class="sxs-lookup"><span data-stu-id="6bec5-188">true</span></span>|<span data-ttu-id="6bec5-189">İzin verilmiyor.</span><span class="sxs-lookup"><span data-stu-id="6bec5-189">Disallowed.</span></span> <span data-ttu-id="6bec5-190">(Bir <xref:System.InvalidOperationException> atılır.)</span><span class="sxs-lookup"><span data-stu-id="6bec5-190">(An <xref:System.InvalidOperationException> is thrown.)</span></span>|  
  
## <a name="impersonation-level-obtained-from-windows-credentials-and-cached-token-impersonation"></a><span data-ttu-id="6bec5-191">Kimliğe bürünme düzeyi'Windows kimlik bilgileri elde ve belirteç kimliğe bürünme önbelleğe</span><span class="sxs-lookup"><span data-stu-id="6bec5-191">Impersonation Level Obtained from Windows Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="6bec5-192">Bazı senaryolarda istemci hizmeti bir Windows istemcisi kimlik bilgisi kullanıldığında gerçekleştirir kimliğe bürünme düzeyini kısmi denetime sahiptir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-192">In some scenarios the client has partial control over the level of impersonation the service performs when a Windows client credential is used.</span></span> <span data-ttu-id="6bec5-193">Bir senaryo oluşur. istemcinin anonim kimliğe bürünme düzeyini belirtir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-193">One scenario occurs when the client specifies an Anonymous impersonation level.</span></span> <span data-ttu-id="6bec5-194">Diğer bir önbelleğe alınan belirteci ile kimliğe bürünme gerçekleştirirken oluşur.</span><span class="sxs-lookup"><span data-stu-id="6bec5-194">The other occurs when performing impersonation with a cached token.</span></span> <span data-ttu-id="6bec5-195">Bu ayarlayarak yapılır <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> özelliği <xref:System.ServiceModel.Security.WindowsClientCredential> genel bir özellik olarak erişilen sınıfı <xref:System.ServiceModel.ChannelFactory%601> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bec5-195">This is done by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-196">Kimliğe bürünme düzeyi anonim belirtilmesi hizmetine anonim olarak oturum açmak istemci neden olur.</span><span class="sxs-lookup"><span data-stu-id="6bec5-196">Specifying an impersonation level of Anonymous causes the client to log on to the service anonymously.</span></span> <span data-ttu-id="6bec5-197">Hizmet, bu nedenle kimliğe bürünme gerçekleştirilip bağımsız olarak anonim oturumları izin vermelidir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-197">The service must therefore allow anonymous logons, regardless of whether impersonation is performed.</span></span>  
  
 <span data-ttu-id="6bec5-198">İstemcinin kimliğe bürünme düzeyi olarak belirtebilirsiniz <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, veya <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-198">The client can specify the impersonation level as <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, or <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="6bec5-199">Aşağıdaki kodda gösterildiği gibi bir belirteç yalnızca belirtilen düzeyinde oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="6bec5-199">Only a token at the specified level is produced, as shown in the following code.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#4)]
 [!code-vb[c_ImpersonationAndDelegation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#4)]  
  
 <span data-ttu-id="6bec5-200">Aşağıdaki tabloda bir önbelleğe alınan belirtecinden belirlerken hizmet edinir kimliğe bürünme düzeyini belirtir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-200">The following table specifies the impersonation level the service obtains when impersonating from a cached token.</span></span>  
  
|<span data-ttu-id="6bec5-201">`AllowedImpersonationLevel` Değer</span><span class="sxs-lookup"><span data-stu-id="6bec5-201">`AllowedImpersonationLevel` value</span></span>|<span data-ttu-id="6bec5-202">Hizmet var `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6bec5-202">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6bec5-203">Hizmet ve istemci için temsilci seçme özelliği</span><span class="sxs-lookup"><span data-stu-id="6bec5-203">Service and client are capable of delegation</span></span>|<span data-ttu-id="6bec5-204">Önbelleğe alınan belirteci `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6bec5-204">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6bec5-205">Anonim</span><span class="sxs-lookup"><span data-stu-id="6bec5-205">Anonymous</span></span>|<span data-ttu-id="6bec5-206">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-206">Yes</span></span>|<span data-ttu-id="6bec5-207">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-207">n/a</span></span>|<span data-ttu-id="6bec5-208">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-208">Impersonation</span></span>|  
|<span data-ttu-id="6bec5-209">Anonim</span><span class="sxs-lookup"><span data-stu-id="6bec5-209">Anonymous</span></span>|<span data-ttu-id="6bec5-210">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-210">No</span></span>|<span data-ttu-id="6bec5-211">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-211">n/a</span></span>|<span data-ttu-id="6bec5-212">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-212">Identification</span></span>|  
|<span data-ttu-id="6bec5-213">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-213">Identification</span></span>|<span data-ttu-id="6bec5-214">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-214">n/a</span></span>|<span data-ttu-id="6bec5-215">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-215">n/a</span></span>|<span data-ttu-id="6bec5-216">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-216">Identification</span></span>|  
|<span data-ttu-id="6bec5-217">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-217">Impersonation</span></span>|<span data-ttu-id="6bec5-218">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-218">Yes</span></span>|<span data-ttu-id="6bec5-219">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-219">n/a</span></span>|<span data-ttu-id="6bec5-220">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-220">Impersonation</span></span>|  
|<span data-ttu-id="6bec5-221">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-221">Impersonation</span></span>|<span data-ttu-id="6bec5-222">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-222">No</span></span>|<span data-ttu-id="6bec5-223">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-223">n/a</span></span>|<span data-ttu-id="6bec5-224">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-224">Identification</span></span>|  
|<span data-ttu-id="6bec5-225">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-225">Delegation</span></span>|<span data-ttu-id="6bec5-226">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-226">Yes</span></span>|<span data-ttu-id="6bec5-227">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-227">Yes</span></span>|<span data-ttu-id="6bec5-228">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-228">Delegation</span></span>|  
|<span data-ttu-id="6bec5-229">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-229">Delegation</span></span>|<span data-ttu-id="6bec5-230">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-230">Yes</span></span>|<span data-ttu-id="6bec5-231">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-231">No</span></span>|<span data-ttu-id="6bec5-232">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-232">Impersonation</span></span>|  
|<span data-ttu-id="6bec5-233">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-233">Delegation</span></span>|<span data-ttu-id="6bec5-234">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-234">No</span></span>|<span data-ttu-id="6bec5-235">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-235">n/a</span></span>|<span data-ttu-id="6bec5-236">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-236">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-user-name-credentials-and-cached-token-impersonation"></a><span data-ttu-id="6bec5-237">Kimliğe bürünme düzeyi'kullanıcı adı kimlik bilgileri elde ve belirteç kimliğe bürünme önbelleğe</span><span class="sxs-lookup"><span data-stu-id="6bec5-237">Impersonation Level Obtained from User Name Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="6bec5-238">Hizmetin kullanıcı adı ve parola geçirerek, bir istemci ayarı için eşdeğer bir gruba bu kullanıcı olarak oturum açmak WCF sağlar `AllowedImpersonationLevel` özelliğine <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="6bec5-238">By passing the service its user name and password, a client enables WCF to log on as that user, which is equivalent to setting the `AllowedImpersonationLevel` property to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="6bec5-239">( `AllowedImpersonationLevel` Kullanılabilir <xref:System.ServiceModel.Security.WindowsClientCredential> ve <xref:System.ServiceModel.Security.HttpDigestClientCredential> sınıfları.) Aşağıdaki tabloda hizmetin kullanıcı adı kimlik bilgilerini aldığında düzeyi elde kimliğe bürünme sağlar.</span><span class="sxs-lookup"><span data-stu-id="6bec5-239">(The `AllowedImpersonationLevel` is available on the <xref:System.ServiceModel.Security.WindowsClientCredential> and <xref:System.ServiceModel.Security.HttpDigestClientCredential> classes.) The following table provides the impersonation level obtained when the service receives user name credentials.</span></span>  
  
|`AllowedImpersonationLevel`|<span data-ttu-id="6bec5-240">Hizmet var `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6bec5-240">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6bec5-241">Hizmet ve istemci için temsilci seçme özelliği</span><span class="sxs-lookup"><span data-stu-id="6bec5-241">Service and client are capable of delegation</span></span>|<span data-ttu-id="6bec5-242">Önbelleğe alınan belirteci `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6bec5-242">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6bec5-243">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-243">n/a</span></span>|<span data-ttu-id="6bec5-244">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-244">Yes</span></span>|<span data-ttu-id="6bec5-245">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-245">Yes</span></span>|<span data-ttu-id="6bec5-246">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-246">Delegation</span></span>|  
|<span data-ttu-id="6bec5-247">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-247">n/a</span></span>|<span data-ttu-id="6bec5-248">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-248">Yes</span></span>|<span data-ttu-id="6bec5-249">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-249">No</span></span>|<span data-ttu-id="6bec5-250">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-250">Impersonation</span></span>|  
|<span data-ttu-id="6bec5-251">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-251">n/a</span></span>|<span data-ttu-id="6bec5-252">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-252">No</span></span>|<span data-ttu-id="6bec5-253">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-253">n/a</span></span>|<span data-ttu-id="6bec5-254">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-254">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-s4u-based-impersonation"></a><span data-ttu-id="6bec5-255">Kimliğe bürünme S4U tabanlı elde edilen kimliğe bürünme düzeyi</span><span class="sxs-lookup"><span data-stu-id="6bec5-255">Impersonation Level Obtained from S4U-Based Impersonation</span></span>  
  
|<span data-ttu-id="6bec5-256">Hizmet var `SeTcbPrivilege`</span><span class="sxs-lookup"><span data-stu-id="6bec5-256">Service has `SeTcbPrivilege`</span></span>|<span data-ttu-id="6bec5-257">Hizmet var `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6bec5-257">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6bec5-258">Hizmet ve istemci için temsilci seçme özelliği</span><span class="sxs-lookup"><span data-stu-id="6bec5-258">Service and client are capable of delegation</span></span>|<span data-ttu-id="6bec5-259">Önbelleğe alınan belirteci `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6bec5-259">Cached token `ImpersonationLevel`</span></span>|  
|----------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6bec5-260">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-260">Yes</span></span>|<span data-ttu-id="6bec5-261">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-261">Yes</span></span>|<span data-ttu-id="6bec5-262">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-262">n/a</span></span>|<span data-ttu-id="6bec5-263">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-263">Impersonation</span></span>|  
|<span data-ttu-id="6bec5-264">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-264">Yes</span></span>|<span data-ttu-id="6bec5-265">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-265">No</span></span>|<span data-ttu-id="6bec5-266">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-266">n/a</span></span>|<span data-ttu-id="6bec5-267">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-267">Identification</span></span>|  
|<span data-ttu-id="6bec5-268">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-268">No</span></span>|<span data-ttu-id="6bec5-269">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-269">n/a</span></span>|<span data-ttu-id="6bec5-270">yok</span><span class="sxs-lookup"><span data-stu-id="6bec5-270">n/a</span></span>|<span data-ttu-id="6bec5-271">Tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bec5-271">Identification</span></span>|  
  
## <a name="mapping-a-client-certificate-to-a-windows-account"></a><span data-ttu-id="6bec5-272">Bir Windows hesabı için bir istemci sertifikası eşleme</span><span class="sxs-lookup"><span data-stu-id="6bec5-272">Mapping a Client Certificate to a Windows Account</span></span>  
 <span data-ttu-id="6bec5-273">Bir istemci bir sertifika kullanarak bir hizmet için kendi kimliğini doğrulamak ve var olan bir hesabı Active Directory üzerinden istemciye hizmet eşlemesi için mümkündür.</span><span class="sxs-lookup"><span data-stu-id="6bec5-273">It is possible for a client to authenticate itself to a service using a certificate, and to have the service map the client to an existing account through Active Directory.</span></span> <span data-ttu-id="6bec5-274">Aşağıdaki XML sertifika eşlemek için hizmetinin nasıl yapılandırılacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-274">The following XML shows how to configure the service to map the certificate.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="MapToWindowsAccount">  
      <serviceCredentials>  
        <clientCertificate>  
          <authentication mapClientCertificateToWindowsAccount="true" />  
        </clientCertificate>  
      </serviceCredentials>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
 <span data-ttu-id="6bec5-275">Aşağıdaki kod hizmetinin nasıl yapılandırılacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-275">The following code shows how to configure the service.</span></span>  
  
```  
// Create a binding that sets a certificate as the client credential type.  
WSHttpBinding b = new WSHttpBinding();  
b.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  
  
// Create a service host that maps the certificate to a Windows account.  
Uri httpUri = new Uri("http://localhost/Calculator");  
ServiceHost sh = new ServiceHost(typeof(HelloService), httpUri);  
sh.Credentials.ClientCertificate.Authentication.MapClientCertificateToWindowsAccount = true;  
```  
  
## <a name="delegation"></a><span data-ttu-id="6bec5-276">Temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-276">Delegation</span></span>  
 <span data-ttu-id="6bec5-277">Kerberos kimlik doğrulaması Windows kimliğini kullanarak arka uç hizmetine doğrudan veya bir arka uç hizmetine temsilci seçmek için bir hizmet bir Kerberos çok leg (SSPI NTLM geri dönüş olmadan'i) gerçekleştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bec5-277">To delegate to a back-end service, a service must perform Kerberos multi-leg (SSPI without NTLM fallback) or Kerberos direct authentication to the back-end service using the client’s Windows identity.</span></span> <span data-ttu-id="6bec5-278">Bir arka uç hizmeti temsilci seçmesine oluşturmak bir <xref:System.ServiceModel.ChannelFactory%601> ve bir kanal ve sonra istemci kimliğine bürünme sırasında kanal aracılığıyla iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="6bec5-278">To delegate to a back-end service, create a <xref:System.ServiceModel.ChannelFactory%601> and a channel, and then communicate through the channel while impersonating the client.</span></span> <span data-ttu-id="6bec5-279">Bu temsilci form ile ön uç hizmeti tarafından elde kimliğe bürünme düzeyi, arka uç hizmeti ön uç hizmetinden bulunabilir uzaklığı bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-279">With this form of delegation, the distance at which the back-end service can be located from the front-end service depends on the impersonation level achieved by the front-end service.</span></span> <span data-ttu-id="6bec5-280">Kimliğe bürünme düzeyi olduğunda <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, ön uç ve arka uç hizmetlerini aynı makinede çalıştırması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-280">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, the front-end and back-end services must be running on the same machine.</span></span> <span data-ttu-id="6bec5-281">Kimliğe bürünme düzeyi olduğunda <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, ön uç ve arka uç hizmetlerini ayrı makinelerde ya da aynı makine üzerindeki olabilir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-281">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, the front-end and back-end services can be on separate machines or on the same machine.</span></span> <span data-ttu-id="6bec5-282">Temsilci düzeyi kimliğe bürünme özelliğini etkinleştirme Windows etki alanı ilkesi temsilci izin verecek şekilde yapılandırılmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-282">Enabling delegation-level impersonation requires that Windows domain policy be configured to permit delegation.</span></span> <span data-ttu-id="6bec5-283">Active Directory temsilci desteği için yapılandırma hakkında daha fazla bilgi için bkz: [temsilci kimlik doğrulamasını etkinleştirme](http://go.microsoft.com/fwlink/?LinkId=99690).</span><span class="sxs-lookup"><span data-stu-id="6bec5-283">For more information about configuring Active Directory for delegation support, see [Enabling Delegated Authentication](http://go.microsoft.com/fwlink/?LinkId=99690).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bec5-284">Bir kullanıcı adı ve bir Windows hesabı arka uç hizmetine karşılık gelen parola kullanarak ön uç hizmeti için bir istemci kimlik doğrulaması gerçekleştirdiğinde ön uç hizmeti istemcinin kullanıcı adınızı ve parolanızı yeniden kullanarak arka uç hizmetine doğrulayabilir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-284">When a client authenticates to the front-end service using a user name and password that correspond to a Windows account on the back-end service, the front-end service can authenticate to the back-end service by reusing the client’s user name and password.</span></span> <span data-ttu-id="6bec5-285">Bu özellikle güçlü kimlik akış, kullanıcı adı geçirme çünkü biçimidir ve kimliğe bürünme gerçekleştirmek için arka uç hizmetini arka uç hizmetine parola sağlar, ancak Kerberos kullanılmadığından, temsilci niteliğinde değildir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-285">This is a particularly powerful form of identity flow, because passing user name and password to the back-end service enables the back-end service to perform impersonation, but it does not constitute delegation because Kerberos is not used.</span></span> <span data-ttu-id="6bec5-286">Temsilci Active Directory denetimlerinde kullanıcı adı ve parola kimlik doğrulaması için geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-286">Active Directory controls on delegation do not apply to user name and password authentication.</span></span>  
  
### <a name="delegation-ability-as-a-function-of-impersonation-level"></a><span data-ttu-id="6bec5-287">Kimliğe bürünme düzeyi bir işlevi olarak temsilci seçme olanağı</span><span class="sxs-lookup"><span data-stu-id="6bec5-287">Delegation Ability as a Function of Impersonation Level</span></span>  
  
|<span data-ttu-id="6bec5-288">Kimliğe bürünme düzeyi</span><span class="sxs-lookup"><span data-stu-id="6bec5-288">Impersonation level</span></span>|<span data-ttu-id="6bec5-289">Çapraz işlem temsilci hizmeti gerçekleştirebilir</span><span class="sxs-lookup"><span data-stu-id="6bec5-289">Service can perform cross-process delegation</span></span>|<span data-ttu-id="6bec5-290">Hizmet makineler arası temsilci gerçekleştirebilirsiniz</span><span class="sxs-lookup"><span data-stu-id="6bec5-290">Service can perform cross-machine delegation</span></span>|  
|-------------------------|---------------------------------------------------|---------------------------------------------------|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Identification>|<span data-ttu-id="6bec5-291">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-291">No</span></span>|<span data-ttu-id="6bec5-292">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-292">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>|<span data-ttu-id="6bec5-293">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-293">Yes</span></span>|<span data-ttu-id="6bec5-294">Hayır</span><span class="sxs-lookup"><span data-stu-id="6bec5-294">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Delegation>|<span data-ttu-id="6bec5-295">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-295">Yes</span></span>|<span data-ttu-id="6bec5-296">Evet</span><span class="sxs-lookup"><span data-stu-id="6bec5-296">Yes</span></span>|  
  
 <span data-ttu-id="6bec5-297">Aşağıdaki kod örneğinde, temsili kullanmak üzere gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-297">The following code example demonstrates how to use delegation.</span></span>  
  
 [!code-csharp[c_delegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_delegation/cs/source.cs#1)]
 [!code-vb[c_delegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_delegation/vb/source.vb#1)]  
  
### <a name="how-to-configure-an-application-to-use-constrained-delegation"></a><span data-ttu-id="6bec5-298">Kısıtlanmış temsili kullanmak üzere bir uygulama yapılandırma</span><span class="sxs-lookup"><span data-stu-id="6bec5-298">How to Configure an Application to Use Constrained Delegation</span></span>  
 <span data-ttu-id="6bec5-299">İçin önce kullanım Kısıtlı temsilci, gönderen, alıcı ve bunu yapmak için etki alanı denetleyicisinin yapılandırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bec5-299">Before you can use constrained delegation, the sender, receiver, and the domain controller must be configured to do so.</span></span> <span data-ttu-id="6bec5-300">Aşağıdaki yordamı Kısıtlanmış temsilci etkinleştirme adımları listeler.</span><span class="sxs-lookup"><span data-stu-id="6bec5-300">The following procedure lists the steps that enable constrained delegation.</span></span> <span data-ttu-id="6bec5-301">Bölümü temsilci ile Kısıtlanmış temsilci arasındaki farklar hakkında daha fazla bilgi için bkz [Windows Server 2003 Kerberos uzantıları](http://go.microsoft.com/fwlink/?LinkId=100194) kısıtlanmış tartışma açıklanır.</span><span class="sxs-lookup"><span data-stu-id="6bec5-301">For details about the differences between delegation and constrained delegation, see the portion of [Windows Server 2003 Kerberos Extensions](http://go.microsoft.com/fwlink/?LinkId=100194) that discusses constrained discussion.</span></span>  
  
1.  <span data-ttu-id="6bec5-302">Etki alanı denetleyicisinde temizleyin **Hesap duyarlıdır ve devredilemez** istemci uygulamasının altında çalıştığı hesap için onay kutusunu.</span><span class="sxs-lookup"><span data-stu-id="6bec5-302">On the domain controller, clear the **Account is sensitive and cannot be delegated** check box for the account under which the client application is running.</span></span>  
  
2.  <span data-ttu-id="6bec5-303">Etki alanı denetleyicisinde seçin **hesabıdır temsilci olarak güvenilir** istemci uygulamasının altında çalıştığı hesap için onay kutusunu.</span><span class="sxs-lookup"><span data-stu-id="6bec5-303">On the domain controller, select the **Account is trusted for delegation** check box for the account under which the client application is running.</span></span>  
  
3.  <span data-ttu-id="6bec5-304">Temsilci olarak güvenilir tıklayarak orta katman bilgisayarın etki alanı denetleyicisinde yapılandırın **bilgisayara temsilci seçmek için güven** seçeneği.</span><span class="sxs-lookup"><span data-stu-id="6bec5-304">On the domain controller, configure the middle tier computer so that it is trusted for delegation, by clicking the **Trust computer for delegation** option.</span></span>  
  
4.  <span data-ttu-id="6bec5-305">Etki alanı denetleyicisinde tıklayarak kısıtlanmış temsili kullanmak üzere orta katman bilgisayarı yapılandırma **bu bilgisayara yalnızca belirtilen hizmetlere temsilci seçmek için güven** seçeneği.</span><span class="sxs-lookup"><span data-stu-id="6bec5-305">On the domain controller, configure the middle tier computer to use constrained delegation, by clicking the **Trust this computer for delegation to specified services only** option.</span></span>  
  
 <span data-ttu-id="6bec5-306">Kısıtlanmış temsilci seçmeyi yapılandırma hakkında daha ayrıntılı yönergeler için MSDN'de bulunan aşağıdaki konulara bakın:</span><span class="sxs-lookup"><span data-stu-id="6bec5-306">For more detailed instructions about configuring constrained delegation, see the following topics on MSDN:</span></span>  
  
-   [<span data-ttu-id="6bec5-307">Kerberos temsilcisi seçme sorunlarını giderme</span><span class="sxs-lookup"><span data-stu-id="6bec5-307">Troubleshooting Kerberos Delegation</span></span>](http://go.microsoft.com/fwlink/?LinkId=36724)  
  
-   [<span data-ttu-id="6bec5-308">Kerberos protokol geçişi ve Kısıtlanmış temsilci seçme</span><span class="sxs-lookup"><span data-stu-id="6bec5-308">Kerberos Protocol Transition and Constrained Delegation</span></span>](http://go.microsoft.com/fwlink/?LinkId=36725)  
  
## <a name="see-also"></a><span data-ttu-id="6bec5-309">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="6bec5-309">See Also</span></span>  
 <xref:System.ServiceModel.OperationBehaviorAttribute>  
 <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>  
 <xref:System.ServiceModel.ImpersonationOption>  
 <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A>  
 <xref:System.ServiceModel.ServiceSecurityContext>  
 <xref:System.Security.Principal.WindowsIdentity>  
 <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>  
 <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A>  
 <xref:System.ServiceModel.ServiceHost>  
 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ChannelFactory%601>  
 <xref:System.Security.Principal.TokenImpersonationLevel.Identification>  
 [<span data-ttu-id="6bec5-310">Aktarım Güvenliği ile Kimliğe Bürünme Kullanma</span><span class="sxs-lookup"><span data-stu-id="6bec5-310">Using Impersonation with Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md)  
 [<span data-ttu-id="6bec5-311">İstemci Kimliğine Bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-311">Impersonating the Client</span></span>](../../../../docs/framework/wcf/samples/impersonating-the-client.md)  
 [<span data-ttu-id="6bec5-312">Nasıl yapılır: Bir Hizmette İstemci Kimliğine Bürünme</span><span class="sxs-lookup"><span data-stu-id="6bec5-312">How to: Impersonate a Client on a Service</span></span>](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)  
 [<span data-ttu-id="6bec5-313">ServiceModel Meta Veri Yardımcı Programı Aracı (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="6bec5-313">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)
