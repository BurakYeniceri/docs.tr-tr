---
title: "WIF oturum yönetimi"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 98bce126-18a9-401b-b20d-67ee462a5f8a
caps.latest.revision: "7"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload: dotnet
ms.openlocfilehash: 7703d9fb612ead13140d010b1670abb209c5acb7
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 12/22/2017
---
# <a name="wif-session-management"></a><span data-ttu-id="18c6f-102">WIF oturum yönetimi</span><span class="sxs-lookup"><span data-stu-id="18c6f-102">WIF Session Management</span></span>
<span data-ttu-id="18c6f-103">Bir istemci ilk bağlı olan taraf tarafından barındırılan korunan bir kaynağa erişmeyi denediğinde, istemci önce kendisi için bağlı olan taraf tarafından güvenilen bir güvenlik belirteci hizmeti (STS) doğrulaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-103">When a client first tries to access a protected resource that is hosted by a relying party, the client must first authenticate itself to a security token service (STS) that is trusted by the relying party.</span></span> <span data-ttu-id="18c6f-104">STS istemciye daha sonra bir güvenlik belirteci verir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-104">The STS then issues a security token to the client.</span></span> <span data-ttu-id="18c6f-105">İstemci, korumalı kaynak için istemci erişim verir bağlı olan taraf için bu belirteci sunar.</span><span class="sxs-lookup"><span data-stu-id="18c6f-105">The client presents this token to the relying party, which then grants the client access to the protected resource.</span></span> <span data-ttu-id="18c6f-106">Ancak, özellikle bu bile aynı bilgisayarda veya bağlı olan taraf aynı etki alanında olmayabilir olmadığından STS her istek için yeniden kimlik doğrulaması sahip istemci istemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-106">However, you don’t want the client to have to re-authenticate to the STS for each request, especially because it might not even be on the same computer or in the same domain as the relying party.</span></span> <span data-ttu-id="18c6f-107">Bunun yerine, Windows Identity Foundation (WIF) bağlı olan taraf bir oturumu, istemci oturum güvenlik belirteci kendisini tüm istekler için bağlı olan tarafa sonra ilk istek kimliğini doğrulamak için kullanır ve istemci vardır.</span><span class="sxs-lookup"><span data-stu-id="18c6f-107">Instead, Windows Identity Foundation (WIF) has the client and relying party establish a session in which the client uses a session security token to authenticate itself to the relying party for all requests after the first request.</span></span> <span data-ttu-id="18c6f-108">Bağlı olan taraf istemcinin yeniden oluşturmak için bir tanımlama bilgisi içinde depolanır, bu oturum güvenlik belirteci kullanabilirsiniz <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="18c6f-108">The relying party can use this session security token, which is stored inside a cookie, to reconstruct the client’s <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>.</span></span>  
  
 <span data-ttu-id="18c6f-109">STS istemci sağlamalısınız hangi kimlik doğrulama tanımlar.</span><span class="sxs-lookup"><span data-stu-id="18c6f-109">The STS defines what authentication the client must provide.</span></span> <span data-ttu-id="18c6f-110">Ancak, istemci ile kendisini STS doğrulanabilir birden çok kimlik bilgilerine sahip.</span><span class="sxs-lookup"><span data-stu-id="18c6f-110">However, the client might have multiple credentials with which it can authenticate itself to the STS.</span></span> <span data-ttu-id="18c6f-111">Örneğin, Windows Live, bir kullanıcı adı ve parola, bir sertifika ve bir smartkey belirtecinden sahip olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-111">For example, it might have a token from Windows Live, a user name and password, a certificate, and a smartkey.</span></span> <span data-ttu-id="18c6f-112">Bu durumda, STS verir istemci istemci sunar kimlik bilgilerini birine karşılık gelen her bir kimliği olan birçok kimlik.</span><span class="sxs-lookup"><span data-stu-id="18c6f-112">In that case, the STS grants the client several identities, with each identity corresponding to one of the credentials that the client presents.</span></span> <span data-ttu-id="18c6f-113">İstemci erişim düzeyini kapılarını açtığında bağlı olan taraf bir veya daha fazla bu kimlikleri kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-113">The relying party can use one or more of these identities when it decides what level of access to grant the client.</span></span>  
  
 <span data-ttu-id="18c6f-114"><xref:System.IdentityModel.Tokens.SessionSecurityToken?displayProperty=nameWithType> İstemcinin yeniden oluşturmak için kullanılan <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>, tüm istemci kimliklerini içeren <xref:System.Security.Claims.ClaimsPrincipal.Identities%2A>.</span><span class="sxs-lookup"><span data-stu-id="18c6f-114">The <xref:System.IdentityModel.Tokens.SessionSecurityToken?displayProperty=nameWithType> is used to reconstruct the client’s <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>, which contains all of the client’s identities in <xref:System.Security.Claims.ClaimsPrincipal.Identities%2A>.</span></span> <span data-ttu-id="18c6f-115">Her <xref:System.Security.Claims.ClaimsIdentity?displayProperty=nameWithType> bu kimlikle ilişkili önyükleme belirteçleri koleksiyonu içerir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-115">Each <xref:System.Security.Claims.ClaimsIdentity?displayProperty=nameWithType> in the collection contains the bootstrap tokens that are associated with that identity.</span></span>  
  
 <span data-ttu-id="18c6f-116">Yeni Oturum belirteci özgün Oturum belirteci oturum kimliği ile verilirse <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler?displayProperty=nameWithType> belirteci önbelleğinde Oturum belirteci güncelleştirmez.</span><span class="sxs-lookup"><span data-stu-id="18c6f-116">If a new session token is issued with the session ID of the original session token, <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler?displayProperty=nameWithType> does not update the session token in the token cache.</span></span> <span data-ttu-id="18c6f-117">Oturum belirteci benzersiz bir oturum kimliği ile her zaman örneği</span><span class="sxs-lookup"><span data-stu-id="18c6f-117">You should always instantiate a session token with a unique session ID.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="18c6f-118">Session.SecurityTokenHandler.ReadToken oluşturur bir <xref:System.Xml.XmlException> geçersiz giriş; alırsa, özel durum Örneğin, oturum belirteci içeren tanımlama bilgisi bozuk.</span><span class="sxs-lookup"><span data-stu-id="18c6f-118">Session.SecurityTokenHandler.ReadToken throws a <xref:System.Xml.XmlException> exception if it receives invalid input; for example, if the cookie that contains the session token is corrupted.</span></span> <span data-ttu-id="18c6f-119">Bu özel durumu yakalayın ve uygulamaya özgü davranışı sağlamak öneririz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-119">We recommend that you catch this exception and provide application-specific behavior.</span></span>  
  
 <span data-ttu-id="18c6f-120">Korumalı bir Web sayfası aynı zamanda korumalı etki alanında olan kaynaklar (örneğin, küçük grafikleri) çok sayıda içeriyorsa, istemci kendisini bu kaynakların her biri indirmek için bağlı olan taraf için yeniden kimlik doğrulaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-120">If a protected Web page contains lots of resources (such as small graphics) that are also in the protected domain, the client must re-authenticate itself to the relying party to download each of those resources.</span></span> <span data-ttu-id="18c6f-121">STS her istek için kimlik doğrulaması için gereken bir oturum kimlik doğrulama belirteci kullanımını engeller, ancak bu hala çok sayıda tanımlama bilgisi üzerinden gönderilme anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-121">Use of a session authentication token avoids the need to authenticate to the STS for each request, but it still means that many cookies are being sent over.</span></span> <span data-ttu-id="18c6f-122">Böylece alt öğeleri korumasız bir etki alanında depolanır ve ana Web sayfasından bağlı sırasında önemli bilgiler ve kaynakların korunan etki alanında depolandıkları Web page up ayarlamak isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-122">You might want to set up the Web page so that the important data and resources are stored in the protected domain while minor items are stored in an unprotected domain and linked to from the main Web page.</span></span> <span data-ttu-id="18c6f-123">Ayrıca, yalnızca korumalı etki alanı başvurmak için tanımlama bilgisi yolu ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="18c6f-123">Also, set the cookie path to reference only the protected domain.</span></span>  
  
 <span data-ttu-id="18c6f-124">İçin bir işleyici sağlayan Microsoft önerir başvuru modunda çalışmak üzere <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SessionSecurityTokenCreated> olayında **global.asax.cs** dosya ve ayar **IsReferenceMode** geçirilen belirteç özelliği <xref:System.IdentityModel.Services.SessionSecurityTokenCreatedEventArgs.SessionToken%2A> özelliği.</span><span class="sxs-lookup"><span data-stu-id="18c6f-124">To operate in reference mode, Microsoft recommends providing a handler for the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SessionSecurityTokenCreated> event in the **global.asax.cs** file and setting the **IsReferenceMode** property on the token passed in the <xref:System.IdentityModel.Services.SessionSecurityTokenCreatedEventArgs.SessionToken%2A> property.</span></span> <span data-ttu-id="18c6f-125">Bu güncelleştirmeler Oturum belirteci her istek için referans modunda çalışır ve yalnızca ayarı üzerinden avantajlı sağlayacak <xref:System.IdentityModel.Services.SessionAuthenticationModule.IsReferenceMode%2A> oturum kimlik doğrulama modülü özelliği.</span><span class="sxs-lookup"><span data-stu-id="18c6f-125">These updates will ensure that the session token operates in reference mode for every request and is favored over merely setting the  <xref:System.IdentityModel.Services.SessionAuthenticationModule.IsReferenceMode%2A> property on the Session Authentication Module.</span></span>  
  
## <a name="extensibility"></a><span data-ttu-id="18c6f-126">Genişletilebilirlik</span><span class="sxs-lookup"><span data-stu-id="18c6f-126">Extensibility</span></span>  
 <span data-ttu-id="18c6f-127">Oturum yönetimi mekanizması genişletebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-127">You can extend the session management mechanism.</span></span> <span data-ttu-id="18c6f-128">Bunun bir nedeni, performansı artırmak için olacaktır.</span><span class="sxs-lookup"><span data-stu-id="18c6f-128">One reason for this would be to improve the performance.</span></span> <span data-ttu-id="18c6f-129">Örneğin, dönüştürür veya oturum güvenlik belirteci, bellek içi durumunu ve tanımlama bilgisine unsurları arasında en iyi duruma getirir özel tanımlama bilgisi işleyici oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="18c6f-129">For example, you could create a custom cookie handler that transforms or optimizes the session security token between its in-memory state and what goes into the cookie.</span></span> <span data-ttu-id="18c6f-130">Bunu yapmak için yapılandırabileceğiniz <xref:System.IdentityModel.Services.SessionAuthenticationModule.CookieHandler%2A?displayProperty=nameWithType> özelliği <xref:System.IdentityModel.Services.SessionAuthenticationModule?displayProperty=nameWithType> türeyen bir özel tanımlama bilgisi işleyicisi kullanmak için <xref:System.IdentityModel.Services.CookieHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="18c6f-130">To do so, you can configure the <xref:System.IdentityModel.Services.SessionAuthenticationModule.CookieHandler%2A?displayProperty=nameWithType> property of the <xref:System.IdentityModel.Services.SessionAuthenticationModule?displayProperty=nameWithType> to use a custom cookie handler that derives from <xref:System.IdentityModel.Services.CookieHandler?displayProperty=nameWithType>.</span></span> <span data-ttu-id="18c6f-131"><xref:System.IdentityModel.Services.ChunkedCookieHandler?displayProperty=nameWithType>tanımlama bilgilerini Köprü Metni Aktarım Protokolü (HTTP) için izin verilen boyutunu aştığından varsayılan tanımlama bilgisi işleyicisidir; Bunun yerine bir özel tanımlama bilgisi işleyicisi kullanırsanız, parçalama uygulamalıdır.</span><span class="sxs-lookup"><span data-stu-id="18c6f-131"><xref:System.IdentityModel.Services.ChunkedCookieHandler?displayProperty=nameWithType> is the default cookie handler because the cookies exceed the allowable size for Hypertext Transfer Protocol (HTTP); if you use a custom cookie handler instead, you must implement chunking.</span></span>  
  
 <span data-ttu-id="18c6f-132">Daha fazla bilgi için bkz: [ClaimsAwareWebFarm](http://go.microsoft.com/fwlink/?LinkID=248408) (http://go.microsoft.com/fwlink/?LinkID=248408) örnek.</span><span class="sxs-lookup"><span data-stu-id="18c6f-132">For more information, see [ClaimsAwareWebFarm](http://go.microsoft.com/fwlink/?LinkID=248408) (http://go.microsoft.com/fwlink/?LinkID=248408) sample.</span></span> <span data-ttu-id="18c6f-133">Bu örnek, böylece büyük tanımlama bilgilerinin değişimi yerine başvuruya oturumları kullanabilirsiniz (aksine, bir tokenreplycache) bir grup hazır oturum önbelleğini göstermektedir; Bu örnek ayrıca tanımlama bilgilerini bir grupta güvenlik altına almanın daha kolay bir yolu gösterir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-133">This sample shows a farm ready session cache (as opposed to a tokenreplycache) so that you can use sessions by reference instead of exchanging big cookies; this sample also demonstrates an easier way of securing cookies in a farm.</span></span> <span data-ttu-id="18c6f-134">Oturum önbelleğini WCF dayalıdır.</span><span class="sxs-lookup"><span data-stu-id="18c6f-134">The session cache is WCF-based.</span></span> <span data-ttu-id="18c6f-135">Güvenli hale getirme oturumu açısından örnek web.config dosyasında yalnızca uygun parçacığı yapıştırılarak etkinleştirilebilir MachineKey dayalı bir tanımlama bilgisi dönüşümün WIF 4.5 içinde yeni bir özellik gösterir. Örnek değil "nun gruplandırılmış", ancak uygulamanızı grubu kullanıma hazır hale getirmek için gereken gösterir.</span><span class="sxs-lookup"><span data-stu-id="18c6f-135">With regard to session securing, the sample demonstrates a new capability in WIF 4.5 of a cookie transform based on MachineKey, which can be activated by simply pasting the appropriate snippet in the web.config. The sample itself is not "farmed", but it demonstrates what you need for making your app farm-ready.</span></span>
