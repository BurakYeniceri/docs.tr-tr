---
title: "Windows Kimlik Doğrulama Hatalarını Ayıklama"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 8c153fc3fa44b6f84d5aa11a7f20dcce3df533c8
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 12/02/2017
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="983c9-102">Windows Kimlik Doğrulama Hatalarını Ayıklama</span><span class="sxs-lookup"><span data-stu-id="983c9-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="983c9-103">Windows kimlik doğrulaması bir güvenlik mekanizması olarak kullanırken, Güvenlik Desteği Sağlayıcısı Arabirimi (SSPI) güvenlik işlemleri işler.</span><span class="sxs-lookup"><span data-stu-id="983c9-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="983c9-104">SSPI katmanında güvenlik hatası meydana geldiğinde, bunlar tarafından çıkmış [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="983c9-104">When security errors occur at the SSPI layer, they are surfaced by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span> <span data-ttu-id="983c9-105">Bu konu, hataları tanılamak için sorularını kümesi ve bir çerçeve sağlar.</span><span class="sxs-lookup"><span data-stu-id="983c9-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="983c9-106">Kerberos protokolü genel bakış için bkz: [Kerberos açıklandığı](http://go.microsoft.com/fwlink/?LinkID=86946); SSPI, genel bir bakış için bkz [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="983c9-106">For an overview of the Kerberos protocol, see [Kerberos Explained](http://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="983c9-107">Windows kimlik doğrulaması [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] genellikle kullandığı *anlaş* Kerberos hizmet ve istemci arasında karşılıklı kimlik doğrulaması gerçekleştiren Güvenlik Desteği Sağlayıcısı'ne (SSP).</span><span class="sxs-lookup"><span data-stu-id="983c9-107">For Windows authentication, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="983c9-108">Kerberos protokolü varsayılan olarak kullanılabilir değilse, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] NT LAN Yöneticisi (NTLM) geri döner.</span><span class="sxs-lookup"><span data-stu-id="983c9-108">If the Kerberos protocol is not available, by default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="983c9-109">Ancak, yapılandırabileceğiniz [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] yalnızca Kerberos protokolünü kullanır (ve Kerberos kullanılabilir değilse, bir özel durum).</span><span class="sxs-lookup"><span data-stu-id="983c9-109">However, you can configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="983c9-110">Ayrıca yapılandırabilirsiniz [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Kerberos protokolünün Kısıtlanmış formlar kullanılacak.</span><span class="sxs-lookup"><span data-stu-id="983c9-110">You can also configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="983c9-111">Hata ayıklama yöntemi</span><span class="sxs-lookup"><span data-stu-id="983c9-111">Debugging Methodology</span></span>  
 <span data-ttu-id="983c9-112">Temel yöntemi aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="983c9-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="983c9-113">Windows kimlik doğrulaması kullanarak olup olmadığını belirler.</span><span class="sxs-lookup"><span data-stu-id="983c9-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="983c9-114">Başka bir düzen kullanıyorsanız, bu konuda geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="983c9-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="983c9-115">Windows kimlik doğrulaması kullandığınızdan emin olup olmadıklarını belirlemek olup olmadığını, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Kerberos doğrudan veya anlaşma yapılandırmasını kullanır.</span><span class="sxs-lookup"><span data-stu-id="983c9-115">If you are sure you are using Windows authentication, determine whether your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="983c9-116">Yapılandırmanızı NTLM ve Kerberos protokolünü kullanarak belirledikten sonra hata iletileri doğru bağlamında anlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="983c9-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="983c9-117">NTLM ve Kerberos protokolü kullanılabilirliği</span><span class="sxs-lookup"><span data-stu-id="983c9-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="983c9-118">Kerberos SSP Kerberos Anahtar Dağıtım Merkezi (KDC) olarak hareket edecek bir etki alanı denetleyicisi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="983c9-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="983c9-119">Kerberos protokolü, yalnızca etki alanı kimlikleri hem istemci hem de hizmet kullanırken kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="983c9-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="983c9-120">Diğer hesap bileşimlerde NTLM, aşağıdaki tabloda özetlendiği gibi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="983c9-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="983c9-121">Tablo üstbilgileri olası hesap türleri için sunucu tarafından kullanılan gösterir.</span><span class="sxs-lookup"><span data-stu-id="983c9-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="983c9-122">Sol sütunda, istemci tarafından kullanılan olası hesap türünü gösterir.</span><span class="sxs-lookup"><span data-stu-id="983c9-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="983c9-123">Yerel kullanıcı</span><span class="sxs-lookup"><span data-stu-id="983c9-123">Local User</span></span>|<span data-ttu-id="983c9-124">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="983c9-124">Local System</span></span>|<span data-ttu-id="983c9-125">Etki alanı kullanıcısı</span><span class="sxs-lookup"><span data-stu-id="983c9-125">Domain User</span></span>|<span data-ttu-id="983c9-126">Etki alanı makine</span><span class="sxs-lookup"><span data-stu-id="983c9-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="983c9-127">Yerel kullanıcı</span><span class="sxs-lookup"><span data-stu-id="983c9-127">Local User</span></span>|<span data-ttu-id="983c9-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-128">NTLM</span></span>|<span data-ttu-id="983c9-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-129">NTLM</span></span>|<span data-ttu-id="983c9-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-130">NTLM</span></span>|<span data-ttu-id="983c9-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-131">NTLM</span></span>|  
|<span data-ttu-id="983c9-132">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="983c9-132">Local System</span></span>|<span data-ttu-id="983c9-133">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-133">Anonymous NTLM</span></span>|<span data-ttu-id="983c9-134">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-134">Anonymous NTLM</span></span>|<span data-ttu-id="983c9-135">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-135">Anonymous NTLM</span></span>|<span data-ttu-id="983c9-136">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="983c9-137">Etki alanı kullanıcısı</span><span class="sxs-lookup"><span data-stu-id="983c9-137">Domain User</span></span>|<span data-ttu-id="983c9-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-138">NTLM</span></span>|<span data-ttu-id="983c9-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-139">NTLM</span></span>|<span data-ttu-id="983c9-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="983c9-140">Kerberos</span></span>|<span data-ttu-id="983c9-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="983c9-141">Kerberos</span></span>|  
|<span data-ttu-id="983c9-142">Etki alanı makine</span><span class="sxs-lookup"><span data-stu-id="983c9-142">Domain Machine</span></span>|<span data-ttu-id="983c9-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-143">NTLM</span></span>|<span data-ttu-id="983c9-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="983c9-144">NTLM</span></span>|<span data-ttu-id="983c9-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="983c9-145">Kerberos</span></span>|<span data-ttu-id="983c9-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="983c9-146">Kerberos</span></span>|  
  
 <span data-ttu-id="983c9-147">Özellikle, dört hesap türleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="983c9-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="983c9-148">Yerel kullanıcı: Yalnızca makine kullanıcı profili.</span><span class="sxs-lookup"><span data-stu-id="983c9-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="983c9-149">Örneğin: `MachineName\Administrator` veya `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="983c9-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="983c9-150">: Yerel yerleşik sistem Hesabını sistemi bir etki alanına katılmamış bir makinede.</span><span class="sxs-lookup"><span data-stu-id="983c9-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="983c9-151">Etki alanı kullanıcısı: Bir Windows etki alanı kullanıcı hesabı.</span><span class="sxs-lookup"><span data-stu-id="983c9-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="983c9-152">Örneğin: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="983c9-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="983c9-153">Etki alanı makine: Makine kimliğini bir Windows etki alanına katılmış bir makinede çalışan bir işlem.</span><span class="sxs-lookup"><span data-stu-id="983c9-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="983c9-154">Örneğin: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="983c9-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="983c9-155">Hizmet kimlik bilgilerini yakalanan zaman <xref:System.ServiceModel.ICommunicationObject.Open%2A> yöntemi <xref:System.ServiceModel.ServiceHost> sınıfı çağrılır.</span><span class="sxs-lookup"><span data-stu-id="983c9-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="983c9-156">İstemci kimlik bilgileri okuyun her istemci bir ileti gönderir.</span><span class="sxs-lookup"><span data-stu-id="983c9-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="983c9-157">Genel Windows kimlik doğrulama sorunları</span><span class="sxs-lookup"><span data-stu-id="983c9-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="983c9-158">Bu bölümde bazı yaygın Windows kimlik doğrulama sorunları ve olası çözümler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="983c9-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="983c9-159">Kerberos protokolü</span><span class="sxs-lookup"><span data-stu-id="983c9-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="983c9-160">Kerberos protokolü SPN/UPN sorunları</span><span class="sxs-lookup"><span data-stu-id="983c9-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="983c9-161">Windows kimlik doğrulaması ve Kerberos protokolü kullanılan veya SSPI tarafından anlaşılan kullanırken, istemci uç nokta kullandığı URL'yi hizmetin konak hizmeti URL'si içinde tam olarak nitelenmiş etki alanı adını içermelidir.</span><span class="sxs-lookup"><span data-stu-id="983c9-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="983c9-162">Bu hizmetinin altında çalıştığı hesabın en yaygın olarak hizmetin altında çalıştırılarak yapılır Active Directory etki alanına bilgisayar eklendiğinde oluşturduğunuz makine (varsayılan) hizmet asıl adı (SPN) anahtarı erişimi olduğunu varsayar. Ağ hizmeti hesabı.</span><span class="sxs-lookup"><span data-stu-id="983c9-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="983c9-163">Hizmet makine SPN anahtarına erişimi yoksa, istemcinin uç noktası kimlik hizmetin çalıştığı hesabın doğru SPN veya kullanıcı asıl adı (UPN) sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="983c9-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="983c9-164">nasıl [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] SPN ve UPN, çalışır bkz [hizmet kimliği ve kimlik doğrulama](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="983c9-164"> how [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="983c9-165">Yük Dengeleme içindeki Web grupları veya Web bahçelerinde gibi senaryolara yaygın bir uygulamadır her uygulama için benzersiz bir hesap tanımlayın, bu hesap için bir SPN atayın ve bu hesabın tüm uygulama hizmetleri çalıştırdığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="983c9-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="983c9-166">Hizmet hesabı için bir SPN elde etmek için bir Active Directory etki alanı yöneticisi olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="983c9-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="983c9-167">[Windows için Kerberos teknik Eki'ni](http://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="983c9-167"> [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="983c9-168">Kerberos protokolü doğrudan bir etki alanı makine hesabı altında Çalıştır hizmetine gerektirir</span><span class="sxs-lookup"><span data-stu-id="983c9-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="983c9-169">Bu meydana zaman `ClientCredentialType` özelliği ayarlanmış `Windows` ve <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> özelliği ayarlanmış `false`aşağıdaki kodda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="983c9-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="983c9-170">Sorunu gidermek için bir etki alanında ağ hizmeti gibi bir etki alanı makine hesabı kullanarak hizmeti çalıştırın makine katıldı.</span><span class="sxs-lookup"><span data-stu-id="983c9-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="983c9-171">Kimlik bilgileri görüşmesi temsilci gerektirir</span><span class="sxs-lookup"><span data-stu-id="983c9-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="983c9-172">Temsilci ile Kerberos kimlik doğrulama protokolünü kullanmak için Kerberos protokolü (bazen "çok leg" veya "çok adımlı" Kerberos denir) kimlik bilgileri görüşmesi ile uygulamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="983c9-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="983c9-173">Kerberos kimlik doğrulaması (bazen "tek adımda" veya "tek leg" Kerberos denir) kimlik bilgileri görüşmesi uygularsanız, bir özel durum.</span><span class="sxs-lookup"><span data-stu-id="983c9-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="983c9-174">Kerberos ile kimlik bilgileri görüşmesi uygulamak için aşağıdaki adımları uygulayın:</span><span class="sxs-lookup"><span data-stu-id="983c9-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="983c9-175">Uygulama temsilci ayarlayarak <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> için <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="983c9-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="983c9-176">SSPI anlaşması gerektirir:</span><span class="sxs-lookup"><span data-stu-id="983c9-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="983c9-177">Standart bağlamaları kullanıyorsanız ayarlamak `NegotiateServiceCredential` özelliğine `true`.</span><span class="sxs-lookup"><span data-stu-id="983c9-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="983c9-178">Özel bağlamalar kullanıyorsanız ayarlamak `AuthenticationMode` özniteliği `Security` öğesine `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="983c9-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="983c9-179">Kerberos, NTLM kullanımını engelleyerek kullanmak için SSPI anlaşması gerektirir:</span><span class="sxs-lookup"><span data-stu-id="983c9-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="983c9-180">Bu kod, aşağıdaki deyim ile yapın:`ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="983c9-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="983c9-181">Veya yapılandırma dosyasında ayarlayarak bunu yapabilirsiniz `allowNtlm` özniteliğini `false`.</span><span class="sxs-lookup"><span data-stu-id="983c9-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="983c9-182">Bu öznitelik yer [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="983c9-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="983c9-183">NTLM protokolü</span><span class="sxs-lookup"><span data-stu-id="983c9-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="983c9-184">Geri NTLM SSP döner anlaşma ancak NTLM devre dışı</span><span class="sxs-lookup"><span data-stu-id="983c9-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="983c9-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Özelliği ayarlanmış `false`, hangi nedenler [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] NTLM kullanılırsa, bir özel durum için bir en iyi çaba yapma.</span><span class="sxs-lookup"><span data-stu-id="983c9-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="983c9-186">Bu özelliği ayarlamak Not `false` NTLM kimlik bilgileri kablo üzerinden gönderilen engelleyebilir değil.</span><span class="sxs-lookup"><span data-stu-id="983c9-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="983c9-187">Geri dönüş için NTLM devre dışı bırakma gösterir.</span><span class="sxs-lookup"><span data-stu-id="983c9-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="983c9-188">NTLM oturum açma başarısız</span><span class="sxs-lookup"><span data-stu-id="983c9-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="983c9-189">İstemci kimlik bilgileri üzerindeki hizmeti geçerli değil.</span><span class="sxs-lookup"><span data-stu-id="983c9-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="983c9-190">Kullanıcı adı ve parola doğru ayarlandığından ve hizmetin çalıştığı bilgisayara bilinen bir hesaba karşılık denetleyin.</span><span class="sxs-lookup"><span data-stu-id="983c9-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="983c9-191">NTLM, hizmetin bilgisayara oturum açmak için belirtilen kimlik bilgilerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="983c9-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="983c9-192">Kimlik bilgileri istemci çalıştığı bilgisayarda geçerli olabilir, ancak kimlik hizmetin bilgisayarda geçerli değilse bu oturum açma başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="983c9-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="983c9-193">Anonim NTLM oturum açma oluşur, ancak anonim oturum açma olan varsayılan olarak devre dışı</span><span class="sxs-lookup"><span data-stu-id="983c9-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="983c9-194">Bir istemci oluştururken <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> özelliği ayarlanmış <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>sunucu anonim oturum açma izin vermez aşağıdaki örnekte, ancak varsayılan olarak gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="983c9-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="983c9-195">Bu kaynaklanır varsayılan değerini <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> özelliği <xref:System.ServiceModel.Security.WindowsServiceCredential> sınıfı `false`.</span><span class="sxs-lookup"><span data-stu-id="983c9-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="983c9-196">Anonim oturumları etkinleştirmek aşağıdaki istemci kodu çalışır (varsayılan özellik olduğuna dikkat edin `Identification`).</span><span class="sxs-lookup"><span data-stu-id="983c9-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="983c9-197">Aşağıdaki hizmet kodu sunucu tarafından anonim oturumları etkinleştirmek için varsayılan değiştirir.</span><span class="sxs-lookup"><span data-stu-id="983c9-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="983c9-198">Kimliğe bürünme, bkz: [temsilcilik ve kimliğe bürünme](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="983c9-198"> impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="983c9-199">Alternatif olarak, istemci, yerleşik sistem hesabı kullanarak bir Windows hizmet olarak çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="983c9-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="983c9-200">Diğer sorunlar</span><span class="sxs-lookup"><span data-stu-id="983c9-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="983c9-201">İstemci kimlik bilgileri düzgün bir şekilde ayarlanmadı</span><span class="sxs-lookup"><span data-stu-id="983c9-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="983c9-202">Windows kimlik doğrulamasını kullanan <xref:System.ServiceModel.Security.WindowsClientCredential> tarafından döndürülen örnek <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> özelliği <xref:System.ServiceModel.ClientBase%601> sınıfı değil, <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="983c9-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="983c9-203">Yanlış bir örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="983c9-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="983c9-204">Doğru örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="983c9-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="983c9-205">SSPI kullanılamıyor</span><span class="sxs-lookup"><span data-stu-id="983c9-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="983c9-206">Aşağıdaki işletim sistemlerinden bir sunucu olarak kullanıldığında Windows kimlik doğrulamasını desteklemez: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition ve [!INCLUDE[wv](../../../../includes/wv-md.md)]Home sürümleri.</span><span class="sxs-lookup"><span data-stu-id="983c9-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="983c9-207">Geliştirme ve farklı kimliklerle dağıtma</span><span class="sxs-lookup"><span data-stu-id="983c9-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="983c9-208">Tek bir makinede uygulamanızı geliştirin ve başka dağıtırsanız ve her makinede kimlik doğrulaması için farklı bir hesap türleri kullanın, farklı bir davranış karşılaşabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="983c9-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="983c9-209">Örneğin, Windows XP Pro makine kullanarak uygulamanızı geliştirin varsayalım `SSPI Negotiated` kimlik doğrulama modu.</span><span class="sxs-lookup"><span data-stu-id="983c9-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="983c9-210">Kimlik doğrulaması yapmak için yerel bir kullanıcı hesabı kullanırsanız, NTLM protokolü kullanılır.</span><span class="sxs-lookup"><span data-stu-id="983c9-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="983c9-211">Uygulama geliştirilen sonra bir etki alanı hesabı altında çalıştığı bir Windows Server 2003 makineye hizmetini dağıtın.</span><span class="sxs-lookup"><span data-stu-id="983c9-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="983c9-212">Bu noktada istemci Kerberos ve bir etki alanı denetleyicisi kullanacak çünkü hizmetin kimliğini olmaz.</span><span class="sxs-lookup"><span data-stu-id="983c9-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="983c9-213">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="983c9-213">See Also</span></span>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.Security.WindowsServiceCredential>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ClientBase%601>  
 [<span data-ttu-id="983c9-214">Temsilcilik ve kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="983c9-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="983c9-215">Desteklenmeyen senaryolar</span><span class="sxs-lookup"><span data-stu-id="983c9-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
