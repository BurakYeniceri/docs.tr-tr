---
title: Veritabanı SQL Server yansıtma
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: cbb4b729475c8f77c204c3a9250d48d4b0cd3bc5
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33362276"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="867e1-102">Veritabanı SQL Server yansıtma</span><span class="sxs-lookup"><span data-stu-id="867e1-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="867e1-103">SQL Server veritabanı yansıtma kopyalama veya yansıtma, bir SQL Server veritabanının bir yedek sunucu üzerinde tutmanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="867e1-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="867e1-104">Yansıtma, verilerin iki ayrı kopyalarının süreleri ve yüksek düzeyde kullanılabilirlik sağladığınızdan hiç var ve veri artıklığı tamamlamak sağlar.</span><span class="sxs-lookup"><span data-stu-id="867e1-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="867e1-105">Geliştirici herhangi bir eylemde veya SQL Server veritabanı için yapılandırıldıktan sonra herhangi bir kod yazmaya gerek yoktur, böylece SQL Server için .NET veri sağlayıcısı, veritabanı yansıtması için örtülü destek sağlar.</span><span class="sxs-lookup"><span data-stu-id="867e1-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="867e1-106">Ayrıca, <xref:System.Data.SqlClient.SqlConnection> nesne destekleyen bir yük devretme iş ortağı sunucu adı sağladığını sağlayan bir açık bir bağlantı modu <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="867e1-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="867e1-107">Basitleştirilmiş aşağıdaki olaylar dizisi gerçekleşir bir <xref:System.Data.SqlClient.SqlConnection> yansıtma için yapılandırılmış bir veritabanını hedefleyip nesnesi:</span><span class="sxs-lookup"><span data-stu-id="867e1-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1.  <span data-ttu-id="867e1-108">İstemci uygulaması başarıyla asıl veritabanına bağlanır ve ardından istemcide önbelleğe ortak sunucu adını sunucu geri gönderir.</span><span class="sxs-lookup"><span data-stu-id="867e1-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2.  <span data-ttu-id="867e1-109">Asıl veritabanı içeren sunucu başarısız olursa veya bağlantı kesildi, bağlantı ve işlem durumu kaybolur.</span><span class="sxs-lookup"><span data-stu-id="867e1-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="867e1-110">İstemci uygulaması asıl veritabanı yeniden bağlantı kurmayı dener ve başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="867e1-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3.  <span data-ttu-id="867e1-111">İstemci uygulama iş ortağı sunucusunda yansıtma veritabanına bir bağlantı kurmak şeffaf bir şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="867e1-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="867e1-112">Bağlantı başarılı olursa yeni asıl veritabanı haline gelir yansıtma veritabanına yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="867e1-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="867e1-113">Yük devretme ortağı bağlantı dizesinde belirtme</span><span class="sxs-lookup"><span data-stu-id="867e1-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="867e1-114">Bağlantı dizesindeki bir yük devretme iş ortağı sunucu adı sağlarsanız, istemci uygulaması ilk bağlandığında asıl veritabanı kullanılamıyorsa, istemci saydam yük devretme ortağı bağlantı dener.</span><span class="sxs-lookup"><span data-stu-id="867e1-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="867e1-115">Yük devretme iş ortağı sunucu adı atlayın ve asıl veritabanı kullanılamıyorsa, istemci uygulaması ilk bağlandığında sonra bir <xref:System.Data.SqlClient.SqlException> tetiklenir.</span><span class="sxs-lookup"><span data-stu-id="867e1-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="867e1-116">Zaman bir <xref:System.Data.SqlClient.SqlConnection> başarıyla açıldı, yük devretme ortak adı sunucu tarafından döndürülen ve bağlantı dizesinde sağlanan tüm değerleri yerini alır.</span><span class="sxs-lookup"><span data-stu-id="867e1-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="867e1-117">Veritabanı yansıtma senaryoları için bağlantı dizesinde açıkça ilk kataloğun veya veritabanının adı belirtmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="867e1-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="867e1-118">İstemci bir açıkça belirtilen ilk kataloğun veya veritabanının sahip olmayan bir bağlantı üzerine yük devretme bilgi alırsa, yük devretme bilgileri önbelleğe alınmaz ve uygulama asıl sunucu başarısız olursa devretmek çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="867e1-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="867e1-119">Bir bağlantı dizesi, yük devretme ortağı, ancak ilk katalog veya veritabanı için herhangi bir değer için bir değer varsa bir `InvalidArgumentException` tetiklenir.</span><span class="sxs-lookup"><span data-stu-id="867e1-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="867e1-120">Geçerli sunucu adı alınıyor</span><span class="sxs-lookup"><span data-stu-id="867e1-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="867e1-121">Bir yük devretme durumunda olduğu için geçerli bağlantı gerçekte bağlı kullanarak sunucu adını alabilir <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> özelliği bir <xref:System.Data.SqlClient.SqlConnection> nesnesi.</span><span class="sxs-lookup"><span data-stu-id="867e1-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="867e1-122">Aşağıdaki kod parçası, bağlantı değişkeni açık başvuran varsayılarak etkin sunucunun adını alır. <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="867e1-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="867e1-123">Bir yük devretme olayı oluşur ve yansıtma sunucuya bağlantı anahtarlanır **DataSource** özelliği yansıtma yansıtacak şekilde güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="867e1-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="867e1-124">SqlClient yansıtma davranışı</span><span class="sxs-lookup"><span data-stu-id="867e1-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="867e1-125">İstemci, her zaman geçerli asıl sunucusuna bağlanmaya çalışır.</span><span class="sxs-lookup"><span data-stu-id="867e1-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="867e1-126">Başarısız olursa, yük devretme ortağı çalışır.</span><span class="sxs-lookup"><span data-stu-id="867e1-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="867e1-127">Yansıtma veritabanının asıl ortak sunucu rolüne zaten geçildi varsa bağlantı başarılı olur ve yeni bir yansıtma asıl eşleme istemciye gönderilen ve arama ömrü boyunca önbelleğe <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="867e1-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="867e1-128">Kalıcı depolama alanına depolanmaz ve farklı bir sonraki bağlantılar için kullanılabilir değil **AppDomain** veya işlemi.</span><span class="sxs-lookup"><span data-stu-id="867e1-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="867e1-129">Ancak, aynı içinde sonraki bağlantılar için kullanılabilir **AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="867e1-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="867e1-130">Not, başka bir **AppDomain** veya her zaman aynı veya farklı bir bilgisayarda çalışan işlemi, havuzunda bağlantılarının var ve bu bağlantılar değil sıfırlanır.</span><span class="sxs-lookup"><span data-stu-id="867e1-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="867e1-131">Her durumda, birincil veritabanı devre dışı kalırsa, işlem veya **AppDomain** kez başarısız olur ve havuzu otomatik olarak temizlenir.</span><span class="sxs-lookup"><span data-stu-id="867e1-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="867e1-132">Sunucusunda desteğini yansıtma veritabanı başına temelinde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="867e1-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="867e1-133">Çok bölümlü adları kullanarak veya geçerli veritabanı değiştirme asıl/yansıtmanın kümesinde yer almayan diğer veritabanlarında veri işleme işlemleri çalıştırıldığında bu diğer veritabanlarına yapılan değişikliklerin hatası durumunda yayılmamasını.</span><span class="sxs-lookup"><span data-stu-id="867e1-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="867e1-134">Veri değil yansıtılmış bir veritabanında değiştirildiğinde bir hata oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="867e1-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="867e1-135">Geliştirici gibi işlemleri olası etkisini değerlendirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="867e1-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="867e1-136">Veritabanı yansıtma kaynakları</span><span class="sxs-lookup"><span data-stu-id="867e1-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="867e1-137">Kavramsal belgeler ve yapılandırma hakkında bilgi için dağıtma ve yönetme yansıtma, SQL Server Çevrimiçi Kitapları'nda aşağıdaki kaynaklara bakın.</span><span class="sxs-lookup"><span data-stu-id="867e1-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server Books Online.</span></span>  
  
|<span data-ttu-id="867e1-138">Kaynak</span><span class="sxs-lookup"><span data-stu-id="867e1-138">Resource</span></span>|<span data-ttu-id="867e1-139">Açıklama</span><span class="sxs-lookup"><span data-stu-id="867e1-139">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="867e1-140">[Veritabanı yansıtma](http://msdn.microsoft.com/library/bb934127.aspx) SQL Server Çevrimiçi Kitapları'nda</span><span class="sxs-lookup"><span data-stu-id="867e1-140">[Database Mirroring](http://msdn.microsoft.com/library/bb934127.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="867e1-141">Ayarlama ve SQL Server yansıtma yapılandırma açıklar.</span><span class="sxs-lookup"><span data-stu-id="867e1-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="867e1-142">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="867e1-142">See Also</span></span>  
 [<span data-ttu-id="867e1-143">ADO.NET yönetilen sağlayıcıları ve veri kümesi Geliştirici Merkezi</span><span class="sxs-lookup"><span data-stu-id="867e1-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
