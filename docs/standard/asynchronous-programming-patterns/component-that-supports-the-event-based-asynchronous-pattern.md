---
title: 'İzlenecek yol: Olay Tabanlı Zaman Uyumsuz Deseni Destekleyen Bir Bileşeni Uygulama'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
ms.openlocfilehash: 9156a538e306fb8657855a840dd8185cef8794b2
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33579268"
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="6bffd-102">İzlenecek yol: Olay Tabanlı Zaman Uyumsuz Deseni Destekleyen Bir Bileşeni Uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="6bffd-103">Belirgin gecikmeler maruz kalabilirsiniz bazı işlemler sınıfıyla yazıyorsanız uygulayarak zaman uyumsuz işlevselliği vermiş göz önünde bulundurun [olay tabanlı zaman uyumsuz desene genel bakış](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="6bffd-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="6bffd-104">Bu kılavuz, olay tabanlı zaman uyumsuz desen uygulayan bileşeni oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="6bffd-105">Yardımcı sınıfları kullanılarak uygulanır <xref:System.ComponentModel?displayProperty=nameWithType> bileşeni düzgün herhangi bir uygulama modeli altında çalıştığını sağlar, ad alanı dahil olmak üzere [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], konsol uygulamaları ve Windows Forms uygulamaları.</span><span class="sxs-lookup"><span data-stu-id="6bffd-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="6bffd-106">Bu bileşen ayrıca ile designable bir <xref:System.Windows.Forms.PropertyGrid> denetimi ve kendi özel tasarımcıları.</span><span class="sxs-lookup"><span data-stu-id="6bffd-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="6bffd-107">Aracılığıyla olduğunda asal sayılar zaman uyumsuz olarak hesaplar bir uygulamaya sahip olursunuz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="6bffd-108">Uygulamanızı bir ana kullanıcı arabirimi (UI) iş parçacığı ve her asal sayı hesaplama için bir iş parçacığı sahip olacaktır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="6bffd-109">Büyük bir sayı olup olmadığını test rağmen asal belirgin bir süre alabilir, ana kullanıcı Arabirimi iş parçacığı tarafından bu gecikme kesilmez ve form hesaplamalar sırasında yanıt verebilir durumda olacaktır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="6bffd-110">Eş zamanlı olarak ve seçmeli olarak istediğiniz gibi pek çok hesaplama hesaplamalar iptal farklı çalıştır kuramaz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="6bffd-111">Bu örneklerde gösterilen görevler aşağıdakileri içerir:</span><span class="sxs-lookup"><span data-stu-id="6bffd-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="6bffd-112">Bileşeni oluşturma</span><span class="sxs-lookup"><span data-stu-id="6bffd-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="6bffd-113">Genel zaman uyumsuz olaylar ve temsilciler tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bffd-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="6bffd-114">Özel temsilcileri tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bffd-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="6bffd-115">Ortak olaylar uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="6bffd-116">Tamamlama yöntemi uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="6bffd-117">Çalışan yöntemlerini uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="6bffd-118">Uygulama başlangıç ve iptal yöntemleri</span><span class="sxs-lookup"><span data-stu-id="6bffd-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="6bffd-119">Bu konuda tek bir liste olarak kodu kopyalamak için bkz: [nasıl yapılır: olay tabanlı zaman uyumsuz desenin istemcisini uygulama](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="6bffd-119">To copy the code in this topic as a single listing, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="6bffd-120">Bileşeni oluşturma</span><span class="sxs-lookup"><span data-stu-id="6bffd-120">Creating the Component</span></span>  
 <span data-ttu-id="6bffd-121">İlk adım, olay tabanlı zaman uyumsuz desen uygulamak bileşeni oluşturmaktır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="6bffd-122">Bileşen oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="6bffd-122">To create the component</span></span>  
  
-   <span data-ttu-id="6bffd-123">Adlı bir sınıf oluşturmak `PrimeNumberCalculator` devraldığı <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="6bffd-124">Genel zaman uyumsuz olaylar ve temsilciler tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bffd-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="6bffd-125">Bileşeniniz olayları kullanan istemciler için iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="6bffd-126">*MethodName***tamamlandı** olay uyarıları bir zaman uyumsuz görev tamamlandığında istemcilere ve *MethodName***ProgressChanged** olay zaman uyumsuz bir görevi ilerlemesini istemcileri bildirir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-126">The *MethodName***Completed** event alerts clients to the completion of an asynchronous task, and the *MethodName***ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="6bffd-127">Bileşeniniz istemciler için zaman uyumsuz olayları tanımlamak için:</span><span class="sxs-lookup"><span data-stu-id="6bffd-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="6bffd-128">İçeri aktarma <xref:System.Threading?displayProperty=nameWithType> ve <xref:System.Collections.Specialized?displayProperty=nameWithType> dosyanızı üstündeki ad alanları.</span><span class="sxs-lookup"><span data-stu-id="6bffd-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="6bffd-129">Önce `PrimeNumberCalculator` sınıf tanımının, ilerleme ve tamamlanmayı olayları için temsilciler bildirin.</span><span class="sxs-lookup"><span data-stu-id="6bffd-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="6bffd-130">İçinde `PrimeNumberCalculator` sınıf tanımının, ilerleme ve tamamlanmayı istemcilere raporlama olayları bildirme.</span><span class="sxs-lookup"><span data-stu-id="6bffd-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="6bffd-131">Sonra `PrimeNumberCalculator` sınıf tanımının, türetilen `CalculatePrimeCompletedEventArgs` için istemcinin olay işleyicisi için her hesaplama sonucunu raporlama sınıfı `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="6bffd-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="6bffd-132">Ek olarak `AsyncCompletedEventArgs` özellikler, bu sınıfı hangi numarasını test edilmiştir, Hazırla olup ve prime değilse, ilk bölen olduğunu belirlemek için istemcinin sağlar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="6bffd-133">Denetim noktası</span><span class="sxs-lookup"><span data-stu-id="6bffd-133">Checkpoint</span></span>  
 <span data-ttu-id="6bffd-134">Bu noktada, bileşen oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="6bffd-135">Bileşeniniz sınamak için</span><span class="sxs-lookup"><span data-stu-id="6bffd-135">To test your component</span></span>  
  
-   <span data-ttu-id="6bffd-136">Bileşen derleyin.</span><span class="sxs-lookup"><span data-stu-id="6bffd-136">Compile the component.</span></span>  
  
     <span data-ttu-id="6bffd-137">İki derleyici uyarıları alırsınız:</span><span class="sxs-lookup"><span data-stu-id="6bffd-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="6bffd-138">Bu uyarılar sonraki bölümde temizlenir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="6bffd-139">Özel temsilcileri tanımlama</span><span class="sxs-lookup"><span data-stu-id="6bffd-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="6bffd-140">Zaman uyumsuz yönlerini `PrimeNumberCalculator` bileşen uygulanır dahili olarak bilinen özel bir temsilci ile bir <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="6bffd-141">A <xref:System.Threading.SendOrPostCallback> üzerinde yürüten bir geri çağırma yöntemi temsil eden bir <xref:System.Threading.ThreadPool> iş parçacığı.</span><span class="sxs-lookup"><span data-stu-id="6bffd-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="6bffd-142">Geri çağırma yöntemi türü tek bir parametre alan bir imzaya sahip olmalıdır <xref:System.Object>, durumu bir sarmalayıcı sınıfı temsilcileri arasında geçirmek anlamına gelir gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="6bffd-143">Daha fazla bilgi için bkz. <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="6bffd-144">Bileşenin iç zaman uyumsuz davranışı uygulamak için:</span><span class="sxs-lookup"><span data-stu-id="6bffd-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="6bffd-145">Bildirme ve oluşturma <xref:System.Threading.SendOrPostCallback> içinde Temsilciler `PrimeNumberCalculator` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bffd-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="6bffd-146">Oluşturma <xref:System.Threading.SendOrPostCallback> bir yardımcı program yöntemi nesneleri adlı `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="6bffd-147">İki temsilciler gerekir: biri istemciye ilerleme durumu raporlama için ve biri istemciye tamamlama raporlama.</span><span class="sxs-lookup"><span data-stu-id="6bffd-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="6bffd-148">Çağrı `InitializeDelegates` , bileşenin Oluşturucusu yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="6bffd-149">Bir temsilci bildirme `PrimeNumberCalculator` asıl işi zaman uyumsuz olarak yapılacak işler sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bffd-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="6bffd-150">Bu temsilci asal bir sayı olup olmadığını sınar çalışan yöntemi sarmalar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="6bffd-151">Temsilci geçen bir <xref:System.ComponentModel.AsyncOperation> zaman uyumsuz işlem ömrü izlemek için kullanılan parametre.</span><span class="sxs-lookup"><span data-stu-id="6bffd-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="6bffd-152">Bekleyen zaman uyumsuz işlemleri ömrü yönetmek için bir koleksiyon oluşturun.</span><span class="sxs-lookup"><span data-stu-id="6bffd-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="6bffd-153">İstemcinin yürütülen ve tamamlandı ve bu izleme, istemci zaman uyumsuz yöntem çağrısı yaptığında benzersiz belirteci ya da görev kimliği geçirmek istemcinin kılarak gerçekleştirilir gibi işlemleri izlemek için bir yol gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="6bffd-154">`PrimeNumberCalculator` Bileşen gerekir izlemek her çağrı karşılık gelen çağırmayla görev kimliği ilişkilendirerek.</span><span class="sxs-lookup"><span data-stu-id="6bffd-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="6bffd-155">İstemci, benzersiz olmayan bir görev kimliği geçerse `PrimeNumberCalculator` bileşen bir özel durum yükseltmek gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="6bffd-156">`PrimeNumberCalculator` Bileşen izler görev kimliği adlı bir özel koleksiyon sınıfı kullanarak bir <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="6bffd-157">Sınıf tanımı'nda oluşturma bir <xref:System.Collections.Specialized.HybridDictionary> adlı `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="6bffd-158">Ortak olaylar uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-158">Implementing Public Events</span></span>  
 <span data-ttu-id="6bffd-159">Olay tabanlı zaman uyumsuz desen uygulamak bileşenleri olayları kullanan istemciler için iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="6bffd-160">Bu olaylar yardımıyla uygun parçacığında çağrılan <xref:System.ComponentModel.AsyncOperation> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bffd-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="6bffd-161">Olaylar, bileşenin istemcilere yükseltmek için:</span><span class="sxs-lookup"><span data-stu-id="6bffd-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="6bffd-162">İstemciler için raporlama için ortak olaylar uygulayın.</span><span class="sxs-lookup"><span data-stu-id="6bffd-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="6bffd-163">İlerleme durumunu ve bir raporlama tamamlanması için raporlama için bir olay gerekir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="6bffd-164">Tamamlama yöntemi uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="6bffd-165">Tamamlama temsilci zaman uyumsuz işlemi başarıyla tamamlandığında, hata ya da iptal sona erdiğinde, temel alınan, ücretsiz iş parçacıklı zaman uyumsuz davranışı çağıracağı yöntemidir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="6bffd-166">Bu çağrıyı rasgele bir iş parçacığı üzerinde gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="6bffd-167">Bu yöntem, istemcinin görev kimliği benzersiz istemci belirteçleri iç koleksiyonundan burada kaldırılır kullanılır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="6bffd-168">Bu yöntem de belirli bir zaman uyumsuz işlem ömrü sona erer <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> karşılık gelen yöntemi <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="6bffd-169">Bu çağrı uygulama modeli için uygun olan iş parçacığında tamamlama olayını başlatır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="6bffd-170">Sonra <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> yöntemi çağrıldığında, bu örneği <xref:System.ComponentModel.AsyncOperation> artık kullanılmamaktadır ve kullanmak için sonraki girişiminde herhangi bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="6bffd-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="6bffd-171">`CompletionMethod` İmza gerekir tutun tüm durumu zaman uyumsuz işlem sonucunu açıklamak gerekli.</span><span class="sxs-lookup"><span data-stu-id="6bffd-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="6bffd-172">Sayının asal ve ilk bölen değerini olup asal sayı değilse bu belirli zaman uyumsuz işlemi tarafından test edilmiştir numarası için durum tutar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="6bffd-173">Ayrıca durumu oluştu, hiçbir özel durumu açıklayan tutar ve <xref:System.ComponentModel.AsyncOperation> bu belirli görevine karşılık gelen.</span><span class="sxs-lookup"><span data-stu-id="6bffd-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="6bffd-174">Zaman uyumsuz bir işlem tamamlamak için:</span><span class="sxs-lookup"><span data-stu-id="6bffd-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="6bffd-175">Tamamlama yöntemini uygulayın.</span><span class="sxs-lookup"><span data-stu-id="6bffd-175">Implement the completion method.</span></span> <span data-ttu-id="6bffd-176">Doldurmak için kullandığı altı parametreler isteyen bir `CalculatePrimeCompletedEventArgs` istemcinin aracılığıyla istemciye döndürülen `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="6bffd-177">İstemcinin görev kimliği belirtecini iç koleksiyonundan kaldırır ve çağrısıyla zaman uyumsuz işlem ömrü sona erer <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="6bffd-178"><xref:System.ComponentModel.AsyncOperation> İş parçacığı veya uygulama modeli için uygun olan içerik çağrısı sıralar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="6bffd-179">Denetim noktası</span><span class="sxs-lookup"><span data-stu-id="6bffd-179">Checkpoint</span></span>  
 <span data-ttu-id="6bffd-180">Bu noktada, bileşen oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="6bffd-181">Bileşeniniz sınamak için</span><span class="sxs-lookup"><span data-stu-id="6bffd-181">To test your component</span></span>  
  
-   <span data-ttu-id="6bffd-182">Bileşen derleyin.</span><span class="sxs-lookup"><span data-stu-id="6bffd-182">Compile the component.</span></span>  
  
     <span data-ttu-id="6bffd-183">Bir derleyici uyarısı alırsınız:</span><span class="sxs-lookup"><span data-stu-id="6bffd-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="6bffd-184">Bu uyarı bir sonraki bölümde çözümlenir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="6bffd-185">Çalışan yöntemlerini uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="6bffd-186">Şu ana kadar destekleyen zaman uyumsuz kodunu uyguladık `PrimeNumberCalculator` bileşeni.</span><span class="sxs-lookup"><span data-stu-id="6bffd-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="6bffd-187">Şimdi asıl işi yapan kod uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="6bffd-188">Üç yöntem gerçekleştireceksiniz: `CalculateWorker`, `BuildPrimeNumberList`, ve `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="6bffd-189">Birlikte `BuildPrimeNumberList` ve `IsPrime` Sieve, test sayının kare kökünü kadar tüm asal sayılar bularak bir sayının asal olup olmadığını belirleyen Eratosthenes, adlı iyi bilinen bir algoritma oluşturan.</span><span class="sxs-lookup"><span data-stu-id="6bffd-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="6bffd-190">Hiçbir divisors bu noktası tarafından bulunursa, test asal sayısıdır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="6bffd-191">Bu bileşen için en yüksek verimlilik yazılmışsa, farklı bir test numaraları için çeşitli çağrılarına tarafından bulunan tüm asal sayıları unutmayın.</span><span class="sxs-lookup"><span data-stu-id="6bffd-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="6bffd-192">Ayrıca 2, 3 ve 5 gibi Önemsiz divisors kontrol.</span><span class="sxs-lookup"><span data-stu-id="6bffd-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="6bffd-193">Bu örneğin amacı nasıl uzun süren işlem göstermektir bu iyileştirmeler sizin için bir alıştırma olarak kalması için zaman uyumsuz olarak ancak çalıştırılabilir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="6bffd-194">`CalculateWorker` Yöntemi bir temsilci paketlenir ve çağrısıyla zaman uyumsuz olarak çağrılır `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6bffd-195">İlerleme durumu raporlama uygulandığına `BuildPrimeNumberList` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="6bffd-196">Hızlı bilgisayarlarda `ProgressChanged` olayları hızlı art arda gerçekleştirilen.</span><span class="sxs-lookup"><span data-stu-id="6bffd-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="6bffd-197">İstemci üzerinde bu olaylar oluşturulur, iş parçacığı, bu durum kaldırabilir olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="6bffd-198">Kullanıcı arabirimi kodu davranışı asılı kaynaklanan iletilerle yayılmamış ve yukarı, devam edilemiyor olabilir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="6bffd-199">Bu durum işleyen bir örnek için kullanıcı arabirimi, bkz: [nasıl yapılır: olay tabanlı zaman uyumsuz desenin istemcisini uygulama](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="6bffd-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="6bffd-200">Asal sayı hesaplama zaman uyumsuz olarak çalıştırmak için:</span><span class="sxs-lookup"><span data-stu-id="6bffd-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="6bffd-201">Uygulama `TaskCanceled` yardımcı yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="6bffd-202">Bu görev ömrü koleksiyonu belirtilen görev kimliği için denetler ve döndürür `true` görev kimliği bulunmazsa.</span><span class="sxs-lookup"><span data-stu-id="6bffd-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="6bffd-203">Uygulama `CalculateWorker` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="6bffd-204">İki parametre alır: bir test etmek için Numaraysa ve bir <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="6bffd-205">Uygulama `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="6bffd-206">İki parametre alır: test etmek için sayı ve bir <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="6bffd-207">Kullandığı <xref:System.ComponentModel.AsyncOperation> rapor ilerleyişini ve artımlı sonuçları.</span><span class="sxs-lookup"><span data-stu-id="6bffd-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="6bffd-208">Bu, istemcinin olay işleyicileri uygun iş parçacığı veya uygulama modeli bağlamının çağırılır sağlar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="6bffd-209">Zaman `BuildPrimeNumberList` asal sayı bir bulursa, onu raporları bu artımlı bir sonucu olarak istemcinin olay işleyicisi için `ProgressChanged` olay.</span><span class="sxs-lookup"><span data-stu-id="6bffd-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="6bffd-210">Bu türetilmiş bir sınıf gerektirir <xref:System.ComponentModel.ProgressChangedEventArgs>adlı `CalculatePrimeProgressChangedEventArgs`, hangi bir adlı özellik eklemiştir `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="6bffd-211">`BuildPrimeNumberList` Yöntemini de düzenli olarak çağırır `TaskCanceled` yöntemi ve yöntem döndürüyorsa çıkar `true`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="6bffd-212">Uygulama `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-212">Implement `IsPrime`.</span></span> <span data-ttu-id="6bffd-213">Üç parametre alır: bilinen asal sayılar, test etmek için numarası ve bir output parametresi bulunamadı ilk bölen için listesi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="6bffd-214">Asal sayılar listesini verildiğinde, bu test sayının asal olup olmadığını belirler.</span><span class="sxs-lookup"><span data-stu-id="6bffd-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="6bffd-215">Türetilen `CalculatePrimeProgressChangedEventArgs` gelen <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="6bffd-216">Bu sınıf istemcinin olay işleyicisi için artımlı sonuçlarını raporlama için gerekli olan `ProgressChanged` olay.</span><span class="sxs-lookup"><span data-stu-id="6bffd-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="6bffd-217">Adlı bir eklenen özelliğe sahiptir `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="6bffd-218">Denetim noktası</span><span class="sxs-lookup"><span data-stu-id="6bffd-218">Checkpoint</span></span>  
 <span data-ttu-id="6bffd-219">Bu noktada, bileşen oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="6bffd-220">Bileşeniniz sınamak için</span><span class="sxs-lookup"><span data-stu-id="6bffd-220">To test your component</span></span>  
  
-   <span data-ttu-id="6bffd-221">Bileşen derleyin.</span><span class="sxs-lookup"><span data-stu-id="6bffd-221">Compile the component.</span></span>  
  
     <span data-ttu-id="6bffd-222">Tüm bu yazılacak kalır başlatmak ve zaman uyumsuz işlemleri iptal etmek için yöntemlerdir `CalculatePrimeAsync` ve `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="6bffd-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="6bffd-223">Başlangıç ve iptal yöntemleri uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="6bffd-224">Çalışan yöntemi çağrılarak kendi iş parçacığında Başlat `BeginInvoke` sarmaladığı temsilci üzerinde.</span><span class="sxs-lookup"><span data-stu-id="6bffd-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="6bffd-225">Belirli bir zaman uyumsuz işlem ömrünü yönetmek için arama <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> yöntemi <xref:System.ComponentModel.AsyncOperationManager> yardımcı sınıfı.</span><span class="sxs-lookup"><span data-stu-id="6bffd-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="6bffd-226">Bu döndürür bir <xref:System.ComponentModel.AsyncOperation>, istemcinin olay işleyicileri çağrılarını uygun iş parçacığı veya bağlam sıralar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="6bffd-227">Belirli bir bekleyen işlemi iptal <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> ilgili üzerinde <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="6bffd-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="6bffd-228">Bu, işlem ve yapılan sonraki çağrılar sona erer kendi <xref:System.ComponentModel.AsyncOperation> bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="6bffd-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="6bffd-229">Başlangıç uygulamak için ve işlevselliği iptal et:</span><span class="sxs-lookup"><span data-stu-id="6bffd-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="6bffd-230">Uygulama `CalculatePrimeAsync` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="6bffd-231">İstemci tarafından sağlanan belirteç (görev kimliği) şu anda görevleri temsil eden tüm belirteçleri göre benzersiz olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="6bffd-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="6bffd-232">İstemci benzersiz olmayan bir belirtece geçiyorsa `CalculatePrimeAsync` bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="6bffd-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="6bffd-233">Aksi takdirde, belirteç görev kimliği koleksiyonuna eklenir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="6bffd-234">Uygulama `CancelAsync` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="6bffd-235">Varsa `taskId` parametresi var. belirteci koleksiyonda, kaldırılmadan.</span><span class="sxs-lookup"><span data-stu-id="6bffd-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="6bffd-236">Bu çalışmasını başlamadı iptal edilmiş görevleri önler.</span><span class="sxs-lookup"><span data-stu-id="6bffd-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="6bffd-237">Görev çalışıyorsa `BuildPrimeNumberList` görev kimliği ömrü koleksiyondan kaldırıldı algıladığında yöntemi çıkar.</span><span class="sxs-lookup"><span data-stu-id="6bffd-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="6bffd-238">Denetim noktası</span><span class="sxs-lookup"><span data-stu-id="6bffd-238">Checkpoint</span></span>  
 <span data-ttu-id="6bffd-239">Bu noktada, bileşen oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="6bffd-240">Bileşeniniz sınamak için</span><span class="sxs-lookup"><span data-stu-id="6bffd-240">To test your component</span></span>  
  
-   <span data-ttu-id="6bffd-241">Bileşen derleyin.</span><span class="sxs-lookup"><span data-stu-id="6bffd-241">Compile the component.</span></span>  
  
 <span data-ttu-id="6bffd-242">`PrimeNumberCalculator` Bileşenidir şimdi tam ve kullanıma hazır.</span><span class="sxs-lookup"><span data-stu-id="6bffd-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="6bffd-243">Kullanan bir örnek istemcisi için `PrimeNumberCalculator` bileşeni Bkz [nasıl yapılır: olay tabanlı zaman uyumsuz desenin istemcisini uygulama](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="6bffd-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="6bffd-244">Sonraki Adımlar</span><span class="sxs-lookup"><span data-stu-id="6bffd-244">Next Steps</span></span>  
 <span data-ttu-id="6bffd-245">Bu örnek yazarak doldurabilirsiniz `CalculatePrime`, zaman uyumlu denk `CalculatePrimeAsync` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="6bffd-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="6bffd-246">Bu yapacak `PrimeNumberCalculator` bileşen olay tabanlı zaman uyumsuz desen ile tamamen uyumlu.</span><span class="sxs-lookup"><span data-stu-id="6bffd-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="6bffd-247">Bu örnekte, farklı bir test numaraları için çeşitli çağrılarına tarafından bulunan tüm asal numaralarının listesini koruyarak artırabilir.</span><span class="sxs-lookup"><span data-stu-id="6bffd-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="6bffd-248">Bu yaklaşımı kullanarak, önceki görevleri tarafından çalışmanın her görev yararlı olacak.</span><span class="sxs-lookup"><span data-stu-id="6bffd-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="6bffd-249">Bu liste ile korumak dikkatli olun `lock` bölgeler, farklı iş parçacıkları tarafından listeye erişim serileştirilmiş şekilde.</span><span class="sxs-lookup"><span data-stu-id="6bffd-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="6bffd-250">Bu örnek 2, 3 ve 5 gibi Önemsiz divisors için test ederek de artırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6bffd-251">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="6bffd-251">See Also</span></span>  
 [<span data-ttu-id="6bffd-252">Nasıl Yapılır: Arka Planda İşlem Çalıştırma</span><span class="sxs-lookup"><span data-stu-id="6bffd-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 [<span data-ttu-id="6bffd-253">Olay Tabanlı Zaman Uyumsuz Desene Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="6bffd-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)  
 [<span data-ttu-id="6bffd-254">IN derleme değil: Visual Basic'te çoklu iş parçacığı kullanımı</span><span class="sxs-lookup"><span data-stu-id="6bffd-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](https://msdn.microsoft.com/library/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="6bffd-255">Nasıl yapılır: Olay Tabanlı Zaman Uyumsuz Deseni Destekleyen Bir Bileşeni Uygulama</span><span class="sxs-lookup"><span data-stu-id="6bffd-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="6bffd-256">Olay Tabanlı Zaman Uyumsuz Desenle Çok İş Parçacıklı Programlama</span><span class="sxs-lookup"><span data-stu-id="6bffd-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
