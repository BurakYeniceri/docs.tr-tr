---
title: "NTLM kimlik doğrulaması için HttpWebRequest sürüm 3.5 SP1'deki değişiklikler"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
caps.latest.revision: "8"
author: mcleblanc
ms.author: markl
manager: markl
ms.openlocfilehash: e23ec35b94196d1f8a597d3a74850b5292a4ef09
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/21/2017
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="5f08e-102">NTLM kimlik doğrulaması için HttpWebRequest sürüm 3.5 SP1'deki değişiklikler</span><span class="sxs-lookup"><span data-stu-id="5f08e-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>
<span data-ttu-id="5f08e-103">Güvenlik değişiklikleri, .NET Framework sürüm 3.5 SP1 yapıldı ve daha sonra bir etkisi nasıl tümleşik Windows kimlik doğrulaması tarafından işlenir <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, ve ilgili System.Net ad alanındaki sınıflar.</span><span class="sxs-lookup"><span data-stu-id="5f08e-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="5f08e-104">Bu değişiklikler, NTLM tabanlı Tümleşik Windows kimlik doğrulaması kullanıldığı web isteği yapmak ve yanıtları almak için bu sınıfları kullanan uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="5f08e-105">Bu değişiklik, web sunucuları ve tümleşik Windows kimlik doğrulaması kullanmak üzere yapılandırılmış istemci uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="5f08e-106">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="5f08e-106">Overview</span></span>  
 <span data-ttu-id="5f08e-107">Tümleşik Windows kimlik doğrulaması tasarımını bazı kimlik bilgisi yanıtlarının bunlar yeniden kullanılan iletilen veya anlamı Evrensel olmasına izin verir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="5f08e-108">Ardından bu belirli tasarım özelliği gerekli değildir, kimlik doğrulama protokollerini hedef belirli bilgilerin yanı sıra kanal belirli bilgileri taşımak.</span><span class="sxs-lookup"><span data-stu-id="5f08e-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="5f08e-109">Hizmetleri sonra kimlik bilgisi yanıtları hizmet belirli bilgileri gibi bir hizmet asıl adı (SPN) içerdiğinden emin olmak için genişletilmiş koruma sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="5f08e-110">Kimlik bilgisi alışverişleri bu bilgilerle, hizmetleri yanlış alındıktan kimlik bilgisi yanıtları kötü niyetli kullanımına karşı daha iyi koruyabilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>  
  
 <span data-ttu-id="5f08e-111">Birden çok bileşeni <xref:System.Net> ve <xref:System.Net.Security> ad alanları çağıran bir uygulama adına tümleşik Windows kimlik doğrulaması gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="5f08e-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="5f08e-112">Bu bölümde, tümleşik Windows kimlik doğrulaması kullanımları genişletilmiş koruma eklenecek System.Net bileşenleri değişiklikler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="5f08e-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
## <a name="changes"></a><span data-ttu-id="5f08e-113">Değişiklikler</span><span class="sxs-lookup"><span data-stu-id="5f08e-113">Changes</span></span>  
 <span data-ttu-id="5f08e-114">Tümleşik Windows kimlik doğrulaması ile kullanılan NTLM kimlik doğrulama işlemi, hedef bilgisayar tarafından verilen ve istemci bilgisayarına geri gönderilen bir sınama içerir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="5f08e-115">Bir bilgisayarın kendisi oluşturulan bir sınama aldığında, bağlantıyı döngü geri bağlantı (127.0.0.1, örneğin IPv4 adresi) olmadıkça kimlik doğrulaması başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="5f08e-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>  
  
 <span data-ttu-id="5f08e-116">Bir iç Web sunucusunda çalışan bir hizmete erişirken http://contoso/service veya https://contoso/service benzer bir URL'yi kullanarak hizmete erişmek için yaygın bir sorundur.</span><span class="sxs-lookup"><span data-stu-id="5f08e-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to http://contoso/service or https://contoso/service.</span></span> <span data-ttu-id="5f08e-117">"contoso" adı genellikle hizmet dağıtıldığı bilgisayarın bilgisayar adı değil.</span><span class="sxs-lookup"><span data-stu-id="5f08e-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="5f08e-118"><xref:System.Net> Ve ilgili ad alanlarını destek Active Directory, DNS, NetBIOS kullanarak, yerel bilgisayarın ana bilgisayar (genellikle WINDOWS\system32\drivers\etc\hosts, örneğin) dosyası veya (genellikle WINDOWS\system32\ yerel bilgisayarın lmhosts dosyası Örneğin drivers\etc\lmhosts) adreslerine adları çözümlemek için.</span><span class="sxs-lookup"><span data-stu-id="5f08e-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="5f08e-119">Adı "contoso", "contoso" gönderilen istekleri uygun sunucu bilgisayarına gönderilen böylece çözümlenir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>  
  
 <span data-ttu-id="5f08e-120">Büyük dağıtımlar için yapılandırıldığında, ayrıca dağıtım için hiç istemci uygulamaları ve son kullanıcılar tarafından kullanılan temel makine adlarıyla verilecek bir tek bir sanal sunucu adı için yaygındır.</span><span class="sxs-lookup"><span data-stu-id="5f08e-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="5f08e-121">Örneğin, sunucu www.contoso.com çağrı ancak iç ağda yalnızca "contoso" kullanın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-121">For example, you might call the server www.contoso.com, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="5f08e-122">Bu ad istemci web istek ana bilgisayar üstbilgisi adı verilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="5f08e-123">Belirtildiği gibi HTTP protokolü tarafından ana bilgisayar istek üstbilgisi alanı istenen kaynak Internet ana bilgisayarı ve bağlantı noktası sayısını belirtir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="5f08e-124">Bu bilgiler kullanıcı veya başvuran kaynak (genellikle bir HTTP URL'si) tarafından verilen özgün uri'den elde edilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="5f08e-125">.NET Framework sürüm 4, bu bilgiler ayrıca kullanarak yeni istemci tarafından ayarlanabilir <xref:System.Net.HttpWebRequest.Host%2A> özelliği.</span><span class="sxs-lookup"><span data-stu-id="5f08e-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>  
  
 <span data-ttu-id="5f08e-126"><xref:System.Net.AuthenticationManager> Sınıfı tarafından kullanılan yönetilen kimlik doğrulaması bileşenleri ("modüller") denetler <xref:System.Net.WebRequest> türetilmiş sınıfları ve <xref:System.Net.WebClient> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="5f08e-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="5f08e-127"><xref:System.Net.AuthenticationManager> SAX kullanıma sunan bir özelliği bir <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> kimlik doğrulaması sırasında kullanılacak özel bir SPN dize sağlamak üzere uygulamalar için URI dizesini tarafından dizine nesnesi.</span><span class="sxs-lookup"><span data-stu-id="5f08e-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>  
  
 <span data-ttu-id="5f08e-128">Sürüm 3.5 SP1'i varsayılan ana bilgisayar adını belirtmek için bir SPN NTLM (NT LAN Yöneticisi) kimlik doğrulaması, istek URL'SİNDE kullanılan artık exchange <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> özelliği ayarlı değil.</span><span class="sxs-lookup"><span data-stu-id="5f08e-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="5f08e-129">İstek URL'SİNDE kullanılan ana bilgisayar adı belirtilen ana bilgisayar üstbilgisi alanından farklı <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> istemci isteğindeki.</span><span class="sxs-lookup"><span data-stu-id="5f08e-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="5f08e-130">İstek URL'SİNDE kullanılan ana bilgisayar adı sunucunun gerçek ana bilgisayar adı, sunucu, bilgisayarın IP adresi ya da geri döngü adresine makine adını farklı olabilir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="5f08e-131">Bu durumlarda, Windows kimlik doğrulama isteği başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="5f08e-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="5f08e-132">Sorunu gidermek için kullanılan ana bilgisayar adı Windows bildirmek ihtiyacımız istemci istek URL'sindeki ("contoso", örneğin) gerçekte farklı bir ad yerel bilgisayar isteğidir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>  
  
 <span data-ttu-id="5f08e-133">Bu değişikliği geçici olarak çözmek bir sunucu uygulaması için olası birkaç yöntem vardır.</span><span class="sxs-lookup"><span data-stu-id="5f08e-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="5f08e-134">İstek URL'sindeki kullanılan ana bilgisayar adı eşlemek için önerilen yaklaşımdır `BackConnectionHostNames` sunucunun kayıt defterinde anahtar.</span><span class="sxs-lookup"><span data-stu-id="5f08e-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="5f08e-135">`BackConnectionHostNames` Kayıt defteri anahtarı bir ana bilgisayar adı bir geri döngü adresine eşlemek için normal olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="5f08e-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="5f08e-136">Adımlar aşağıda listelenmiştir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-136">The steps are listed below.</span></span>  
  
 <span data-ttu-id="5f08e-137">Geri döngü adresine eşlenir ve yerel bir bilgisayarda Web sitelerine bağlanabilirsiniz, ana bilgisayar adını belirtmek için aşağıdaki adımları izleyin:</span><span class="sxs-lookup"><span data-stu-id="5f08e-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>  
  
 1. <span data-ttu-id="5f08e-138">Başlat'ı tıklatın, Çalıştır'ı tıklatın, regedit yazın ve ardından Tamam'ı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-138">Click Start, click Run, type regedit, and then click OK.</span></span>  
  
 2. <span data-ttu-id="5f08e-139">Kayıt Defteri Düzenleyicisi'nde, bulun ve aşağıdaki kayıt defteri anahtarını tıklatın:</span><span class="sxs-lookup"><span data-stu-id="5f08e-139">In Registry Editor, locate and then click the following registry key:</span></span>  
  
 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`  
  
 3. <span data-ttu-id="5f08e-140">Msv1_0 sağ tıklatın, Yeni'yi ve çok dizeli değer'ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>  
  
 4. <span data-ttu-id="5f08e-141">Tür `BackConnectionHostNames`, ve ardından ENTER tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>  
  
 5. <span data-ttu-id="5f08e-142">Sağ `BackConnectionHostNames`, Değiştir'i tıklatın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>  
  
 6. <span data-ttu-id="5f08e-143">Değer verisi kutusuna ana bilgisayar adı veya yerel bilgisayarda ve Tamam'ı siteleri (istek URL'SİNDE kullanılan ana bilgisayar adı) ana bilgisayar adlarını yazın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>  
  
 7. <span data-ttu-id="5f08e-144">Kayıt Defteri Düzenleyicisi'nden çıkın ve IISAdmin hizmetini yeniden başlatın ve Iısreset'i çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="5f08e-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>  
  
 <span data-ttu-id="5f08e-145">Daha az güvenli çalışma yaklaşık döngü geri denetimi devre dışı bırakmak için açıklandığı gibi olan [http://support.microsoft.com/kb/896861](http://go.microsoft.com/fwlink/?LinkID=179657).</span><span class="sxs-lookup"><span data-stu-id="5f08e-145">A less secure work around is to disable the loop back check, as described in [http://support.microsoft.com/kb/896861](http://go.microsoft.com/fwlink/?LinkID=179657).</span></span> <span data-ttu-id="5f08e-146">Bu yansıma saldırılara karşı koruma devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="5f08e-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="5f08e-147">Bu nedenle yalnızca gerçekten kullandığınız için makine beklediğiniz için diğer adlar kümesi sınırlamak iyidir.</span><span class="sxs-lookup"><span data-stu-id="5f08e-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5f08e-148">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="5f08e-148">See Also</span></span>  
 <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>  
 <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>  
 <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
