---
title: WCF'de Güvenlik için En İyi Uygulamalar
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: 2c1588fa48631aec4e185fd8362a02505aa15e58
ms.sourcegitcommit: d8bf4976eafe3289275be3811e7cb721bfff7e1e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/04/2018
ms.locfileid: "34753467"
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="94e9f-102">WCF'de Güvenlik için En İyi Uygulamalar</span><span class="sxs-lookup"><span data-stu-id="94e9f-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="94e9f-103">Aşağıdaki bölümlerde Windows Communication Foundation (WCF) kullanarak güvenli uygulamaları oluştururken dikkate alınması gereken en iyi uygulamaları listeleyin.</span><span class="sxs-lookup"><span data-stu-id="94e9f-103">The following sections list the best practices to consider when creating secure applications using Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="94e9f-104">Güvenlik hakkında daha fazla bilgi için bkz: [güvenlik konuları](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [veriler için güvenlik konuları](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), ve [meta veriler hakkında güvenlik konuları](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="94e9f-104">For more information about security, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), and [Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="94e9f-105">Windows kimlik doğrulaması ile SPN'ler gerçekleştirme Services belirle</span><span class="sxs-lookup"><span data-stu-id="94e9f-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="94e9f-106">Hizmetleri, kullanıcı asıl adları (UPN'ler) veya hizmet asıl adları (SPN) ile tanımlanabilir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="94e9f-107">Ağ hizmeti gibi makine hesabı altında çalışan hizmetleri çalıştırdıkları makineye karşılık gelen bir SPN kimliğe sahip.</span><span class="sxs-lookup"><span data-stu-id="94e9f-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="94e9f-108">Kullanıcı hesapları altında çalışan hizmetleri sahip çalışıyor, kullanıcı ancak karşılık gelen bir UPN kimliği `setspn` aracı, kullanıcı hesabı için bir SPN atamak için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="94e9f-109">Bir hizmeti SPN tanımlanabilir ve hizmete bağlanmada istemcilerini bu SPN kullanacak şekilde yapılandırma belirli yapabilirsiniz yapılandırma daha zor saldırıları.</span><span class="sxs-lookup"><span data-stu-id="94e9f-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="94e9f-110">Bu kılavuz, Kerberos veya SSPI anlaşması kullanarak bağlamaları için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="94e9f-111">İstemciler, burada SSPI NTLM'ye geri döner durumda bir SPN hala belirtmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="94e9f-112">WSDL hizmet kimliklerini doğrulama</span><span class="sxs-lookup"><span data-stu-id="94e9f-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="94e9f-113">WS-SecurityPolicy meta verilerde kendi kimlikleri hakkında bilgi yayımlamak hizmetler sağlar.</span><span class="sxs-lookup"><span data-stu-id="94e9f-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="94e9f-114">Aracılığıyla alınırken `svcutil` veya gibi diğer yöntemleri <xref:System.ServiceModel.Description.WsdlImporter>, bu kimlik bilgileri WCF Hizmeti uç nokta adresleri kimlik özelliklerinin çevrilir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the WCF service endpoint addresses.</span></span> <span data-ttu-id="94e9f-115">Bu hizmet kimlikleri etkili bir şekilde doğru ve geçerli olduğundan emin olun olmayan istemcilerin hizmeti kimlik doğrulama atlama.</span><span class="sxs-lookup"><span data-stu-id="94e9f-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="94e9f-116">Kötü amaçlı bir hizmete kimlik bilgisi iletme ve diğer "ortadaki adam" saldırılarına kendi WSDL içinde istenen kimlik değiştirerek yürütmek için bu tür istemciler yararlanabilir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="94e9f-117">NTLM yerine sertifikaları X509 kullan</span><span class="sxs-lookup"><span data-stu-id="94e9f-117">Use X509 Certificates Instead of NTLM</span></span>  
 <span data-ttu-id="94e9f-118">WCF eşler arası kimlik doğrulaması için iki mekanizma sunar: X509 (eş kanal tarafından kullanılan) sertifikaları ve burada SSPI anlaşması daha aşağı düşürmeden Kerberos'tan için NTLM Windows kimlik doğrulaması.</span><span class="sxs-lookup"><span data-stu-id="94e9f-118">WCF offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="94e9f-119">Sertifika tabanlı kimlik doğrulaması 1024 bit veya daha fazla anahtar boyutları kullanarak çeşitli nedenlerle NTLM için tercih edilir:</span><span class="sxs-lookup"><span data-stu-id="94e9f-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
-   <span data-ttu-id="94e9f-120">Karşılıklı kimlik doğrulaması kullanılabilirliği,</span><span class="sxs-lookup"><span data-stu-id="94e9f-120">the availability of mutual authentication,</span></span>  
  
-   <span data-ttu-id="94e9f-121">daha güçlü şifreleme algoritmaları kullanımını ve</span><span class="sxs-lookup"><span data-stu-id="94e9f-121">the use of stronger cryptographic algorithms, and</span></span>  
  
-   <span data-ttu-id="94e9f-122">X509 kullanan büyük zorluğunu iletilen kimlik bilgileri.</span><span class="sxs-lookup"><span data-stu-id="94e9f-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  
   
## <a name="always-revert-after-impersonation"></a><span data-ttu-id="94e9f-123">Kimliğe bürünme sonra her zaman geri</span><span class="sxs-lookup"><span data-stu-id="94e9f-123">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="94e9f-124">İstemcinin kimliğe bürünme özelliğini etkinleştirme API'leri kullanırken, özgün kimliğine geri dönülemiyor emin olun.</span><span class="sxs-lookup"><span data-stu-id="94e9f-124">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="94e9f-125">Kullanırken, örneğin, <xref:System.Security.Principal.WindowsIdentity> ve <xref:System.Security.Principal.WindowsImpersonationContext>, C# kullanan `using` deyimi veya Visual Basic`Using` aşağıdaki kodda gösterildiği gibi deyimi.</span><span class="sxs-lookup"><span data-stu-id="94e9f-125">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="94e9f-126"><xref:System.Security.Principal.WindowsImpersonationContext> Uygulayan sınıf <xref:System.IDisposable> arabirimi ve bu nedenle ortak dil çalışma zamanı (CLR) otomatik olarak özgün kimliğine geri döner kodu bırakır sonra `using` bloğu.</span><span class="sxs-lookup"><span data-stu-id="94e9f-126">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="94e9f-127">Yalnızca gerektiğinde kimliğine bürün</span><span class="sxs-lookup"><span data-stu-id="94e9f-127">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="94e9f-128">Kullanarak <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> yöntemi <xref:System.Security.Principal.WindowsIdentity> sınıfı, bu çok denetimli bir kapsamda kimliğe bürünme kullanmak mümkün.</span><span class="sxs-lookup"><span data-stu-id="94e9f-128">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="94e9f-129">Bunun aksine kullanmaktır <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> özelliği <xref:System.ServiceModel.OperationBehaviorAttribute>, kapsam için tüm işlem kimliğine bürünme izin verir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-129">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="94e9f-130">Mümkün olduğunda, daha kesin kullanarak kimliğe bürünme kapsamını denetleme <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="94e9f-130">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="94e9f-131">Meta veri güvenilir kaynaklardan alın</span><span class="sxs-lookup"><span data-stu-id="94e9f-131">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="94e9f-132">Emin olun, meta veri kaynağına güveniyorsanız ve hiç kimse meta verileriyle değiştirilmiş olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="94e9f-132">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="94e9f-133">HTTP protokolü kullanılarak alınan meta veriler düz metin olarak gönderilir ve ile değiştirilmiş.</span><span class="sxs-lookup"><span data-stu-id="94e9f-133">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="94e9f-134">Hizmet kullanıyorsa <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> ve <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> özellikleri, hizmet oluşturucusu tarafından sağlanan URL HTTPS protokolünü kullanarak veri yüklemek için kullanın.</span><span class="sxs-lookup"><span data-stu-id="94e9f-134">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="94e9f-135">Güvenlik kullanarak meta verileri yayımlama</span><span class="sxs-lookup"><span data-stu-id="94e9f-135">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="94e9f-136">Bir hizmetin yayımlanan meta verileriyle üzerinde oynanmasını önlemek için meta verileri exchange uç nokta taşıma veya ileti düzeyi güvenlik ile güvenli hale getirin.</span><span class="sxs-lookup"><span data-stu-id="94e9f-136">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="94e9f-137">Daha fazla bilgi için bkz: [yayımlama meta veri uç noktalarını](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) ve [nasıl yapılır: meta verileri kullanarak bir hizmet kodu yayımlama](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="94e9f-137">For more information, see [Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="94e9f-138">Yerel yayımlayan kullanımını emin olun</span><span class="sxs-lookup"><span data-stu-id="94e9f-138">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="94e9f-139">Yerel yayımlayan bir veren adresi ve bağlama için belirtilen bir bağlama belirtilirse, bu bağlamayı kullanan uç noktaları için kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="94e9f-139">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="94e9f-140">Her zaman yerel yayımlayan kullanmayı düşündüğünüz istemcilerinin veren adresi null olacak şekilde, bunlar bağlama değiştirmek veya böyle bir bağlama kullanmayın emin olun.</span><span class="sxs-lookup"><span data-stu-id="94e9f-140">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="94e9f-141">SAML belirteci boyutu kotaları</span><span class="sxs-lookup"><span data-stu-id="94e9f-141">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="94e9f-142">Güvenlik onaylar biçimlendirme dili (SAML) belirteçleri iletilerinde, bir güvenlik belirteci hizmeti (STS) tarafından verildiğinde veya istemciler bunları Hizmetleri kimlik doğrulaması bir parçası olarak mevcut olduğunda serileştirildiği zaman maksimum ileti boyutu kotası yeterince olmalıdır SAML belirteci ve diğer ileti bölümleri içerecek kadar büyük.</span><span class="sxs-lookup"><span data-stu-id="94e9f-142">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="94e9f-143">Normal durumlarda, varsayılan ileti boyutu kotalarını yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="94e9f-143">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="94e9f-144">Ancak, talep yüzlerce içerdiğinden bir SAML belirtecine büyük olduğu durumlarda, kotalar serileştirilmiş belirteci uyum sağlayacak şekilde artırılacak.</span><span class="sxs-lookup"><span data-stu-id="94e9f-144">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="94e9f-145">Kotalar hakkında daha fazla bilgi için bkz: [veriler için güvenlik konuları](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="94e9f-145">For more information about quotas, see [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="94e9f-146">SecurityBindingElement.IncludeTimestamp üzerinde özel bağlamalar True olarak ayarlayın</span><span class="sxs-lookup"><span data-stu-id="94e9f-146">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="94e9f-147">Özel bağlama oluşturduğunuzda, ayarlamalısınız <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> için `true`.</span><span class="sxs-lookup"><span data-stu-id="94e9f-147">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="94e9f-148">Aksi halde, eğer <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> ayarlanır `false`, ve istemci bir X509 gibi bir asimetrik anahtar tabanlı belirteci kullanarak sertifika, ileti imzalanmamış.</span><span class="sxs-lookup"><span data-stu-id="94e9f-148">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="94e9f-149">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="94e9f-149">See Also</span></span>  
 [<span data-ttu-id="94e9f-150">Güvenlik Konuları</span><span class="sxs-lookup"><span data-stu-id="94e9f-150">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)  
 [<span data-ttu-id="94e9f-151">Veriler için Güvenlik Konuları</span><span class="sxs-lookup"><span data-stu-id="94e9f-151">Security Considerations for Data</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)  
 [<span data-ttu-id="94e9f-152">Meta Veriler Hakkında Güvenlik Konuları</span><span class="sxs-lookup"><span data-stu-id="94e9f-152">Security Considerations with Metadata</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)
