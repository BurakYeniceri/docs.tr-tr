---
title: "Keşif Güvenliği Örneği"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
caps.latest.revision: "13"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.openlocfilehash: 2b21017be0927f0d5189744111437c5afa6dd623
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/18/2017
---
# <a name="discovery-security-sample"></a><span data-ttu-id="2111e-102">Keşif Güvenliği Örneği</span><span class="sxs-lookup"><span data-stu-id="2111e-102">Discovery Security Sample</span></span>
<span data-ttu-id="2111e-103">Bulma belirtiminin olmasını bulma işlemi katılmak uç noktalarını güvenli gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="2111e-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="2111e-104">Bulma iletileri ile güvenliği artırmaya azaltır saldırıları çeşitli türlerde (ileti değişikliğinin, hizmet reddi, yeniden yürütme, kimlik sahtekarlığı).</span><span class="sxs-lookup"><span data-stu-id="2111e-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="2111e-105">Bu örnek, işlem ve (WS-bulma belirtimi bölüm 8.2 içinde açıklanan) compact imza biçimini kullanarak ileti imzaları doğrulamak özel kanalları uygular.</span><span class="sxs-lookup"><span data-stu-id="2111e-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="2111e-106">Örnek destekler [2005 bulma belirtimi](http://go.microsoft.com/fwlink/?LinkId=177912) ve [1.1 sürümünü](http://go.microsoft.com/fwlink/?LinkId=179677).</span><span class="sxs-lookup"><span data-stu-id="2111e-106">The sample supports both the [2005 Discovery specification](http://go.microsoft.com/fwlink/?LinkId=177912) and the [1.1 version](http://go.microsoft.com/fwlink/?LinkId=179677).</span></span>  
  
 <span data-ttu-id="2111e-107">Özel kanal bulma ve duyuru uç noktalar için varolan kanal yığın üzerinde uygulanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="2111e-108">Bu şekilde, bir imza üstbilgisi gönderilen her ileti için uygulanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="2111e-109">İmza alınan iletiler üzerinde doğrulanır ve eşleşmiyor veya iletileri bir imzaya sahip değilse, iletileri bırakılır.</span><span class="sxs-lookup"><span data-stu-id="2111e-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="2111e-110">Oturum açın ve iletileri doğrulamak için örnek sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="2111e-111">Tartışma</span><span class="sxs-lookup"><span data-stu-id="2111e-111">Discussion</span></span>  
 <span data-ttu-id="2111e-112">WCF çok genişletilebilir ve kullanıcıların istendiği kanalları özelleştirmek olasılığı sağlar.</span><span class="sxs-lookup"><span data-stu-id="2111e-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="2111e-113">Güvenli kanal oluşturan bir bulma güvenli bağlama öğesi örneği uygular.</span><span class="sxs-lookup"><span data-stu-id="2111e-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="2111e-114">Güvenli kanal uygulamak ve ileti imzaları doğrulamak ve geçerli yığının en üstünde uygulanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="2111e-115">Güvenli kanal fabrikaları ve kanal dinleyicileri güvenli bağlama öğesi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="2111e-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="2111e-116">Güvenli kanal fabrikası</span><span class="sxs-lookup"><span data-stu-id="2111e-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="2111e-117">Güvenli kanal fabrikası çıkış veya compact imza ileti üstbilgilerini eklemek çift yönlü kanalı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="2111e-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="2111e-118">İletileri compact imza biçimi olabildiğince küçük tutmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="2111e-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="2111e-119">Compact imza yapısını, aşağıdaki örnekte gösterilir.</span><span class="sxs-lookup"><span data-stu-id="2111e-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
>  <span data-ttu-id="2111e-120">`PrefixList` 2008 bulma sürüm protokolünde eklendi.</span><span class="sxs-lookup"><span data-stu-id="2111e-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="2111e-121">İmza işlem için örnek genişletilmiş imza öğeleri belirler.</span><span class="sxs-lookup"><span data-stu-id="2111e-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="2111e-122">Bir XML imzası (`SignedInfo`), kullanılarak oluşturulan `ds` WS-bulma belirtimine göre gerektiği gibi ad alanı öneki.</span><span class="sxs-lookup"><span data-stu-id="2111e-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="2111e-123">İle değiştirilmemesi şekilde gövdesi ve bulma ve ad alanları adresleme tüm üstbilgileri imzada başvurulur.</span><span class="sxs-lookup"><span data-stu-id="2111e-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="2111e-124">Başvurulan her öğenin özel Standartlaştırma (http://www.w3.org/2001/10/xml-exc-c14n#) kullanılarak dönüştürülen ve ardından SHA-1 Özet hesaplanan (http://www.w3.org/2000/09/xmldsig#sha1) bir değerdir.</span><span class="sxs-lookup"><span data-stu-id="2111e-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="2111e-125">Tüm başvurulan öğelerin ve Özet değerlerine bağlı olarak, imza değeri (http://www.w3.org/2000/09/xmldsig#rsa-sha1) RSA algoritması kullanılarak hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="2111e-126">İstemci tarafından belirtilen bir sertifikayla imzalı iletiler.</span><span class="sxs-lookup"><span data-stu-id="2111e-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="2111e-127">Bağlama öğesi oluşturulduğunda, depolama konumu, adı ve sertifika konu adı belirtilmelidir.</span><span class="sxs-lookup"><span data-stu-id="2111e-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="2111e-128">`KeyId` Compact imzada imzalama belirteci anahtar tanımlayıcısını temsil eder ve imzalama belirtecinin konu anahtarı tanımlayıcısı (SKI) olan veya (SKI yoksa) imzalama belirtecinin ortak anahtarın SHA-1 karması.</span><span class="sxs-lookup"><span data-stu-id="2111e-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="2111e-129">Güvenli kanal dinleyicisi</span><span class="sxs-lookup"><span data-stu-id="2111e-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="2111e-130">Güvenli kanal dinleyicisi alınan iletilerde compact imzasını giriş veya çift yönlü kanalı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="2111e-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="2111e-131">İmzayı doğrulamak için `KeyId` compact belirtilen iletisine imza belirtilen deposundan bir sertifikayı seçmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="2111e-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="2111e-132">İleti bir imzası yok veya imza denetimi başarısız olursa, iletileri bırakılır.</span><span class="sxs-lookup"><span data-stu-id="2111e-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="2111e-133">Güvenli bağlama kullanmak için örnek özel oluşturan bir Üreteç tanımlar <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ve <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> eklenen bulma güvenli bağlama öğeye sahip.</span><span class="sxs-lookup"><span data-stu-id="2111e-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="2111e-134">Bu güvenli uç noktalarını bulma duyuru dinleyicileri ve bulunabilirlik Hizmetleri'nde kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="2111e-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="2111e-135">Örnek Ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="2111e-135">Sample Details</span></span>  
 <span data-ttu-id="2111e-136">Örnek, bir kitaplık ve 4 konsol uygulamaları içerir:</span><span class="sxs-lookup"><span data-stu-id="2111e-136">The sample includes a library and 4 console applications:</span></span>  
  
-   <span data-ttu-id="2111e-137">**DiscoverySecurityChannels**: Güvenli bağlama kullanıma sunan bir kitaplık.</span><span class="sxs-lookup"><span data-stu-id="2111e-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="2111e-138">Kitaplık hesaplar ve giden/gelen iletiler için compact imzayı doğrular.</span><span class="sxs-lookup"><span data-stu-id="2111e-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
-   <span data-ttu-id="2111e-139">**Hizmet**: kendini barındıran ICalculatorService sözleşme gösterme bir hizmet.</span><span class="sxs-lookup"><span data-stu-id="2111e-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="2111e-140">Hizmet bulunabilir işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="2111e-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="2111e-141">Kullanıcının depolama konumu ve adı ve konu adı veya diğer sertifika için benzersiz bir tanımlayıcı belirterek iletileri imzalamak için kullanılan sertifika ayrıntılarını belirtir ve istemci sertifikalarını nerede deposu (için kullanılan sertifikaları yer gelen iletiler için imza denetleyin).</span><span class="sxs-lookup"><span data-stu-id="2111e-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="2111e-142">Bu ayrıntıları bağlı olarak, ek güvenlik ile UdpDiscoveryEndpoint yerleşik olarak kullanılan ve.</span><span class="sxs-lookup"><span data-stu-id="2111e-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
-   <span data-ttu-id="2111e-143">**İstemci**: Bu sınıf bir ICalculatorService bulmak ve hizmette yöntemleri çağırmak için çalışır.</span><span class="sxs-lookup"><span data-stu-id="2111e-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="2111e-144">Yeniden, bir <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> güvenlik yerleşik ve oturum açın ve iletileri doğrulamak için kullanılan eklendi.</span><span class="sxs-lookup"><span data-stu-id="2111e-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
-   <span data-ttu-id="2111e-145">**AnnouncementListener**: çevrimiçi ve çevrimdışı duyurularını dinler ve güvenli duyuru uç noktası kullanan bir kendi kendini barındıran hizmet.</span><span class="sxs-lookup"><span data-stu-id="2111e-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2111e-146">Birden çok kez Setup.bat çalıştırırsanız, yinelenen sertifikalar olarak eklemek için bir sertifika seçmek için Sertifika Yöneticisi'ni ister.</span><span class="sxs-lookup"><span data-stu-id="2111e-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="2111e-147">Bu durumda, Setup.bat durduruldu ve yinelemeleri zaten oluşturulduğundan Cleanup.bat çağrılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="2111e-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="2111e-148">CleanUp.bat silmek için bir sertifika seçmek ister.</span><span class="sxs-lookup"><span data-stu-id="2111e-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="2111e-149">Listeden bir sertifika seçin ve sertifika kalan kadar Cleanup.bat yürütme devam edin.</span><span class="sxs-lookup"><span data-stu-id="2111e-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="2111e-150">Bu örneği kullanmak için</span><span class="sxs-lookup"><span data-stu-id="2111e-150">To use this sample</span></span>  
  
1.  <span data-ttu-id="2111e-151">Visual Studio komut isteminden Setup.bat betiğini yürütün.</span><span class="sxs-lookup"><span data-stu-id="2111e-151">Execute the Setup.bat script from a Visual Studio command prompt.</span></span> <span data-ttu-id="2111e-152">Örnek, oturum ve iletileri doğrulamak için sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="2111e-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="2111e-153">Komut dosyası Makecert.exe ile sertifikalar oluşturur ve bunları yükler Certmgr.exe kullanma.</span><span class="sxs-lookup"><span data-stu-id="2111e-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="2111e-154">Komut dosyasını yönetici ayrıcalıklarıyla çalıştırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="2111e-154">The script must be run with administrator privileges.</span></span>  
  
2.  <span data-ttu-id="2111e-155">Derleme ve örneği çalıştırmak için Security.sln dosyasını Visual Studio'da açın ve seçin **yeniden tüm**.</span><span class="sxs-lookup"><span data-stu-id="2111e-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="2111e-156">Birden çok proje başlatmak için çözüm özelliklerini güncelleştirmek: seçin **Başlat** DiscoverySecureChannels dışındaki tüm projeleri için.</span><span class="sxs-lookup"><span data-stu-id="2111e-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="2111e-157">Çözüm normal olarak çalışır.</span><span class="sxs-lookup"><span data-stu-id="2111e-157">Run the solution normally.</span></span>  
  
3.  <span data-ttu-id="2111e-158">Örnekle tamamladıktan sonra bu örnek için oluşturulan sertifikalar kaldırır Cleanup.bat betiğini yürütün.</span><span class="sxs-lookup"><span data-stu-id="2111e-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="2111e-159">Örnekler, makinenizde zaten yüklü olabilir.</span><span class="sxs-lookup"><span data-stu-id="2111e-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="2111e-160">Devam etmeden önce aşağıdaki (varsayılan) dizin denetleyin.</span><span class="sxs-lookup"><span data-stu-id="2111e-160">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="2111e-161">Bu dizin mevcut değilse, Git [Windows Communication Foundation (WCF) ve .NET Framework 4 için Windows Workflow Foundation (WF) örnek](http://go.microsoft.com/fwlink/?LinkId=150780) tüm indirmek için [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] ve [!INCLUDE[wf1](../../../../includes/wf1-md.md)] örnekleri.</span><span class="sxs-lookup"><span data-stu-id="2111e-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="2111e-162">Bu örnek aşağıdaki dizinde bulunur.</span><span class="sxs-lookup"><span data-stu-id="2111e-162">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
  
## <a name="see-also"></a><span data-ttu-id="2111e-163">Ayrıca Bkz.</span><span class="sxs-lookup"><span data-stu-id="2111e-163">See Also</span></span>
